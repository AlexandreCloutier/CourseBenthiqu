<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body onload="menuPrincipal()">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script src="scripts/jquery.flip.min.js"></script>
    <script>

        var typeEnum = {
            'habitats': 'habitats',
            'macroInvertebre': 'macroInvertebre',
            'perturbation': 'perturbation',
            'speciale': 'special',
            'action': 'action',
            'intervention': 'intervention',
            'salmonide': 'salmonide',
            'bandeRiveraine': 'bandeRiveraine',
            'reglementation': 'reglementation'
        };
        var nomEnum = {
            'erosion': 'erosion',
            'assainissement': 'assainissement',
            'fosse': 'fosse',
            'sable': 'sable',
            'gravier': 'gravier',
            'rapides': 'rapides',
            'galets': 'galets',
            'oligochaeta': 'oligochaeta',
            'simuliidae': 'simuliidae',
            'chironomidae': 'chironomidae',
            'psephenidae': 'psephenidae',
            'hydropsychidae': 'hydropsychidae',
            'elmidae': 'elmidae',
            'baetidae': 'baetidae',
            'hydroptilidae': 'hydroptilidae',
            'ephemeridae': 'ephemeridae',
            'prosobranchia': 'prosobranchia',
            'sphaeridae': 'sphaeridae',
            'anisoptera': 'anisoptera',
            'glossosomatidae': 'glossosomatidae',
            'heptageniidae': 'heptageniidae',
            'ephemerellidae': 'ephemerellidae',
            'brachycentrus': 'brachycentrus',
            'rhyacophilidae': 'rhyacophilidae',
            'tipulidae': 'tipulidae',
            'gyrinidae': 'gyrinidae',
            'perlidae': 'perlidae',
            'corydalidae': 'corydalidae',
            'nipidae': 'nipidae',
            'decapoda': 'decapoda',
            'pteronarcyidae': 'pteronarcyidae',
            'zonage': 'zonage',
            'crueSoudaine': 'crueSoudaine',
            'pecheur': 'pecheur',
            'emergence': 'emergence',
            'derivation': 'derivation',
            'predation': 'predation',
            'retention': 'retention',
            'prisSurFait': 'prisSurFait',
            'accumulation': 'accumulation',
            'corveNettoyage': 'corveNettoyage',
            'naturalisation': 'naturalisation',
            'amenagement': 'amenagement',
            'pollutionOrganique': 'pollutionOrganique',
            'dechets': 'dechets',
            'artificialisation': 'artificialisation',
            'passageToutTerrain': 'passageToutTerrain',
            'deversement': 'deversement',
            'interdiction': 'interdiction',
            'politique': 'politique',
            'attestation': 'attestation',
            'ombleFontaine': 'ombleFontaine',
            'amenageSable': 'amenageSable',
            'amenageRapides': 'amenageRapides',
            'amenageFosse': 'amenageFosse',
            'amenageGalets': 'amenageGalets',
            'amenageGravier': 'amenageGravier',
            'amenageHerbace': 'amenageHerbace',
            'amenageArbustes': 'amenageArbustes',
            'amenageArbre': 'amenageArbre',
            'herbace': 'herbace',
            'arbustes': 'arbustes',
            'arbres': 'arbres'
        };
        var typeMacroEnum = {
            'annelide': 'annelide',
            'diptere': 'diptere',
            'coleoptere': 'coleoptere',
            'trichoptere': 'trichoptere',
            'ephemeroptere': 'ephemeroptere',
            'mollusque': 'mollusque',
            'odonate': 'odonate',
            'trichoptere': 'trichoptere',
            'plecoptere': 'plecoptere',
            'megaloptere': 'megaloptere',
            'hemiptere': 'hemiptere',
            'crustace': 'crustace'
        };
        //TODO: À la fin du tour, si le joueur ne peut pas restaurer un habitat perturbé, les macro qui s'en servent meurt.
        //TODO: Lorsque l'on supprime une carte ou échange, modifier le nombre d'exemplaire.

        //Tableau contenant l'âge des joueurs.
        var ageJoueur;
        //Tableau contenant les noms des joueurs.
        var nomJoueur;
        //Tableau contenant les points des joueurs.
        var pointsJoueur;
        //Tableau contenant les effets de Pris sur le fait.
        var tableauProtege;
        //Niveau de difficulté de la partie
        var difficulte;
        //Paquet de carte principal.
        var paquetCarte;
        //Paquet de carte de la décharge
        var paquetDecharge;
        /*-----------------------------Partie tableau de données---------------*/
        //Tableau contenant les mains.
        var mains;
        //Tableau contenant toute les cartes du bas de chaque joueur.
        var carteBas;
        //Tableau contenant le nombres d'exemplaire de chaque carte.
        var exemplaireCarteBas;
        //Tableau contenant les position des cartes perturbation.
        var cartePerturbation;
        //Tableau pour savoir si le joueur garder ses points ressources.
        var tableauRetention;
        //Tableau contenant les points de ressources.
        var pointsRessourcesBase;
        var pointsRessourcesSuplementaire;
        var pointsRessourcesTotal;
        var pointsRessourcesUtiliser;
        var pointsRessourcesRestant;
        //Numero du joueur présentement actif.
        var numeroJoueurActif;
        //Variable comptant le nombre de tour.
        var tour;
        //Variable content le nb de clic sur le bouton Passer son tour
        var facteurRotation;
        //Variable de la carte qui sera transférer de la main à la zone du bas, ou ailleurs.
        var carteDrag;
        //Variable du numero de la carte dans la main pour pouvoir le supprimer facilement lorsqu'on le drop à quelque part.
        var carteDragNumero;
        //Variable qui contient le nombre de joueur.
        var nombreJoueur;
        //Variable qui nous dira si nous sommes en train de manger.
        var onMangeAtableCeSoir;
        //Variable qui stock la taille.
        var taillePredateur;
        //Vairable qui dits si un déversement va avoir lieu.
        var deversement;
        var tempsDeversement;
        var numeroJoueurDeversement;
        //Variable qui dits si on est en pleine pollution organique.
        var onPollu;
        var nombrePolluer;
        //Variable pour erosion.
        var erosion;
        //Variable pour prédation.
        var predation;
        var etapePredation;

        //Fonction appeler au début, elle "start" le jeu.
        function startGame() {
            valeurDepartVariable();//Donne les valeurs de départs à nos variables.
            instantierTableaux();//Instantie tout les tableaux.
            instantierPaquetCarte();//Crée le paquet de carte de départ.
            updateJeu();
            creerElementFond();//Crée touts les éléments du jeu.
            updateAffichageImage();
        }

        //Fonction qui donne les valeurs de départs à nos variables.
        function valeurDepartVariable() {
            numeroJoueurActif = 0;
            tour = 0;
            facteurRotation = 0;
            onMangeAtableCeSoir = false;
            deversement = false;
            nombrePolluer = 0;
            predation = false;
            etape = 1;
            cartePerturbation = new Array(4);
            cartePerturbation[0] = new Array(10);
            cartePerturbation[1] = new Array(10);
            cartePerturbation[2] = new Array(10);
            cartePerturbation[3] = new Array(10);
        }

        //Fonction qui va créer les diverse éléments du fond.
        function creerElementFond() {
            creerFond();
            creerEmplacementsPlateau();
            calculerPoints();
            creerPartieDroite();
            creerMain();
            instantierDivErreur();
            instantierDivDebutTour();
            instantierDivChoixMultiple();
        }

        //Fonction qui s'occupe de créer le paquet de carte et de le mélanger au début de la partie.
        function instantierPaquetCarte() {
            paquetCarte = creerPaquetCarte(difficulte);
            melangerPaquetCarte(paquetCarte);
            remplirMain();
        }

        //Fonction qui appelle les fonctions qui instantie les différents tableaux.
        function instantierTableaux() {
            instantierTableauJoueur();
            instantierTableauEmplacementBas();
            instantierTableauPointsRessources();
            instantierTableauExemplaire();
            paquetDecharge = new Array();
            pointsJoueur = new Array(6);
            tableauProtege = new Array(nombreJoueur);
            tableauRetention = new Array(nombreJoueur);
        }

        //Fonction qui envoie vers les options de création de partie.
        function commencerNouvellePartie() {
            if (verifierConditionCreationPartie() === '') {
                $('#menuCreerPartie').remove();
                startGame();
            }
            else {
                $('#labelErreur').css('color', 'red');
                $('#labelErreur').html('<p></p>' + verifierConditionCreationPartie());
            }
        }

        //Fonction qui va vérifier les conditions des champs lors de la création d'une nouvelle partie.
        function verifierConditionCreationPartie() {
            var retour;

            if ($('#dropDownNombreJoueur').val() === '2') {
                if ($('#nomJoueurA').val() != '' && $('#nomJoueurB').val() != '') {
                    if ($('#ageJoueurA').val() != '' && $('#ageJoueurB').val() != '') {
                        entrerValeurCreationPartie();
                        return '';
                    }
                    else {
                        retour = 'Veuillez entrer l\'age de chacun des joueurs.';
                        return retour;
                    }
                }
                else {
                    retour = 'Veuillez entrer un nom pour chacun des joueurs.';
                    return retour;
                }
            }
            else if ($('#dropDownNombreJoueur').val() === '3') {
                if ($('#nomJoueurA').val() != '' && $('#nomJoueurB').val() != '' && $('#nomJoueurC').val() != '') {
                    if ($('#ageJoueurA').val() != '' && $('#ageJoueurB').val() != '' && $('#ageJoueurC').val() != '') {
                        entrerValeurCreationPartie();
                        return '';
                    }
                    else {
                        retour = 'Veuillez entrer l\'age de chacun des joueurs.';
                        return retour;
                    }
                }
                else {
                    retour = 'Veuillez entrer un nom pour chacun des joueurs.';
                    return retour;
                }
            }
            else if ($('#dropDownNombreJoueur').val() === '4') {
                if ($('#nomJoueurA').val() != '' && $('#nomJoueurB').val() && $('#nomJoueurC').val() != '' && $('#nomJoueurD').val() != '') {
                    if ($('#ageJoueurA').val() != '' && $('#ageJoueurB').val() != '' && $('#ageJoueurC').val() != '' && $('#ageJoueurD').val() != '') {
                        entrerValeurCreationPartie();
                        return '';
                    }
                    else {
                        retour = 'Veuillez entrer l\'age de chacun des joueurs.';
                        return retour;
                    }
                }
                else {
                    retour = 'Veuillez entrer un nom pour chacun des joueurs.';
                    return retour;
                }
            }
            else {
                retour = 'Veuillez entrer un nombre de joueur.';
                return retour;
            }
        }

        //Fonction qui va entrer les valeurs de créations de partie dans les variables.
        function entrerValeurCreationPartie() {
            nomJoueur = new Array();
            ageJoueur = new Array();
            pointsJoueur = new Array();

            difficulte = $('#dropDownDifficulte').val();

            if ($('#dropDownNombreJoueur').val() >= '2') {
                nombreJoueur = 2;
                nomJoueur[0] = $('#nomJoueurA').val();
                nomJoueur[1] = $('#nomJoueurB').val();
                ageJoueur[0] = $('#ageJoueurA').val();
                ageJoueur[1] = $('#ageJoueurB').val();
                pointsJoueur[0] = 0;
                pointsJoueur[1] = 0;
            }
            if ($('#dropDownNombreJoueur').val() >= '3') {
                nombreJoueur = 3;
                nomJoueur[2] = $('#nomJoueurC').val();
                ageJoueur[2] = $('#ageJoueurC').val();
                pointsJoueur[2] = 0;
            }
            if ($('#dropDownNombreJoueur').val() >= '4') {
                nombreJoueur = 4;
                nomJoueur[3] = $('#nomJoueurD').val();
                ageJoueur[3] = $('#ageJoueurD').val();
                pointsJoueur[3] = 0;
            }
        }

        //Fonction qui commence la partie.
        function lancerOptionPartie() {
            $('#menuPrincipal').remove();
            menuCreerPartie();
        }

        //Fonction qui affiche l'écran d'introduction.
        function menuPrincipal() {
            $('#menuCreerPartie').remove();
            var menuPrincipal = document.createElement('div');
            menuPrincipal.id = 'menuPrincipal';
            menuPrincipal.className = 'menuPrincipal';
            menuPrincipal.innerHTML = '<img class="imageMenuPrincipal" src="ressources/logo.png" />';
            $('body').append(menuPrincipal);

            var buttonNouvellePartie = document.createElement('button');
            buttonNouvellePartie.id = 'buttonNouvellePartie';
            buttonNouvellePartie.className = 'buttonMenuPrincipal';
            buttonNouvellePartie.innerHTML = 'Nouvelle partie';
            buttonNouvellePartie.onclick = lancerOptionPartie;
            buttonNouvellePartie.style.bottom = '215px';
            $('#menuPrincipal').append(buttonNouvellePartie);

            var buttonChargerPartie = document.createElement('button');
            //buttonChargerPartie.type = 'file'
            buttonChargerPartie.id = 'buttonChargerPartie';
            buttonChargerPartie.className = 'buttonMenuPrincipal';
            buttonChargerPartie.innerHTML = 'Charger une partie';
            buttonChargerPartie.style.bottom = '155px';
            //buttonChargerPartie.onclick = chargerPartie;
            $('#menuPrincipal').append(buttonChargerPartie);

            var buttonOptions = document.createElement('button');
            buttonOptions.id = 'buttonOptions';
            buttonOptions.className = 'buttonMenuPrincipal';
            buttonOptions.innerHTML = 'Options';
            buttonOptions.style.bottom = '95px';
            $('#menuPrincipal').append(buttonOptions);

            var buttonCredits = document.createElement('button');
            buttonCredits.id = 'buttonCredits';
            buttonCredits.className = 'buttonMenuPrincipal';
            buttonCredits.innerHTML = 'Crédits';
            buttonCredits.style.bottom = '35px';
            $('#menuPrincipal').append(buttonCredits);
        }

        //Fonction qui affiche l'écran de création de partie.
        function menuCreerPartie() {
            var menuCreerPartie = document.createElement('div');
            menuCreerPartie.id = 'menuCreerPartie';
            menuCreerPartie.className = 'menuCreerPartie';
            //menuCreerPartie.innerHTML = '<img class="imageMenuCreerPartie" src="ressources/cartes.png" />';
            $('body').append(menuCreerPartie);

            //Section contre des vrais joueurs
            var divContreVJ = document.createElement('div');
            divContreVJ.id = 'divContreVJ';
            divContreVJ.className = 'divContreVJ';
            $(menuCreerPartie).append(divContreVJ);

            var labelTexteNombreJoueur = document.createElement('label');
            labelTexteNombreJoueur.id = 'labelTexteNombreJoueur';
            labelTexteNombreJoueur.className = 'labelTexteNombreJoueur';
            labelTexteNombreJoueur.innerHTML = 'Nombre de joueur : ';
            $(divContreVJ).append(labelTexteNombreJoueur);

            var dropDownNombreJoueur = document.createElement('select');
            dropDownNombreJoueur.id = 'dropDownNombreJoueur';
            dropDownNombreJoueur.className = 'dropDown';
            $(divContreVJ).append(dropDownNombreJoueur);
            var option1 = document.createElement('option');
            option1.value = '0';
            option1.innerHTML = '';
            dropDownNombreJoueur.appendChild(option1);
            var option2 = document.createElement('option');
            option2.value = '2';
            option2.innerHTML = '2';
            dropDownNombreJoueur.appendChild(option2);
            var option3 = document.createElement('option');
            option3.value = '3';
            option3.innerHTML = '3';
            dropDownNombreJoueur.appendChild(option3);
            var option4 = document.createElement('option');
            option4.value = '4';
            option4.innerHTML = '4';
            dropDownNombreJoueur.appendChild(option4);
            $(function () {
                $(dropDownNombreJoueur).on({
                    change: function () {
                        $(divJoueurA).hide();
                        $(divJoueurB).hide();
                        $(divJoueurC).hide();
                        $(divJoueurD).hide();

                        if (this.value === '2') {
                            $(divJoueurA).show();
                            $(divJoueurB).show();
                        }
                        else if (this.value === '3') {
                            $(divJoueurA).show();
                            $(divJoueurB).show();
                            $(divJoueurC).show();
                        }
                        else if (this.value === '4') {
                            $(divJoueurA).show();
                            $(divJoueurB).show();
                            $(divJoueurC).show();
                            $(divJoueurD).show();
                        }
                    }
                });
            });

            //Div Joueur A
            var divJoueurA = document.createElement('div');
            divJoueurA.id = 'divJoueurA';
            divJoueurA.className = 'divJoueurs';
            $(divContreVJ).append(divJoueurA);

            var labelJoueurA = document.createElement('label');
            labelJoueurA.id = 'labelJoueurA';
            labelJoueurA.className = 'labelTitreJoueur';
            labelJoueurA.innerHTML = 'Joueur A';
            $(divJoueurA).append(labelJoueurA);

            var labelNomJoueurA = document.createElement('label');
            labelNomJoueurA.id = 'labelNomJoueurA';
            labelNomJoueurA.className = 'labelJoueur';
            labelNomJoueurA.innerHTML = 'Nom : ';
            $(divJoueurA).append(labelNomJoueurA);

            var nomJoueurA = document.createElement('input');
            nomJoueurA.type = 'text';
            nomJoueurA.id = 'nomJoueurA';
            nomJoueurA.className = 'textBoxJoueur';
            $(divJoueurA).append(nomJoueurA);

            var labelAgeJoueurA = document.createElement('label');
            labelAgeJoueurA.id = 'labelAgeJoueurA';
            labelAgeJoueurA.className = 'labelJoueur';
            labelAgeJoueurA.innerHTML = 'Âge : ';
            $(divJoueurA).append(labelAgeJoueurA);

            var ageJoueurA = document.createElement('input');
            ageJoueurA.type = 'text';
            ageJoueurA.id = 'ageJoueurA';
            ageJoueurA.className = 'textBoxJoueur';
            $(divJoueurA).append(ageJoueurA);

            //Div Joueur B
            var divJoueurB = document.createElement('div');
            divJoueurB.id = 'divJoueurB';
            divJoueurB.className = 'divJoueurs';
            $(divContreVJ).append(divJoueurB);

            var labelJoueurB = document.createElement('label');
            labelJoueurB.id = 'labelJoueurB';
            labelJoueurB.className = 'labelTitreJoueur';
            labelJoueurB.innerHTML = 'Joueur B';
            $(divJoueurB).append(labelJoueurB);

            var labelNomJoueurB = document.createElement('label');
            labelNomJoueurB.id = 'labelNomJoueurB';
            labelNomJoueurB.className = 'labelJoueur';
            labelNomJoueurB.innerHTML = 'Nom : ';
            $(divJoueurB).append(labelNomJoueurB);

            var nomJoueurB = document.createElement('input');
            nomJoueurB.type = 'text';
            nomJoueurB.id = 'nomJoueurB';
            nomJoueurB.className = 'textBoxJoueur';
            $(divJoueurB).append(nomJoueurB);

            var labelAgeJoueurB = document.createElement('label');
            labelAgeJoueurB.id = 'labelAgeJoueurB';
            labelAgeJoueurB.className = 'labelJoueur';
            labelAgeJoueurB.innerHTML = 'Âge : ';
            $(divJoueurB).append(labelAgeJoueurB);

            var ageJoueurB = document.createElement('input');
            ageJoueurB.type = 'text';
            ageJoueurB.id = 'ageJoueurB';
            ageJoueurB.className = 'textBoxJoueur';
            $(divJoueurB).append(ageJoueurB);

            //Div Joueur C
            var divJoueurC = document.createElement('div');
            divJoueurC.id = 'divJoueurC';
            divJoueurC.className = 'divJoueurs';
            $(divContreVJ).append(divJoueurC);

            var labelJoueurC = document.createElement('label');
            labelJoueurC.id = 'labelJoueurC';
            labelJoueurC.className = 'labelTitreJoueur';
            labelJoueurC.innerHTML = 'Joueur C';
            $(divJoueurC).append(labelJoueurC);

            var labelNomJoueurC = document.createElement('label');
            labelNomJoueurC.id = 'labelNomJoueurC';
            labelNomJoueurC.className = 'labelJoueur';
            labelNomJoueurC.innerHTML = 'Nom : ';
            $(divJoueurC).append(labelNomJoueurC);

            var nomJoueurC = document.createElement('input');
            nomJoueurC.type = 'text';
            nomJoueurC.id = 'nomJoueurC';
            nomJoueurC.className = 'textBoxJoueur';
            $(divJoueurC).append(nomJoueurC);

            var labelAgeJoueurC = document.createElement('label');
            labelAgeJoueurC.id = 'labelAgeJoueurC';
            labelAgeJoueurC.className = 'labelJoueur';
            labelAgeJoueurC.innerHTML = 'Âge : ';
            $(divJoueurC).append(labelAgeJoueurC);

            var ageJoueurC = document.createElement('input');
            ageJoueurC.type = 'text';
            ageJoueurC.id = 'ageJoueurC';
            ageJoueurC.className = 'textBoxJoueur';
            $(divJoueurC).append(ageJoueurC);

            //Div Joueur D
            var divJoueurD = document.createElement('div');
            divJoueurD.id = 'divJoueurD';
            divJoueurD.className = 'divJoueurs';
            $(divContreVJ).append(divJoueurD);


            var labelJoueurD = document.createElement('label');
            labelJoueurD.id = 'labelJoueurD';
            labelJoueurD.className = 'labelTitreJoueur';
            labelJoueurD.innerHTML = 'Joueur D';
            $(divJoueurD).append(labelJoueurD);

            var labelNomJoueurD = document.createElement('label');
            labelNomJoueurD.id = 'labelNomJoueurD';
            labelNomJoueurD.className = 'labelJoueur';
            labelNomJoueurD.innerHTML = 'Nom : ';
            $(divJoueurD).append(labelNomJoueurD);

            var nomJoueurD = document.createElement('input');
            nomJoueurD.type = 'text';
            nomJoueurD.id = 'nomJoueurD';
            nomJoueurD.className = 'textBoxJoueur';
            $(divJoueurD).append(nomJoueurD);

            var labelAgeJoueurD = document.createElement('label');
            labelAgeJoueurD.id = 'labelAgeJoueurD';
            labelAgeJoueurD.className = 'labelJoueur';
            labelAgeJoueurD.innerHTML = 'Âge : ';
            $(divJoueurD).append(labelAgeJoueurD);

            var ageJoueurD = document.createElement('input');
            ageJoueurD.type = 'text';
            ageJoueurD.id = 'ageJoueurD';
            ageJoueurD.className = 'textBoxJoueur';
            $(divJoueurD).append(ageJoueurD);

            $(divJoueurA).hide();
            $(divJoueurB).hide();
            $(divJoueurC).hide();
            $(divJoueurD).hide();

            //Zone choix de difficulté
            var divDifficulte = document.createElement('div');
            divDifficulte.id = 'divDifficulte';
            divDifficulte.className = 'divDifficulte';
            $(menuCreerPartie).append(divDifficulte);

            var labelTexteDifficulte = document.createElement('label');
            labelTexteDifficulte.id = 'labelTexteDifficulte';
            labelTexteDifficulte.className = 'labelTexteDifficulte';
            labelTexteDifficulte.innerHTML = 'Difficulté de la partie : ';
            $(divDifficulte).append(labelTexteDifficulte);

            var dropDownDifficulte = document.createElement('select');
            dropDownDifficulte.id = 'dropDownDifficulte';
            dropDownDifficulte.className = 'dropDown';
            $(divDifficulte).append(dropDownDifficulte);
            var option1 = document.createElement('option');
            option1.value = '1';
            option1.innerHTML = 'Facile';
            dropDownDifficulte.appendChild(option1);
            var option2 = document.createElement('option');
            option2.value = '2';
            option2.innerHTML = 'Moyen';
            dropDownDifficulte.appendChild(option2);
            var option3 = document.createElement('option');
            option3.value = '3';
            option3.innerHTML = 'Difficile';
            dropDownDifficulte.appendChild(option3);

            var labelErreur = document.createElement('label');
            labelErreur.className = 'labelErreur';
            labelErreur.id = 'labelErreur';
            $(menuCreerPartie).append(labelErreur);

            var buttonDebuter = document.createElement('button');
            buttonDebuter.id = 'buttonDebuter';
            buttonDebuter.className = 'buttonMenuPrincipal';
            buttonDebuter.innerHTML = 'Débuter';
            buttonDebuter.style.bottom = '95px';
            buttonDebuter.onclick = commencerNouvellePartie;
            $(menuCreerPartie).append(buttonDebuter);

            var buttonRetour = document.createElement('button');
            buttonRetour.id = 'buttonRetour';
            buttonRetour.className = 'buttonMenuPrincipal';
            buttonRetour.innerHTML = 'Retour';
            buttonRetour.style.bottom = '35px';
            buttonRetour.onclick = menuPrincipal;
            $(menuCreerPartie).append(buttonRetour);
        }

        //function chargerPartie() {
        //var charger = $('#buttonChargerPartie');
        //upclick({
        //    element: charger,
        //    action: '/',
        //    onstart: function (filename) {
        //        alert('Start Upload:' + filename);
        //    },
        //    oncomplete: function (response_data) {
        //        alert(response_data);
        //    }
        //});
        //}

        //Fonction appelé lors d'un clic sur le bouton Options en jeu
        function ouvrirOptionsEnJeu() {
            var divOptions = document.createElement('div');
            divOptions.id = 'divOptions';
            divOptions.className = 'divOptions';
            $('#plateau').append(divOptions);

            var divTitreOptions = document.createElement('div');
            divTitreOptions.id = 'divTitreOptions';
            divTitreOptions.className = 'divTitreOptions';
            divTitreOptions.innerHTML = '<p>Options</p>';
            divOptions.appendChild(divTitreOptions);

            var labelResolution = document.createElement('label');
            labelResolution.id = 'labelResolution';
            labelResolution.className = 'labelResolution';
            labelResolution.innerHTML = '<span>Résolution : </span>'
            divOptions.appendChild(labelResolution);

            var dropDownReso = document.createElement('select');
            dropDownReso.id = 'dropDownReso';
            dropDownReso.className = 'dropDownReso';
            divOptions.appendChild(dropDownReso);
            var option1 = document.createElement('option');
            option1.value = '1';
            option1.innerHTML = '1280 x 720';
            dropDownReso.appendChild(option1);

            var labelPopUp = document.createElement('label');
            labelPopUp.id = 'labelPopUp';
            labelPopUp.className = 'labelPopUp';
            labelPopUp.innerHTML = '<span>Activé les pop-ups éducatifs : </span>'
            divOptions.appendChild(labelPopUp);

            var checkBoxPopUp = document.createElement('input');
            checkBoxPopUp.type = 'checkbox';
            checkBoxPopUp.id = 'checkBoxPopUp';
            checkBoxPopUp.value = 'PopUpActif';
            checkBoxPopUp.className = 'checkBoxPopUp';
            divOptions.appendChild(checkBoxPopUp);

            $(divOptions).dialog({
                classes: {
                    'ui-dialog': 'no-close ui-corner-all',
                },
                draggable: false,
                resizable: false,
                buttons: [{
                    text: 'Valider',
                }, {
                    text: 'Annuler',
                    click: function () {
                        $(this).dialog('close');
                    }
                }],
                height: 300,
                width: 400,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction qui va instantier et remplir le tableau des points de ressources.
        function instantierTableauPointsRessources() {
            pointsRessourcesBase = new Array(nombreJoueur);
            pointsRessourcesBase[0] = 6;
            pointsRessourcesBase[1] = 6;
            pointsRessourcesRestant = new Array(nombreJoueur);
            pointsRessourcesSuplementaire = new Array(nombreJoueur);
            pointsRessourcesTotal = new Array(nombreJoueur);
            pointsRessourcesUtiliser = new Array(nombreJoueur);

            if (nombreJoueur >= 3) {
                pointsRessourcesBase[2] = 6;
            }
            if (nombreJoueur === 4) {
                pointsRessourcesBase[3] = 6;
            }
        }

        //Fonction qui va instantier le tableau bi-dimensionel de mains.
        function instantierTableauJoueur() {
            mains = new Array(nombreJoueur);

            //Minimum de 2 joueurs.
            mains[0] = [];
            mains[1] = [];

            if (nombreJoueur >= 3) {//3 joueurs.
                mains[2] = [];
            }
            if (nombreJoueur === 4) {//4 joueurs.
                mains[3] = [];
            }
        }

        //Fonction qui va instantier le tableau des exemplaire du bas.
        function instantierTableauExemplaire() {
            exemplaireCarteBas = new Array(nombreJoueur);
            exemplaireCarteBas[0] = new Array(6);
            exemplaireCarteBas[1] = new Array(6);

            if (nombreJoueur >= 3) {
                exemplaireCarteBas[2] = new Array(6);
            }
            if (nombreJoueur === 4) {
                exemplaireCarteBas[3] = new Array(6);
            }
        }

        //Fonction qui va instantier le tableau bi-dimensionel d'emplacement bas.
        function instantierTableauEmplacementBas() {
            carteBas = new Array(4);

            //Minimum de 2 joueurs.
            carteBas[0] = new Array(10);
            carteBas[1] = new Array(10);

            if (nombreJoueur >= 3) {//3 joueurs.
                carteBas[2] = new Array(10);
            }
            if (nombreJoueur === 4) {//4 joueurs.
                carteBas[3] = new Array(10);
            }
        }

        //Fonction qui creer la div qui servira pour les pop-ups d'erreur.
        function instantierDivErreur() {
            var divErreur = document.createElement('div');
            divErreur.id = 'divErreur';
            divErreur.className = 'divErreur';
            $('#plateau').append(divErreur);

            var divTexteErreur = document.createElement('div');
            divTexteErreur.id = 'divTexteErreur';
            divTexteErreur.className = 'divTexteErreur';
            $('#divErreur').append(divTexteErreur);
        }

        //Fonction qui creer la div qui servira pour les pop-ups de début de tour.
        function instantierDivDebutTour() {
            var divDebutTour = document.createElement('div');
            divDebutTour.id = 'divDebutTour';
            divDebutTour.className = 'divDebutTour';
            $('#plateau').append(divDebutTour);

            var divTexteDebutTour = document.createElement('div');
            divTexteDebutTour.id = 'divTexteDebutTour';
            divTexteDebutTour.className = 'divTexteDebutTour';
            $('#divDebutTour').append(divTexteDebutTour);
        }

        //Fonction qui creer la div qui servira pour les pop-ups de choix multiples.
        function instantierDivChoixMultiple() {
            var divChoixMultiple = document.createElement('div');
            divChoixMultiple.id = 'divChoixMultiple';
            divChoixMultiple.className = 'divChoixMultiple';
            $('#plateau').append(divChoixMultiple);

            var divTexteChoixMultiple = document.createElement('div');
            divTexteChoixMultiple.id = 'divTexteChoixMultiple';
            divTexteChoixMultiple.className = 'divTexteChoixMultiple';
            $('#divChoixMultiple').append(divTexteChoixMultiple);
        }

        //Fonction qui vérifie si le macroInvertebre ou le salmonide est jouable.
        function verifierCondition(carte) {
            if (carte.condition.length === 1) {
                if (carte.condition[0] === '?') {
                    for (var i = 0; i < 10; i++) {
                        if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                            if ((carteBas[numeroJoueurActif][i].type === typeEnum.habitats && !carteBas[numeroJoueurActif][i].perturber) || carteBas[numeroJoueurActif][i].type === typeEnum.intervention) {// Si la carte est une habitats.
                                return true;
                            }
                        }
                    }
                }

                var condition1 = carte.condition[0];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if ((carteBas[numeroJoueurActif][i].type === typeEnum.habitats && !carteBas[numeroJoueurActif][i].perturber) || carteBas[numeroJoueurActif][i].type === typeEnum.intervention) {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition.
                                return true;
                            }
                        }
                    }
                }
            }
            else if (carte.condition.length === 2) {
                var condition1 = carte.condition[0];
                var condition2 = carte.condition[1];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if ((carteBas[numeroJoueurActif][i].type === typeEnum.habitats && !carteBas[numeroJoueurActif][i].perturber) || carteBas[numeroJoueurActif][i].type === typeEnum.intervention) {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition1.
                                condition1 = 'ok';
                            } else if (carteBas[numeroJoueurActif][i].habitats === condition2) {//Si l'habitats de la carte est la meme que la condition2.
                                condition2 = 'ok';
                            }
                        }
                    }
                }

                if (condition1 === 'ok' && condition2 === 'ok') {
                    return true;
                }
            }
            else if (carte.condition.length === 3) {
                var condition1 = carte.condition[0];
                var condition2 = carte.condition[1];
                var condition3 = carte.condition[2];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if ((carteBas[numeroJoueurActif][i].type === typeEnum.habitats && !carteBas[numeroJoueurActif][i].perturber) || carteBas[numeroJoueurActif][i].type === typeEnum.intervention) {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition1.
                                condition1 = 'ok';
                            } else if (carteBas[numeroJoueurActif][i].habitats === condition2) {//Si l'habitats de la carte est la meme que la condition2.
                                condition2 = 'ok';
                            } else if (carteBas[numeroJoueurActif][i].habitats === condition3) {//Si l'habitats de la carte est la meme que la condition3.
                                condition3 = 'ok';
                            }
                        }
                    }
                }

                if (condition1 === 'ok' && condition2 === 'ok' && condition3 === 'ok') {
                    return true;
                }
            } else if (carte.condition.length === 4) {
                var condition1 = carte.condition[0];
                var condition2 = carte.condition[1];
                var condition3 = carte.condition[2];
                var condition4 = carte.condition[3];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if ((carteBas[numeroJoueurActif][i].type === typeEnum.habitats && !carteBas[numeroJoueurActif][i].perturber) || carteBas[numeroJoueurActif][i].type === typeEnum.intervention) {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition1.
                                condition1 = 'ok';
                            } else if (carteBas[numeroJoueurActif][i].habitats === condition2) {//Si l'habitats de la carte est la meme que la condition2.
                                condition2 = 'ok';
                            } else if (carteBas[numeroJoueurActif][i].habitats === condition3) {//Si l'habitats de la carte est la meme que la condition3.
                                condition3 = 'ok';
                            } else if (carteBas[numeroJoueurActif][i].habitats === condition4) {//Si l'habitats de la carte est la meme que la condition4.
                                condition4 = 'ok';
                            }
                        }
                    }
                }

                if (condition1 === 'ok' && condition2 === 'ok' && condition3 === 'ok' && condition4 === 'ok') {
                    return true;
                }
            } else {
                return false;
            }
        }

        //Fonction qui sera fréquement appeler pour ré-emplir la main.
        function remplirMain() {
            if (tour === 0) {//Avant de commencer, remplie toutes les mains.
                //Première carte c'est un habitats rapides.
                mains[0][0] = chercherCarteParticuliere(nomEnum.rapides, paquetCarte);
                mains[1][0] = chercherCarteParticuliere(nomEnum.rapides, paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][0] = chercherCarteParticuliere(nomEnum.rapides, paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][0] = chercherCarteParticuliere(nomEnum.rapides, paquetCarte);
                }

                //Deuxième carte c'est un habitats au hasard.
                mains[0][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);
                mains[1][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);
                }

                //3e carte
                mains[0][2] = pigerCarte(paquetCarte);
                mains[1][2] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][2] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][2] = pigerCarte(paquetCarte);
                }

                //4e carte
                mains[0][3] = pigerCarte(paquetCarte);
                mains[1][3] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][3] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][3] = pigerCarte(paquetCarte);
                }

                //5e carte
                mains[0][4] = pigerCarte(paquetCarte);
                mains[1][4] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][4] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][4] = pigerCarte(paquetCarte);
                }

                //6e carte
                mains[0][5] = pigerCarte(paquetCarte);
                mains[1][5] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][5] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][5] = pigerCarte(paquetCarte);
                }
            } else {
                //Boucle pour toute les position de la main.
                for (var i = 0; i < mains[numeroJoueurActif].length; i++) {
                    if (mains[numeroJoueurActif][i] === null) {
                        annimationPigerCarte(i);
                    }
                }
            }
        }

        //Fonction qui renvoie une string d'un habitats au hasard pour permettre qu'on aille la chercher au début de la partie.
        function habitatsHasard() {
            var habitatsRetourner;//Habitats qui sera retourner.

            //Variable qui contiendra le nombres de chaque habitats qui sont présentement dans le paquet de carte.
            var nombreHabitats = 0;
            var nombreFosse = 0;
            var nombreRapides = 0;
            var nombreSable = 0;
            var nombreGravier = 0;
            var nombreGalets = 0;

            for (var i = 0; i < paquetCarte.length ; i++) {
                if (paquetCarte[i].nom === nomEnum.fosse) {
                    nombreFosse++;
                    nombreHabitats++;
                } else if (paquetCarte[i].nom === nomEnum.sable) {
                    nombreSable++;
                    nombreHabitats++;
                } else if (paquetCarte[i].nom === nomEnum.gravier) {
                    nombreGravier++;
                    nombreHabitats++;
                } else if (paquetCarte[i].nom === nomEnum.rapides) {
                    nombreRapides++;
                    nombreHabitats++;
                } else if (paquetCarte[i].nom === nomEnum.galets) {
                    nombreGalets++;
                    nombreHabitats++;
                }
            }

            //math.random qui décidera qu'elle habitats on retourne. Elle envoie un chiffre au hasard entre 1 et le nombre d'habitats.
            var nombreHasard;
            nombreHasard = Math.floor((Math.random() * nombreHabitats) + 1);

            //Tout les if pour savoir c'est qu'elle habitats, Toujours plus petit que l'habitats et plus grand que l'ancien habitats.
            if (nombreHasard <= nombreFosse) {
                habitatsRetourner = nomEnum.fosse;
            } else if (nombreHasard <= nombreFosse + nombreSable && nombreHasard > nombreFosse) {
                habitatsRetourner = nomEnum.sable;
            } else if (nombreHasard <= nombreFosse + nombreSable + nombreGravier && nombreHasard > nombreFosse + nombreSable) {
                habitatsRetourner = nomEnum.gravier;
            } else if (nombreHasard <= nombreFosse + nombreSable + nombreGravier + nombreRapides && nombreHasard > nombreFosse + nombreSable + nombreGravier) {
                habitatsRetourner = nomEnum.rapides;
            } else if (nombreHasard <= nombreFosse + nombreSable + nombreGravier + nombreRapides + nombreGalets && nombreHasard > nombreFosse + nombreSable + nombreGravier + nombreRapides) {
                habitatsRetourner = nomEnum.galets;
            }

            return habitatsRetourner;
        }

        //Fonction qui appelle le timer
        function annimationPigerCarte(i) {
            var carte = pigerCarte(paquetCarte);
            mains[numeroJoueurActif][i] = carte;
            setTimeout(function () {
                animationPige(carte, i);
            }, 500);
        }

        //Fonction qui permet de chercher une carte en particulier.
        function chercherCarteParticuliere(nomCarte) {
            var carteRetours

            //Boucle dans tout le paquet de cartes à la recherche de la bonne carte.
            for (var i = 0; i < paquetCarte.length; i++) {
                if (paquetCarte[i].nom === nomCarte) {

                    carteRetour = paquetCarte[i];

                    //Code qui change la valeur i avec la première valeur pour pouvoir faire un array.shift().
                    var valeurEnregistrer = paquetCarte[0];
                    paquetCarte[0] = paquetCarte[i];
                    paquetCarte[i] = valeurEnregistrer;

                    //Retire la carte sur le dessus
                    paquetCarte.shift();

                    //Re-mélange le paquet de carte puisqu'on viens d'enlever une carte particuliere en plein millieu.
                    melangerPaquetCarte(paquetCarte);
                    return carteRetour;
                }
            }
        }

        //Fonction qui ajoute la partie de droite.
        function creerPartieDroite() {
            var divNomJoueurs = document.createElement('div');
            divNomJoueurs.id = 'divNomJoueurs';
            divNomJoueurs.className = 'divNomJoueurs';
            //TODO: Nous devrions grossir la 'box' ou qu'il y a les noms si il y a quatre équipe ou 3 et faire en sorte que
            //      les équipes soit toujours écrite l'une en dessous de l'autre.
            if (nombreJoueur === 4) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + nomJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + nomJoueur[2] + '</li><li class=listeEquipe>Équipe D : ' + nomJoueur[3] + '</li></ul>';
            } else if (nombreJoueur === 3) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + nomJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + nomJoueur[2] + '</li></ul>';
            } else if (nombreJoueur === 2) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + nomJoueur[1] + '</li></ul>';
            } else if (nombreJoueur === 1) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li></ul>';
            }
            document.getElementById('divDroite').appendChild(divNomJoueurs);

            var divTextePointsRessource = document.createElement('div');
            divTextePointsRessource.id = 'divTextePointsRessource';
            divTextePointsRessource.className = 'divTextePointsRessource';
            divTextePointsRessource.innerHTML = '<p class=titreRessource>Points ressources de base : ' + pointsRessourcesBase[numeroJoueurActif] + '</p><p class=titreRessource>Points ressources additionnels : ' + pointsRessourcesSuplementaire[numeroJoueurActif] + '</p><p class=titreRessource>Points ressources total : ' + pointsRessourcesTotal[numeroJoueurActif] + '</p><p class=titreRessource>Points ressources utilisés : ' + pointsRessourcesUtiliser[numeroJoueurActif] + '</p><p class=titreRessource><strong>Points ressources restant : ' + pointsRessourcesRestant[numeroJoueurActif] + '</strong></p>';
            document.getElementById('divDroite').appendChild(divTextePointsRessource);

            var divTextePointsJoueurs = document.createElement('div');
            divTextePointsJoueurs.id = 'divTextePointsJoueurs';
            divTextePointsJoueurs.className = 'divTextePointsJoueurs';
            if (nombreJoueur === 4) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + pointsJoueur[2] + '</li><li class=listeEquipe>Équipe D : ' + pointsJoueur[3] + '</li></ul>';
            } else if (nombreJoueur === 3) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + pointsJoueur[2] + '</li></ul>';
            } else if (nombreJoueur === 2) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li></ul>';
            } else if (nombreJoueur === 1) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li></ul>';
            }
            document.getElementById('divDroite').appendChild(divTextePointsJoueurs);

            var buttonRegle = document.createElement('button');
            buttonRegle.id = 'buttonRegle';
            buttonRegle.className = 'buttonJeu';
            buttonRegle.setAttribute('onclick', 'popUpRegle()');
            buttonRegle.textContent = 'Voir les règles';
            $('#divDroite').append(buttonRegle);

            var buttonPasserTour = document.createElement('button');
            buttonPasserTour.id = 'buttonPasserTour';
            buttonPasserTour.className = 'buttonJeu';
            buttonPasserTour.setAttribute('onclick', 'passerTour()');
            buttonPasserTour.textContent = 'Passer son tour';
            document.getElementById('divDroite').appendChild(buttonPasserTour);

            var buttonOption = document.createElement('button');
            buttonOption.id = 'buttonOption';
            buttonOption.className = 'buttonJeu';
            buttonOption.textContent = 'Options';
            buttonOption.setAttribute('onclick', 'ouvrirOptionsEnJeu()');
            document.getElementById('divDroite').appendChild(buttonOption);
        }

        //Fonction qui sera appeler lors du clique sur une image. Si on est en mode échange cela va faire quelque choses.
        function onClickImage(event, ui) {
            var emplacement = event.substr(event.length - 2);
            var lettreEmplacement = emplacement.substr(0, 1);
            var numeroEmplacement = emplacement.substr(emplacement.length - 1);
            var numeroJoueurEnnemi = numeroJoueur(lettreEmplacement);

            if (onMangeAtableCeSoir) {
                if (carteBas[numeroJoueurEnnemi][numeroEmplacement].type = 'macroInvertebre') {
                    if (carteBas[numeroJoueurEnnemi][numeroEmplacement].taille < taillePredateur) {
                        onMangeAtableCeSoir = false;
                        $('#emplacementJoueur' + lettreEmplacement + numeroEmplacement).children().last().remove();
                        paquetDecharge.push(carteBas[numeroJoueurEnnemi][numeroEmplacement]);
                        carteBas[numeroJoueurEnnemi][numeroEmplacement] = null;
                        brillanceCarteMangeable(false);
                        $('#divDroite').css('pointer-events', 'auto');
                        $('#divMain').css('pointer-events', 'auto');
                        updateAffichageImage();

                    } else {
                        popUpAvertissement('Le macro-invertebrer doit être de taille inférieur à votre prédateur.')
                    }
                } else {
                    popUpAvertissement('Vous devez sélectionner un macro-invertebrer à manger.')
                }
            } else if (onPollu) {
                //TODO: Pour pollution organique, reste juste à augmenter le nombre de carte polluer et à rendre la carte habitats pollue.
            } else if (erosion === 1) {
                if (carteBas[numeroJoueurEnnemi][numeroEmplacement].type === 'bandeRiveraine') {
                    //TODO: faire le travaille.
                } else {
                    popUpAvertissement('Vous devez sélectionner une carte bande riveraine pour l\'emvoyer à la décharge.');
                }
            } else if (erosion === 2) {
                if (carteBas[numeroJoueurEnnemi][numeroEmplacement].type === 'bandeRiveraine') {
                    //TODO: faire le travaille.
                } else {
                    popUpAvertissement('Vous devez sélectionner une carte habitats pour la transformer en sable.');
                }
            } else if (predation) {
                if (etapePredation === 1) {
                    if (carteBas[numeroJoueurEnnemi][numeroEmplacement].type === 'macroInvertebre' || carteBas[numeroJoueurEnnemi][numeroEmplacement].type === 'salmonide') {
                        if (carteBas[numeroJoueurEnnemi][numeroEmplacement].predateur === 1 || carteBas[numeroJoueurEnnemi][numeroEmplacement].predateur === 2) {
                            taillePredateur = carteBas[numeroJoueurEnnemi][numeroEmplacement].taille;
                            etapePredation = 2;
                            brillanceCarteMangeable(true);
                            brillerCarte('macroInvertebre', numeroJoueurActif, false);
                        } else {
                            popUpAvertissement('Vous devez sélectionner un predateur qui mangera un autre macroinvertébrés.')
                        }
                    } else {
                        popUpAvertissement('Vous devez sélectionner un predateur qui mangera un autre macroinvertébrés.')
                    }
                } else if (etapePredation === 2) {
                    if (carteBas[numeroJoueurEnnemi][numeroEmplacement].type === 'macroInvertebre') {
                        if (carteBas[numeroJoueurEnnemi][numeroEmplacement].taille < taillePredateur) {
                            brillanceCarteMangeable(false);
                            etapePredation = 1;
                            predation = false;
                            $('#emplacementJoueur' + lettreEmplacement + numeroEmplacement).children().last().remove();
                            paquetDecharge.push(carteBas[numeroJoueurEnnemi][numeroEmplacement]);
                            carteBas[numeroJoueurEnnemi][numeroEmplacement] = null;
                            updateAffichageImage();
                        } else {
                            popUpAvertissement('Le macroinvertebre doit être de taille inférieur au prédateur.')
                        }
                    } else {
                        popUpAvertissement('Vous devez sélectionner un prédateur de taille inférieur pour qu\'il soit manger.');
                    }
                }
            }
        }

        //Fonction qui fais briller les carte d'un certain type pour le joueur donner.
        function brillerCarte(type, numero, brille) {
            var lettre = numeroJoueur(numero);

            if (brille) {
                for (var i = 0; i < 10; i++) {
                    if (carteBas[0][i] != null) {
                        if (carteBas[0][i].type === type.toString()) {
                            $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                        }
                    }
                }
            } else {
                for (var i = 0; i < 10; i++) {
                    $('#emplacementJoueur' + lettre + i).removeClass('ui-echange-highlight');
                }
            }
        }

        //Fonction qui retourne le premier emplacement libre ou on peut mettre une carte.
        function trouverPositionLibre(numero) {
            var lettreEmplacement = lettreJoueur(numero);

            for (var i = 0; i < 10; i++) {
                if ($('#emplacementJoueur' + lettreEmplacement + i).children().length === 0) {
                    return ('#emplacementJoueur' + lettreEmplacement + i);
                }
            }
        }

        //Fonction qui ajoute une div avec le plateau en fond d'écran.
        function creerFond() {
            //Partie de gauche.
            var divMain = document.createElement('div');
            divMain.id = 'divMain';
            divMain.className = 'divMain';
            $('body').append(divMain);

            //Partie du millieu.
            var plateau = document.createElement('div');
            plateau.id = 'plateau';
            plateau.className = 'plateau';
            $('body').append(plateau);
            $(plateau).droppable({
                tolerance: 'pointer',
                drop: function (event, ui) {
                    if (bonneZoneDrop(event.target)) {//Si l'endroits que nous voulons droper est à la bonne place.
                        if (accepterDrop(event.target)) {
                            if (carteDrag.nom === 'deversement' || carteDrag.nom === 'erosion' || carteDrag.nom === 'pollutionOrganique' || carteDrag.type === 'speciale' || carteDrag.type === 'action') {
                                if (carteDrag.nom === 'deversement') {
                                    supprimerCartePrecise(carteDragNumero);
                                    paquetDecharge.push(carteDrag);
                                    deversement = true;
                                    tempsDeversement = 2;
                                    numeroJoueurDeversement = numeroJoueurActif;
                                    ui.draggable.remove();
                                    updateAffichageImage();
                                } else if (carteDrag.nom === 'erosion') {
                                    erosion = true;
                                    //TODO: erosion :)
                                } else if (carteDrag.nom === 'pollutionOrganique') {
                                    supprimerCartePrecise(carteDragNumero);
                                    paquetDecharge.push(carteDrag);
                                    brillanceHabitatsEnnemi(true);
                                    ui.draggable.remove();
                                    onPollu = true;
                                    nombrePolluer = 0;
                                    //TODO: finir pollution organique
                                } else if (carteDrag.nom === 'prisSurFait') {
                                    //tableauProtege[numeroJoueurActif] = true;
                                    supprimerCartePrecise(carteDragNumero);
                                    ui.draggable.remove();
                                } else if (carteDrag.nom === 'accumulation') {
                                    paquetDecharge.push(carteDrag);
                                    supprimerCartePrecise(carteDragNumero);
                                    ui.draggable.remove();
                                    for (i = 0; i < 3; i++) {
                                        var nouvelle = true
                                        for (j = 0; j < mains[numeroJoueurActif].length; j++) {
                                            if (nouvelle) {
                                                if (mains[numeroJoueurActif][j] === null) {
                                                    annimationPigerCarte(j);
                                                    nouvel = false;
                                                }
                                            }
                                        }
                                        if (nouvelle) {
                                            annimationPigerCarte(mains[numeroJoueurActif].length);
                                        }
                                    }
                                } else if (carteDrag.nom === 'predation') {
                                    supprimerCartePrecise(carteDragNumero);
                                    predation = true;
                                    etapePredation = 1;
                                    paquetDecharge.push(carteDrag);
                                    brillerCarte('macroInvertebre', numeroJoueurActif, true);
                                    ui.draggable.remove();
                                    updateAffichageImage();
                                } else if (carteDrag.nom === 'retention') {
                                    tableauRetention[numeroJoueurActif] = true;
                                    paquetDecharge.push(carteDrag);
                                    supprimerCartePrecise(carteDragNumero);
                                    ui.draggable.remove();
                                } else if (carteDrag.nom === 'derivation') {
                                    paquetDecharge.push(carteDrag);
                                    supprimerCartePrecise(carteDragNumero);
                                    ui.draggable.remove();

                                    var popUp = document.createElement('div');
                                    popUp.id = 'popUp';
                                    popUp.className = 'popUp';
                                    $('body').append(popUp);

                                    $(popUp).dialog({
                                        classes: {
                                            'ui-dialog': 'no-x ui-corner-all',
                                        },
                                        buttons: {
                                            Confirmer: function () {
                                                if (selected != null) {
                                                    var numeroJoueurEchange;
                                                    for (i = 0; i < nombreJoueur; i++) {
                                                        if (nomJoueur[i] === selected.innerHTML) {
                                                            numeroJoueurEchange = i
                                                        }
                                                    }
                                                    var mainsTemporaire = mains[numeroJoueurActif];
                                                    mains[numeroJoueurActif] = mains[numeroJoueurEchange];
                                                    mains[numeroJoueurEchange] = mainsTemporaire;
                                                    $(this).dialog('close');
                                                    updateAffichageImage();
                                                }
                                            }
                                        },
                                        draggable: false,
                                        resizable: false,
                                        modal: true,
                                        height: 575,
                                        width: 500,
                                        hide: 'fade',
                                        show: 'fade'
                                    });

                                    var popUpContenu = document.createElement('div');
                                    popUpContenu.id = 'popUpContenu';
                                    $(popUp).append(popUpContenu);

                                    var labelChoixJoueur = document.createElement('label');
                                    labelChoixJoueur.id = 'labelChoixJoueur';
                                    labelChoixJoueur.innerHTML = 'Choisissez le joueur avec qui vous voulez échanger votre main.';
                                    $(popUpContenu).append(labelChoixJoueur);

                                    var ul = document.createElement('ul');
                                    ul.id = 'listeJoueur';
                                    $(popUpContenu).append(ul);
                                    for (i = 0; i < nombreJoueur; i++) {
                                        if (i != numeroJoueurActif) {
                                            var li = document.createElement('li');
                                            li.className = 'ui-widget-content';
                                            li.innerHTML = nomJoueur[i];
                                            $(ul).append(li);
                                        }
                                    }
                                    var selected;
                                    $(function () {
                                        $(ul).selectable({
                                            stop: function (event, ui) {
                                                $(event.target).children('.ui-selected').not(':first').removeClass('ui-selected');
                                            },
                                            selected: function (event, ui) {
                                                selected = ui.selected;
                                            }
                                        });
                                    });
                                }
                            }
                        }
                    }
                },
                over: function (event, ui) {
                    if (bonneZoneDrop(event.target)) {
                        $(event.target).addClass('droppable-hover');
                    }
                },
                out: function (event, ui) {
                    $(event.target).removeClass('droppable-hover');
                }
            });

            //Partie de droite.
            var divDroite = document.createElement('div');
            divDroite.id = 'divDroite';
            divDroite.className = 'divDroite';
            $('body').append(divDroite);

            //Paquet de charge
            var paquetCharge = document.createElement('div');
            paquetCharge.id = 'paquetCharge';
            paquetCharge.className = 'paquetCharge';
            var imagePaquet = document.createElement('img');
            imagePaquet.className = 'imageCharge'
            imagePaquet.setAttribute('src', 'ressources/grosPaquet.png');
            $(plateau).append(paquetCharge);
            $(paquetCharge).append(imagePaquet);

            //Paquet Défausse
            var paquetDefausse = document.createElement('div');
            paquetDefausse.id = 'paquetDefausse';
            paquetDefausse.className = 'paquetDefausse';
            $(plateau).append(paquetDefausse);
        }

        //Fonction qui crée les divers emplacement sur le tableau.
        function creerEmplacementsPlateau() {
            $(function () {
                for (i = 0; i < 6; i++) {
                    var emplacementJoueurA = document.createElement('div');
                    emplacementJoueurA.id = 'emplacementJoueurA' + i;
                    emplacementJoueurA.className = 'emplacementJoueurA';
                    emplacementJoueurA.style.left = 116 + 66 * (i + 1) + 'px';
                    emplacementJoueurA.style.bottom = '30px';
                    $('#plateau').append(emplacementJoueurA);

                    var emplacementJoueurB = document.createElement('div');
                    emplacementJoueurB.id = 'emplacementJoueurB' + i;
                    emplacementJoueurB.className = 'emplacementJoueurB';
                    emplacementJoueurB.style.left = 116 + 66 * (i + 1) + 'px';
                    emplacementJoueurB.style.top = '30px';
                    $('#plateau').append(emplacementJoueurB);

                    if (nombreJoueur >= 3) {
                        var emplacementJoueurC = document.createElement('div');
                        emplacementJoueurC.id = 'emplacementJoueurC' + i;
                        emplacementJoueurC.className = 'emplacementJoueurC';
                        emplacementJoueurC.style.top = 100 + 66 * (i + 1) + 'px';
                        emplacementJoueurC.style.left = '46px';
                        $('#plateau').append(emplacementJoueurC);
                    }
                    if (nombreJoueur === 4) {
                        var emplacementJoueurD = document.createElement('div');
                        emplacementJoueurD.id = 'emplacementJoueurD' + i;
                        emplacementJoueurD.className = 'emplacementJoueurD';
                        emplacementJoueurD.style.top = 100 + 66 * (i + 1) + 'px';
                        emplacementJoueurD.style.right = '46px';
                        $('#plateau').append(emplacementJoueurD);
                    }
                }
                for (i = 6; i < 10; i++) {
                    var emplacementJoueurA = document.createElement('div');
                    emplacementJoueurA.id = 'emplacementJoueurA' + i;
                    emplacementJoueurA.className = 'emplacementJoueurA';
                    emplacementJoueurA.style.left = 182 + 66 * (i - 5) + 'px';
                    emplacementJoueurA.style.bottom = '131px';
                    $('#plateau').append(emplacementJoueurA);

                    var emplacementJoueurB = document.createElement('div');
                    emplacementJoueurB.id = 'emplacementJoueurB' + i;
                    emplacementJoueurB.className = 'emplacementJoueurB';
                    emplacementJoueurB.style.left = 182 + 66 * (i - 5) + 'px';
                    emplacementJoueurB.style.top = '130px';
                    $('#plateau').append(emplacementJoueurB);

                    if (nombreJoueur >= 3) {
                        var emplacementJoueurC = document.createElement('div');
                        emplacementJoueurC.id = 'emplacementJoueurC' + i;
                        emplacementJoueurC.className = 'emplacementJoueurC';
                        emplacementJoueurC.style.top = 166 + 66 * (i - 5) + 'px';
                        emplacementJoueurC.style.left = '146px'
                        $('#plateau').append(emplacementJoueurC);
                    }

                    if (nombreJoueur === 4) {
                        var emplacementJoueurD = document.createElement('div');
                        emplacementJoueurD.id = 'emplacementJoueurD' + i;
                        emplacementJoueurD.className = 'emplacementJoueurD';
                        emplacementJoueurD.style.top = 166 + 66 * (i - 5) + 'px';
                        emplacementJoueurD.style.right = '146px';
                        $('#plateau').append(emplacementJoueurD);
                    }
                }
                $(function () {
                    $('.emplacementJoueurA, .emplacementJoueurB, .emplacementJoueurC, .emplacementJoueurD').droppable({
                        tolerance: 'pointer',
                        drop: function (event, ui) {
                            if (bonneZoneDrop(event.target)) {//Si l'endroits que nous voulons droper est à la bonne place.
                                if (accepterDrop(event.target)) {
                                    if (carteDrag.nom != nomEnum.deversement && carteDrag.nom != nomEnum.erosion && carteDrag.nom != nomEnum.pollutionOrganique && carteDrag.type != typeEnum.speciale && carteDrag.type != typeEnum.action) {
                                        if ($(this).children().length < 1) {//Si l'endroit ou on drope est vide.
                                            if (verifierCartePresente(carteDrag.nomImage) === '') {//Si la carte n'est pas déjà présente.
                                                if (carteDrag.type === typeEnum.macroInvertebre) {
                                                    if (carteDrag.predateur === 1) {//Si c'est un prédateur, démarre le processus de miam miam.
                                                        taillePredateur = carteDrag.taille;
                                                        onDrop(event, ui, this);
                                                        onMangeAtableCeSoir = true;
                                                        popUpConfirmation('Vous devez sélectionnez un macro-invertébré à manger.');
                                                        brillanceCarteMangeable(true);
                                                        $('#divDroite').css('pointer-events', 'none');
                                                        $('#divMain').css('pointer-events', 'none');
                                                    } else {//Sinon, met simplement la carte.
                                                        onDrop(event, ui, this);
                                                    }
                                                } else {//Sinon, met simplement la carte.
                                                    onDrop(event, ui, this);
                                                }
                                            } else {
                                                if (carteDrag.type === typeEnum.macroInvertebre) {
                                                    if (carteDrag.predateur === 1) {//Si c'est un prédateur, démarre le processus de miam miam.
                                                        taillePredateur = carteDrag.taille;
                                                        onDrop(event, ui, verifierCartePresente(carteDrag.nomImage));
                                                        onMangeAtableCeSoir = true;
                                                        popUpConfirmation('Vous devez sélectionnez un macro-invertébré de taille inférieur à manger.');
                                                        brillanceCarteMangeable(true);
                                                    } else {//Sinon, mes simplement la carte.
                                                        onDrop(event, ui, verifierCartePresente(carteDrag.nomImage));
                                                    }
                                                } else {//Sinon, mes simplement la carte.
                                                    onDrop(event, ui, verifierCartePresente(carteDrag.nomImage));
                                                }
                                            }
                                            //sinon si l'endroit contient une carte ET qu'elle est identique.
                                        } else if ($(this).children().length >= 1) {
                                            if (carteDrag.type != typeEnum.perturbation) {
                                                var id;
                                                id = event.target.id.substr(event.target.id.length - 1);

                                                if (carteDrag.nom === carteBas[numeroJoueurActif][id].nom) {
                                                    onDrop(event, ui, this);
                                                } else {//Sinon, le drop est pas accepter.
                                                    ui.draggable.draggable({ revert: function (event) { return revertCarte(event, ui.draggable) } });
                                                    popUpErreur('Vous ne pouvez pas empiller des cartes différentes.');
                                                }
                                            } else {
                                                rendrePerturber(event);
                                                onDrop(event, ui, this);
                                            }
                                        }
                                    }
                                } else {//Respecte pas les conditions, donc drop pas accepter.
                                    ui.draggable.draggable({ revert: function (event) { return revertCarte(event, ui.draggable) } });
                                }
                            } else {
                                ui.draggable.draggable({ revert: function (event) { return revertCarte(event, ui.draggable) } });

                                if (carteDrag.type === typeEnum.habitats || carteDrag.type === typeEnum.macroInvertebre || carteDrag.type === typeEnum.bandeRiveraine || carteDrag.type === typeEnum.salmonide) {
                                    popUpErreur('Cette carte est jouable que dans votre zone.');
                                } else if (carteDrag.type === typeEnum.perturbation) {
                                    popUpErreur('Cette carte est jouable que dans la zone d\'un de vos adversaire ou directement sur le plateau.');
                                }
                            }
                        },
                        over: function (event, ui) {
                            if (bonneZoneDrop(event.target)) {
                                $(event.target).addClass('droppable-hover');
                            }
                        },
                        out: function (event, ui) {
                            $(event.target).removeClass('droppable-hover');
                        }
                    });
                });
            });
        }

        //Fonction qui va mettre la variable perturber à true.
        function rendrePerturber(event) {
            var position = event.target.id.substr(event.target.id.length - 2);
            var lettrePositionJoueur = position.substr(0, 1);
            var numeroPositionJoueur = numeroJoueur(lettrePositionJoueur);
            var numeroPosition = position.substr(position.length - 1);

            if (carteDrag.nom === nomEnum.dechets || carteDrag.nom === nomEnum.artificialisation) {
                carteBas[numeroPositionJoueur][numeroPosition].perturber = true;
                carteBas[numeroPositionJoueur][numeroPosition].tempsPerturber = 10;
                cartePerturbation[numeroPositionJoueur][numeroPosition] = carteDrag;
            } else if (carteDrag.nom === nomEnum.passageToutTerrain) {
                carteBas[numeroPositionJoueur][numeroPosition].perturber = true;
                carteBas[numeroPositionJoueur][numeroPosition].tempsPerturber = 2;
                cartePerturbation[numeroPositionJoueur][numeroPosition] = carteDrag;
            }
        }

        //Fonction qui enleverais 1 tour au temps de perturbation et si le temps est désormais rendu à 0, retire la carte perturbation et l'état perturber.
        function debutTourDeperturber() {
            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueurActif][i] != null) {
                    if (carteBas[numeroJoueurActif][i].type === typeEnum.habitats || carteBas[numeroJoueurActif][i].type === typeEnum.bandeRiveraine) {
                        if (carteBas[numeroJoueurActif][i].tempsPerturber != 10 && carteBas[numeroJoueurActif][i].tempsPerturber > 0) {
                            carteBas[numeroJoueurActif][i].tempsPerturber--;
                            if (carteBas[numeroJoueurActif][i].tempsPerturber === 0) {
                                carteBas[numeroJoueurActif][i].perturber = false;
                                retirerCartePerturbation(numeroJoueurActif, i);
                            }
                        }
                    }
                }
            }
        }

        //Fonction qui va enlever la carte de perturbation de dessus la carte.
        function retirerCartePerturbation(numeroActif, positionCarte) {
            var lettreActif = lettreJoueur(numeroActif);
            paquetDecharge.push(cartePerturbation[numeroActif][positionCarte]);
            $('#emplacementJoueur' + lettreActif + positionCarte).children().last().remove();
            reempillerCartePasPerturber(numeroActif, positionCarte);
            updateAffichageImage();
        }

        //Fonction qui va re-empiller la carte qui viens de ne plus être perturber.
        function reempillerCartePasPerturber() {

        }

        //Fonction qui mes en brillances les trucs qui sont mangeable.
        function brillanceCarteMangeable(brille) {
            if (brille) {
                for (var i = 0; i < 10; i++) {
                    if (numeroJoueurActif != 0) {
                        lettre = lettreJoueur(0);

                        if (carteBas[0][i] != null) {
                            if (carteBas[0][i].type === typeEnum.macroInvertebre) {
                                if (carteBas[0][i].taille < taillePredateur) {
                                    $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                                }
                            }
                        }
                    }
                    if (numeroJoueurActif != 1) {
                        lettre = lettreJoueur(1);

                        if (carteBas[1][i] != null) {
                            if (carteBas[1][i].type === typeEnum.macroInvertebre) {
                                if (carteBas[1][i].taille < taillePredateur) {
                                    $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                                }
                            }
                        }
                    }
                    if (numeroJoueurActif != 2) {
                        if (nombreJoueur > 2) {
                            lettre = lettreJoueur(2);

                            if (carteBas[2][i] != null) {
                                if (carteBas[2][i].type === typeEnum.macroInvertebre) {
                                    if (carteBas[2][i].taille < taillePredateur) {
                                        $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                                    }
                                }
                            }
                        }
                    }
                    if (numeroJoueurActif != 3) {
                        if (nombreJoueur > 3) {
                            lettre = lettreJoueur(3);

                            if (carteBas[3][i] != null) {
                                if (carteBas[3][i].type === typeEnum.macroInvertebre) {
                                    if (carteBas[3][i].taille < taillePredateur) {
                                        $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                                    }
                                }
                            }
                        }
                    }
                }
            } else if (!brille) {
                for (var i = 0; i < 10; i++) {
                    $('#emplacementJoueurA' + i).removeClass('ui-echange-highlight');
                    $('#emplacementJoueurB' + i).removeClass('ui-echange-highlight');

                    if (nombreJoueur > 2) {

                        $('#emplacementJoueurC' + i).removeClass('ui-echange-highlight');
                    }
                    if (nombreJoueur === 3) {
                        $('#emplacementJoueurD' + i).removeClass('ui-echange-highlight');
                    }
                }
            }
        }

        //Fonction qui rends touts les habitats ennemi brillant.
        function brillanceHabitatsEnnemi(brille) {
            if (brille) {
                for (var i = 0; i < 10; i++) {
                    if (numeroJoueurActif != 0) {
                        lettre = lettreJoueur(0);

                        if (carteBas[0][i] != null) {
                            if (carteBas[0][i].type === typeEnum.habitats) {
                                $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                            }
                        }
                    }
                    if (numeroJoueurActif != 1) {
                        lettre = lettreJoueur(1);

                        if (carteBas[1][i] != null) {
                            if (carteBas[1][i].type === typeEnum.habitats) {
                                $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                            }
                        }
                    }
                    if (numeroJoueurActif != 2) {
                        lettre = lettreJoueur(2);

                        if (carteBas[2][i] != null) {
                            if (carteBas[2][i].type === typeEnum.habitats) {
                                $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                            }
                        }
                    }
                    if (numeroJoueurActif != 3) {
                        lettre = lettreJoueur(3);

                        if (carteBas[3][i] != null) {
                            if (carteBas[3][i].type === typeEnum.habitats) {
                                $('#emplacementJoueur' + lettre + i).addClass('ui-echange-highlight');
                            }
                        }
                    }
                }
            } else {
                for (var i = 0; i < 10; i++) {
                    $('#emplacementJoueurA' + i).removeClass('ui-echange-highlight');
                    $('#emplacementJoueurB' + i).removeClass('ui-echange-highlight');

                    if (nombreJoueur > 2) {

                        $('#emplacementJoueurC' + i).removeClass('ui-echange-highlight');
                    }
                    if (nombreJoueur === 3) {
                        $('#emplacementJoueurD' + i).removeClass('ui-echange-highlight');
                    }
                }
            }
        }

        //Fonction qui tue les macro-invertébré de tolérance inférieure à 6.
        function tuerDeversement() {
            if (!possedeAssainissement(0)) {
                for (var i = 0; i < 10; i++) {
                    if (carteBas[0][i] != null) {
                        if (carteBas[0][i].type === typeEnum.macroInvertebre) {
                            if (carteBas[0][i].tolerance < 6) {
                                paquetDecharge.push(carteBas[0][i]);
                                carteBas[0][i] = null;
                                var lettre = lettreJoueur(0);
                                $('#emplacementJoueur' + lettre + i).children().remove();
                            }
                        }
                    }
                }
            }
            if (!possedeAssainissement(1)) {
                for (var i = 0; i < 10; i++) {
                    if (carteBas[1][i] != null) {
                        if (carteBas[1][i].type === typeEnum.macroInvertebre) {
                            if (carteBas[1][i].tolerance < 6) {
                                paquetDecharge.push(carteBas[1][i]);
                                carteBas[1][i] = null;
                                var lettre = lettreJoueur(1);
                                $('#emplacementJoueur' + lettre + i).children().remove();
                            }
                        }
                    }
                }
            }
            if (nombreJoueur > 2) {
                if (!possedeAssainissement(2)) {
                    for (var i = 0; i < 10; i++) {
                        if (carteBas[2][i] != null) {
                            if (carteBas[2][i].type === typeEnum.macroInvertebre) {
                                if (carteBas[2][i].tolerance < 6) {
                                    paquetDecharge.push(carteBas[2][i]);
                                    carteBas[2][i] = null;
                                    var lettre = lettreJoueur(2);
                                    $('#emplacementJoueur' + lettre + i).children().remove();
                                }
                            }
                        }

                    }
                }
            }
            if (nombreJoueur > 3) {
                if (!possedeAssainissement(3)) {
                    for (var i = 0; i < 10; i++) {
                        if (carteBas[3][i] != null) {
                            if (carteBas[3][i].type === typeEnum.macroInvertebre) {
                                if (carteBas[3][i].tolerance < 6) {
                                    paquetDecharge.push(carteBas[3][i]);
                                    carteBas[3][i] = null;
                                    var lettre = lettreJoueur(3);
                                    $('#emplacementJoueur' + lettre + i).children().remove();
                                }
                            }

                        }
                    }
                }
            }
        }

        //Fonction qui retourne true si le joueur possede un certificat d'assainissement.
        function possedeAssainissement(numero) {
            for (var i = 0; i < 10; i++) {
                if (carteBas[numero][i] != null) {
                    if (carteBas[numero][i].nom === nomEnum.assainissement) {
                        return true;
                    }
                }
            }
            return false;
        }

        //Fonction qui vérifie si une carte pareil est déjà présente sur le jeu. Si elle est la, retourne la position.
        function verifierCartePresente(nomCarte) {
            var lettreActif = lettreJoueur(numeroJoueurActif);
            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueurActif][i] != null) {
                    if (carteBas[numeroJoueurActif][i].nomImage === nomCarte) {
                        return document.getElementById('emplacementJoueur' + lettreActif + i);
                    }
                }
            }

            return '';
        }

        //Fonction qui validera que c'est la bonne zone pour drope notre carte.
        function bonneZoneDrop(event) {
            var identification = $(event).attr('id').substr($(event).attr('id').length - 2);
            var lettreEmplacement = identification.substr(0, 1);

            var lettre = lettreJoueur(numeroJoueurActif);

            //Si c'est un habitats, un macro-invertebrer ou une bande riveraine, la carte se joue seulement sur notre territoire.
            if (carteDrag.type === typeEnum.habitats || carteDrag.type === typeEnum.macroInvertebre || carteDrag.type === typeEnum.bandeRiveraine || carteDrag.type === typeEnum.salmonide || carteDrag.type === typeEnum.reglementation) {
                if (lettreEmplacement === lettre) {
                    return true;
                } else {
                    return false;
                }
            } else if (carteDrag.type === typeEnum.perturbation) {
                if (carteDrag.nom === nomEnum.deversement || carteDrag.nom === nomEnum.erosion || carteDrag.nom === nomEnum.pollutionOrganique) {
                    if (identification === 'au') {//Si c'est dropper sur le plateau.
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    if (lettreEmplacement === lettre) {
                        return false;
                    } else if (identification === 'au') {
                        return false;
                    } else {
                        return true;
                    }
                }
            } else if (carteDrag.type === typeEnum.action) {
                if (identification === 'au') {
                    return true;
                } else {
                    return false;
                }
            } else if (carteDrag.type === typeEnum.speciale) {
                if (identification === 'au') {
                    return true;
                } else {
                    return false;
                }
            }
        }

        //Fonction qui renvoie la lettre du joueur voulu
        function lettreJoueur(numero) {
            if (nombreJoueur === 2) {
                if (numero === 0) {
                    return 'A';
                } else if (numero === 1) {
                    return 'B';
                }
            } else if (nombreJoueur === 3) {
                if (numero === 0) {
                    return 'A';
                } else if (numero === 1) {
                    return 'B';
                } else if (numero === 2) {
                    return 'C';
                }
            } else if (nombreJoueur === 4) {
                if (numero === 1) {
                    return 'D';
                } else if (numero === 0) {
                    return 'A'
                } else if (numero === 2) {
                    return 'B';
                } else {
                    return 'C';
                }
            }
        }

        //Fonction qui renvoie le numero du joueur voulu.
        function numeroJoueur(lettre) {
            if (nombreJoueur === 4) {
                if (lettre === 'A') {
                    return 0;
                } else if (lettre === 'B') {
                    return 2;
                } else if (lettre === 'C') {
                    return 3;
                } else if (lettre === 'D') {
                    return 1;
                }
            } else if (lettre === 3) {
                if (lettre === 'A') {
                    return 0;
                } else if (lettre === 'B') {
                    return 1;
                } else if (lettre === 'C') {
                    return 2;
                }
            } else if (nombreJoueur === 2) {
                if (lettreJoueur === 'A') {
                    return 0;
                } else if (lettre === 'B') {
                    return 1;
                }
            }
        }

        //Fonction qui crée l'espace de la main.
        function creerMain() {
            for (i = 0; i < 6; i++) {
                var li = document.createElement('li');
                li.className = 'liMain';
                li.id = 'liMain' + i;
                document.getElementById('divMain').appendChild(li);

                var divCarte = document.createElement('div');
                divCarte.id = 'divCarte' + i;
                divCarte.className = 'divCarte';
                li.appendChild(divCarte);
            }
        }

        //Fonction qui retourne true si il y a un macro-invertébré à manger.
        function possibleManger() {
            var possible = false;
            var tailleMacro = carteDrag.taille;

            for (var i = 0; i < 10; i++) {
                if (numeroJoueurActif != 0) {
                    if (carteBas[0][i] != null) {
                        if (carteBas[0][i].taille < tailleMacro) {
                            possible = true;
                        }
                    }
                }
                if (numeroJoueurActif != 1) {
                    if (carteBas[1][i] != null) {
                        if (carteBas[1][i].taille < tailleMacro) {
                            possible = true;
                        }
                    }
                }
                if (numeroJoueurActif != 2) {
                    if (carteBas[2][i] != null) {
                        if (carteBas[2][i].taille < tailleMacro) {
                            possible = true;
                        }
                    }
                }
                if (numeroJoueurActif != 3) {
                    if (carteBas[3][i] != null) {
                        if (carteBas[3][i].taille < tailleMacro) {
                            possible = true;
                        }
                    }
                }
            }

            if (possible) {
                return true;
            } else {
                return false;
            }
        }

        //Fonction qui valide si le drop est accepter.
        function accepterDrop(event) {
            if (carteDrag.coutResources <= pointsRessourcesRestant[numeroJoueurActif]) {
                // Si c'est un macroInvertebre ou un salmonive, il y a des conditions.
                if (carteDrag.type === typeEnum.macroInvertebre || carteDrag.type === typeEnum.salmonide) {
                    if (verifierCondition(carteDrag)) {
                        if (carteDrag.predateur > 0) {
                            if (possibleManger()) {
                                //TODO: appeler une méthode qui se chargera de manger les cartes.
                                return true;
                            } else {
                                popUpErreur('Un adversaire doit avoir une carte avec une taille inférieur au prédateur pour qu\'il est quelque choses à manger');
                                return false;
                            }
                        } else {
                            return true;
                        }
                    } else {
                        popUpAvertissement('Vous ne respectez pas les conditions nécéssaires.');
                        return false;
                    }
                } else if (carteDrag.type === typeEnum.habitats || carteDrag.type === typeEnum.intervention || carteDrag.type === typeEnum.bandeRiveraine) {
                    if (carteDrag.type === typeEnum.habitats) {
                        if (verifierNombreHabitats(numeroJoueurActif, 8)) {
                            return true;
                        } else {
                            popUpAvertissement('Vous ne pouvez pas avoir plus de 8 habitats en jeu.');
                            return false;
                        }
                    } else if (carteDrag.type === typeEnum.bandeRiveraine) {
                        if (verifierNombreBandeRiveraine(numeroJoueurActif, 3)) {
                            return true;
                        } else {
                            popUpAvertissement('Vous ne pouvez pas avoir plus de 3 bande riveraine en jeu.');
                            return false;
                        }
                    } else if (carteDrag.type === typeEnum.intervention) {
                        return true;
                    }
                } else if (carteDrag.type === typeEnum.perturbation) {
                    if (carteDrag.nom === nomEnum.dechets) {
                        if (presenceReglementation(nomEnum.interdiction, event)) {
                            popUpAvertissement('Il y a une interdiction de jeter des ordures pour cet écosystèmes.');
                            return false;
                        }
                    } else if (carteDrag.nom === nomEnum.artificialisation) {
                        if (presenceReglementation(nomEnum.politique, event)) {
                            popUpAvertissement('Il y a une politique de protection pour cet écosystème.');
                            return false;
                        }
                    } else if (carteDrag.nom === nomEnum.deversement) {
                        if (deversement === false) {
                            return true;
                        } else {
                            popUpAvertissement('Un déversement aura déjà lieu à la fin du tour du joueur: ' + numeroJoueurDeversement + '.');
                            return false;
                        }
                    }

                    var message = verifierConditionPerturbation(event);

                    if (message === 'ok') {
                        return true;
                    } else {
                        popUpAvertissement(message);
                        return false;
                    }
                } else if (carteDrag.type === typeEnum.reglementation) {
                    return true;
                } else if (carteDrag.type === typeEnum.action) {
                    if (carteDrag.nom === nomEnum.corveNettoyage) {

                    } else if (carteDrag.nom === nomEnum.naturalisation) {

                    } else if (carteDrag.nom === nomEnum.amenagement) {

                    }
                    return true;
                } else if (carteDrag.type === typeEnum.speciale) {
                    if (carteDrag.nom === nomEnum.retention) {
                        if (pointsRessourcesRestant[numeroJoueurActif] === 0) {
                            popUpAvertissement('Vous n\'avez plus de points ressources à garder.');
                            return false;
                        }
                        return true;
                    } else if (carteDrag.nom === nomEnum.predation) {
                        for (i = 0; i < carteBas[numeroJoueurActif].length; i++) {
                            var carteJoueur = carteBas[numeroJoueurActif][i];
                            if (carteJoueur != null) {
                                if (carteJoueur.type === typeEnum.macroInvertebre || carteJoueur.type === typeEnum.salmonide) {
                                    if (carteJoueur.predateur > 0) {
                                        for (j = 0; j < nombreJoueur; j++) {
                                            if (j !== numeroJoueurActif) {
                                                for (k = 0; k < carteBas[j].length; k++) {
                                                    if (carteBas[j][k] != null) {
                                                        if (carteBas[j][k].type === typeEnum.macroInvertebre) {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        popUpAvertissement('Aucun adversaire ne possède de macroinvertébrés.');
                                        return false;
                                    }
                                }
                            }
                        }
                        popUpAvertissement('Vous ne possédez pas de prédateur sur votre jeu.');
                        return false;
                    } else if (carteDrag.nom === nomEnum.derivation) {
                        if (mains[numeroJoueurActif].filter(function (value) { return value !== null }).length > 0) {
                            var compteur = 0;
                            for (i = 0; i < nombreJoueur; i++) {
                                if (i !== numeroJoueurActif) {
                                    if (mains[i].filter(function (value) { return value !== null }).length > 0) {
                                        compteur++;
                                    }
                                }
                            }
                            if (compteur != 0) {
                                return true;
                            }
                            popUpAvertissement('Les mains de tout vos adversaires sont vide.');
                            return false;
                        }
                        popUpAvertissement('Vous ne pouvez pas échanger votre main si elle est vide.');
                        return false;
                    } else if (carteDrag.nom === nomEnum.prisSurFait) {
                        if (tableauProtege[numeroJoueurActif] === true) {
                            popUpAvertissement('Une carte Pris sur le fait est déjà active sur votre jeu');
                            return false;
                        }
                        return true;
                    } else if (carteDrag.nom === nomEnum.accumulation) {
                        return true;
                    } else if (carteDrag.nom === nomEnum.emergence) {
                        for (i = 0; i > nombreJoueur; i++) {
                            for (j = 0; j < carteBas[i].length; j++) {
                                if (carteBas[i][j] != null) {
                                    if (carteBas[i][j].type === typeEnum.macroInvertebre) {
                                        if (carteBas[i][j].typeMacro === typeMacroEnum.ephemeroptere || carteBas[i][j].typeMacro === typeMacroEnum.trichoptere || carteBas[i][j].typeMacro === typeMacroEnum.plecoptere || carteBas[i][j].typeMacro === typeMacroEnum.odonate || carteBas[i][j].typeMacro === typeMacroEnum.diptere) {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        popUpAvertissement('Il n\'y a aucun macroinvetébrés d\'un des ordres spécifiés sur le jeu');
                        return false;
                    } else if (carteDrag.nom === nomEnum.pecheur) {
                        var option1 = false;
                        var option2 = false;

                        for (i = 0; i < nombreJoueur; i++) {
                            if (i != numeroJoueurActif) {
                                for (j = 0; j < carteBas[i].length; j++) {
                                    if (carteBas[i][j] != null) {
                                        if (carteBas[i][j].type === typeEnum.salmonide) {
                                            option1 = true;
                                        }
                                    }
                                }
                            }
                        }
                        if (paquetDecharge.filter(function (value) { return value !== null }).length != 0) {
                            option2 = true;
                        }
                        if (!option1 && !option2) {
                            popUpAvertissement('La carte Salmonidé n\'est pas en jeu et la décharge est vide');
                            return false;
                        }
                        return true;
                    } else if (carteDrag.nom === nomEnum.crueSoudaine) {
                        return true;
                    } else if (carteDrag.nom === nomEnum.zonage) {
                        for (i = 0; i < carteBas[numeroJoueurActif].length; i++) {
                            if (carteBas[numeroJoueurActif][i] != null) {
                                if (carteBas[numeroJoueurActif][i].type === typeEnum.habitats) {
                                    for (j = 0; j < nombreJoueur; j++) {
                                        if (j !== numeroJoueurActif) {
                                            for (k = 0; k < carteBas[j].length; k++) {
                                                if (carteBas[j][k] != null) {
                                                    if (carteBas[j][k].type === typeEnum.habitats) {
                                                        return true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    popUpAvertissement('Aucun adversaire ne possède d\'habitat.');
                                    return false;
                                }
                            }

                        }
                        popUpAvertissement('Vous ne possédez pas d\'habitat');
                        return false;
                    }
                }
            } else {
                popUpAvertissement('Vous manquez de points ressources pour jouer la carte.');
                return false;
            }
        }

        //Fonction qui retourne true si le nombre maximum d'habitats n'est pas dépasser.
        function verifierNombreHabitats(numeroJoueur, nombreMax) {
            var nombreHabitats = 0;

            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueur][i] != null) {
                    if (carteBas[numeroJoueur][i].type === typeEnum.habitats) {
                        nombreHabitats += exemplaireCarteBas[numeroJoueur][i];
                    }
                }
            }

            if (nombreHabitats >= nombreMax) {
                return false;
            } else {
                return true;
            }
        }

        //Fonction qui vérifie si il y a la présence d'une réglementation qui empècherais la mise en place d'une carte perturbation.
        function presenceReglementation(nomReglementation, event) {
            var position = $(event).attr('id').substr($(event).attr('id').length - 2);
            var lettrePositionJoueur = position.substr(0, 1);
            var numeroPositionJoueur = numeroJoueur(lettrePositionJoueur);

            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroPositionJoueur][i] != null) {
                    if (carteBas[numeroPositionJoueur][i].nom === nomReglementation) {
                        return true;
                    }
                }
            }

            return false;
        }

        //Fonction qui retourne true si le nombre maximum de bande riveraine n'est pas dépasser.
        function verifierNombreBandeRiveraine(numeroJoueur, nombreMax) {
            var nombreBandeRiveraine = 0;

            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueur][i] != null) {
                    if (carteBas[numeroJoueur][i].type === typeEnum.bandeRiveraine) {
                        nombreBandeRiveraine += exemplaireCarteBas[numeroJoueur][i];
                    }
                }
            }

            if (nombreBandeRiveraine >= nombreMax) {
                return false;
            } else {
                return true;
            }
        }

        //Fonction qui va vérifier si la carte perturbation respecte son emplacement.
        function verifierConditionPerturbation(event, ui) {
            var position = $(event).attr('id').substr($(event).attr('id').length - 2);
            var numeroPositionEmplacement = position.substr(position.length - 1);
            var lettrePositionJoueur = position.substr(0, 1);
            var numeroPositionJoueur;

            if (nombreJoueur === 4) {
                if (lettrePositionJoueur === 'A') {
                    numeroPositionJoueur = 0;
                } else if (lettrePositionJoueur === 'D') {
                    numeroPositionJoueur = 1;
                } else if (lettrePositionJoueur === 'B') {
                    numeroPositionJoueur = 2;
                } else if (lettrePositionJoueur === 'C') {
                    numeroPositionJoueur = 3;
                }
            } else if (nombreJoueur === 3) {
                if (lettrePositionJoueur === 'A') {
                    numeroPositionJoueur = 0;
                } else if (lettrePositionJoueur === 'B') {
                    numeroPositionJoueur = 1;
                } else if (lettrePositionJoueur === 'C') {
                    numeroPositionJoueur = 2;
                }
            } else if (nombreJoueur === 2) {
                if (lettrePositionJoueur === 'A') {
                    numeroPositionJoueur = 0;
                } else if (lettrePositionJoueur === 'C') {
                    numeroPositionJoueur = 1;
                }
            }

            if (carteDrag.nom === nomEnum.dechets) {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === typeEnum.habitats) {
                        return 'ok';
                    } else {
                        return 'La carte "Déchets" doit être jouer sur un habitat.';
                    }
                } else {
                    return 'La carte "Déchets" doit être jouer sur un habitat.';
                }
            } else if (carteDrag.nom === nomEnum.passageToutTerrain) {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === typeEnum.habitats) {
                        return 'ok';
                    } else {
                        return 'La carte "Passage de tout-terrain" doit être jouer sur un habitat.';
                    }
                } else {
                    return 'La carte "Passage de tout-terrain" doit être jouer sur un habitat.';
                }
            } else if (carteDrag.nom === nomEnum.artificialisation) {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === typeEnum.bandeRiveraine) {
                        return 'ok';
                    } else {
                        return 'La carte "Artificialisation" doit être jouer sur une bande riveraine.';
                    }
                } else {
                    return 'La carte "Artificialisation" doit être jouer sur une bande riveraine.';
                }
            } else if (carteDrag.nom === nomEnum.deversement) {
                return 'ok';
                //TODO: la carte déversement se joue n'importe ou, ce serais donc le fun que le plateau entier se highlithts.
            } else {
                return 'Vous ne pouvez pas mettre une carte perturbation sur un emplacement vide.';
            }
        }

        //Fonction qui se produit lorsque l'on drop.
        function onDrop(event, ui, drop) {
            $(function () {
                if (carteDrag.type != typeEnum.perturbation) {
                    $(ui.draggable).click(function () { onClickImage($(this).parent().attr('id'), ui) });
                }
                ui.draggable.appendTo(drop);
                ui.draggable.addClass('imageCarteJeu');
                ui.draggable.removeClass('imageCarteMains');
                ui.draggable.css('width', '58px');
                ui.draggable.css('height', '90px');
                ui.draggable.css('top', '0px');
                ui.draggable.css('left', '0px');
                ui.draggable.draggable('disable');
                if ($(drop).children().length > 1) {
                    ui.draggable.css('margin-top', ($(drop).children().length * 10) - 10 + 'px');
                    exemplaireCarteBas[numeroJoueurActif][event.target.id.substr(event.target.id.length - 1)] = $(drop).children().length;
                } else {
                    exemplaireCarteBas[numeroJoueurActif][event.target.id.substr(event.target.id.length - 1)] = 1;
                }
                //Partie qui change les données de la mains vers la partie du bas.
                pointsRessourcesRestant[numeroJoueurActif] -= carteDrag.coutResources;
                pointsRessourcesUtiliser[numeroJoueurActif] += carteDrag.coutResources;

                var id = drop.id.substr(drop.id.length - 1);

                if (carteDrag.type != typeEnum.perturbation) {//Si c'est une perturbation, ne l'ajoute pas.
                    carteBas[numeroJoueurActif][id] = carteDrag;
                }

                supprimerCartePrecise(carteDragNumero);
                calculerPoints();
                updatePointsRessources();
                updateZonePoints();
            });
        }

        //Fonction qui va supprimer une carte de la main, appeler lors du drop dans la zone du bas.
        function supprimerCartePrecise(positionCarte) {
            mains[numeroJoueurActif][positionCarte] = null;
        }

        //Définition de la classe.
        function Carte(type, nom, nomImage, coutResources, params) {
            if (type === typeEnum.habitats) {
                this.nom = nom;
                this.type = type;
                this.habitats = params.habitats;
                this.coutResources = coutResources;
                this.nomImage = nomImage;
                this.perturber = false;
                this.tempsPerturber = 0;
            } else if (type === typeEnum.salmonide) {
                this.nom = nom;
                this.type = type;
                this.coutResources = coutResources;
                this.condition = params.condition;
                this.nomImage = nomImage;
                this.perturber = false;
                this.tempsPerturber = 0;
            } else if (type === typeEnum.bandeRiveraine) {
                this.nom = nom;
                this.type = type;
                this.coutResources = coutResources;
                this.nomImage = nomImage;
                this.perturber = false;
                this.tempsPerturber = 0;
            } else if (type === typeEnum.speciale) {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            } else if (type === typeEnum.action) {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            } else if (type === typeEnum.perturbation) {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
                this.tempsActif = params.tempsActif;
            } else if (type === typeEnum.reglementation) {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            } else if (type === typeEnum.macroInvertebre) {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
                this.tolerance = params.tolerance;
                this.taille = params.taille;
                this.predateur = params.predateur;
                this.typeMacro = params.typeMacro;
                this.condition = params.condition;
                this.perturber = false;
                this.tempsPerturber = 0;
            } else if (type === typeEnum.intervention) {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
        }

        //function pour piger une carte.
        function pigerCarte(paquetCarte) {
            var carte = paquetCarte.pop();
            if (paquetCarte.length <= 70) {
                $('.imageCharge').attr('src', 'ressources/moyenPaquet.png');
            }
            if (paquetCarte.length <= 20) {
                $('.imageCharge').attr('src', 'ressources/petitPaquet.png')
            }

            return carte;
        }

        //Fonction qui anime les cartes du paquet jusqu'à la main.
        function animationPige(carte, position) {
            var carteMain
            if (document.getElementById('divCarte' + position) != null) {
                carteMain = 'divCarte' + position;
            } else {
                var li = document.createElement('li');
                li.className = 'liMain';
                li.id = 'liMain' + position;
                document.getElementById('divMain').appendChild(li);

                var divCarte = document.createElement('div');
                divCarte.id = 'divCarte' + position;
                divCarte.className = 'divCarte';
                li.appendChild(divCarte);

                carteMain = divCarte.id;
            }
            var divCarteAnimee = document.createElement('div');
            divCarteAnimee.id = 'carte' + position;
            divCarteAnimee.className = 'divAnimee';
            divCarteAnimee.innerHTML = '<img class="imageCarteJeu" src="ressources/' + carte.nomImage + '">';
            $('body').append(divCarteAnimee);

            var x = $('#' + carteMain).offset().left;
            var y = $('#' + carteMain).offset().top;

            $('#carte' + position).animate({
                height: 180,
                width: 118,
                left: x,
                top: y,
                borderSpacing: 0,
            }, {
                step: function (now) {
                    $(this).css('-webkit-transform', 'rotate(' + now + 'deg)');
                    $(this).css('-moz-transform', 'rotate(' + now + 'deg)');
                    $(this).css('transform', 'rotate(' + now + 'deg)');
                }
            }, { duration: 500 });
            setTimeout(function () {
                $('#carte' + position).remove();
                updateAffichageImage();
            }, 500);
        }

        //Function qui melange le paquet de carte.
        function melangerPaquetCarte(paquetCarte) {
            var currentIndex = paquetCarte.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = paquetCarte[currentIndex];
                paquetCarte[currentIndex] = paquetCarte[randomIndex];
                paquetCarte[randomIndex] = temporaryValue;
            }
        }

        //function qui crée le paquet de carte.
        function creerPaquetCarte(difficulte) {
            var carte;
            var paquetCarte = new Array();

            //Dépendant du niveau de la partie, il n'y aura pas les mêmes cartes  dans le deck.
            //if (tour == 1) {
            //----------------------------------habitats-----------------------------------

            carte = new Carte(typeEnum.habitats, nomEnum.fosse, 'fosse.png', 1, { habitats: nomEnum.fosse });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.habitats, nomEnum.sable, 'sable.png', 1, { habitats: nomEnum.sable });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.habitats, nomEnum.gravier, 'gravier.png', 2, { habitats: nomEnum.gravier });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.habitats, nomEnum.rapides, 'rapides.png', 3, { habitats: nomEnum.rapides });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.habitats, nomEnum.galets, 'galets.png', 3, { habitats: 'galets' });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            // ----------------------------MacroInvertebre--------------------------------------------------

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.oligochaeta, 'oligochaeta.png', 1, { tolerance: 8, taille: 1, typeMacro: typeMacroEnum.annelide, condition: ['?'], predateur: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.simuliidae, 'simuliidae.png', 1, { tolerance: 6, taille: 2, typeMacro: typeMacroEnum.diptere, condition: [nomEnum.rapides, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.chironomidae, 'chironomidae.png', 1, { tolerance: 8, taille: 2, typeMacro: typeMacroEnum.diptere, condition: ['?'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.psephenidae, 'psephenidae.png', 2, { tolerance: 3, taille: 4, typeMacro: typeMacroEnum.coleoptere, condition: [nomEnum.rapides, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.hydropsychidae, 'hydropsychidae.png', 2, { tolerance: 5, taille: 4, typeMacro: typeMacroEnum.trichoptere, condition: [nomEnum.rapides], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.elmidae, 'elmidae.png', 2, { tolerance: 3, taille: 3, typeMacro: typeMacroEnum.coleoptere, condition: [nomEnum.rapides], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.baetidae, 'baetidae.png', 2, { tolerance: 5, taille: 3, typeMacro: typeMacroEnum.ephemeroptere, condition: [nomEnum.rapides], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.hydroptilidae, 'hydroptilidae.png', 2, { tolerance: 4, taille: 2, typeMacro: typeMacroEnum.trichoptere, condition: [nomEnum.rapides, nomEnum.sable, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.ephemeridae, 'ephemeridae.png', 2, { tolerance: 3, taille: 5, typeMacro: typeMacroEnum.ephemeroptere, condition: [nomEnum.sable], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.prosobranchia, 'prosobranchia.png', 2, { tolerance: 8, taille: 5, typeMacro: typeMacroEnum.mollusque, condition: ['?'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.sphaeridae, 'sphaeridae.png', 2, { tolerance: 5, taille: 3, typeMacro: typeMacroEnum.mollusque, condition: [nomEnum.rapides, nomEnum.gravier], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.anisoptera, 'anisoptera.png', 3, { tolerance: 5, taille: 6, typeMacro: typeMacroEnum.odonate, condition: [nomEnum.rapides], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.glossosomatidae, 'glossosomatidae.png', 3, { tolerance: 0, taille: 5, typeMacro: typeMacroEnum.trichoptere, condition: [nomEnum.rapides, nomEnum.gravier, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.heptageniidae, 'heptageniidae.png', 3, { tolerance: 2, taille: 4, typeMacro: typeMacroEnum.ephemeroptere, condition: [nomEnum.rapides, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.ephemerellidae, 'ephemerellidae.png', 3, { tolerance: 1, taille: 4, typeMacro: typeMacroEnum.ephemeroptere, condition: [nomEnum.rapides, nomEnum.gravier], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.brachycentrus, 'brachycentrus.png', 3, { tolerance: 3, taille: 4, typeMacro: typeMacroEnum.trichoptere, condition: [nomEnum.rapides, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.rhyacophilidae, 'rhyacophilidae.png', 4, { tolerance: 0, taille: 4, typeMacro: typeMacroEnum.trichoptere, condition: [nomEnum.rapides], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.tipulidae, 'tipulidae.png', 4, { tolerance: 3, taille: 8, typeMacro: typeMacroEnum.diptere, condition: [nomEnum.fosse], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.gyrinidae, 'gyrinidae.png', 4, { tolerance: 4, taille: 5, typeMacro: typeMacroEnum.coleoptere, condition: [nomEnum.fosse], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.perlidae, 'perlidae.png', 4, { tolerance: 1, taille: 5, typeMacro: typeMacroEnum.plecoptere, condition: [nomEnum.rapides, nomEnum.gravier, nomEnum.galets], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.corydalidae, 'corydalidae.png', 5, { tolerance: 0, taille: 8, typeMacro: typeMacroEnum.megaloptere, condition: [nomEnum.rapides, nomEnum.gravier, nomEnum.galets], predateur: 1 });
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.nipidae, 'nepidae.png', 6, { tolerance: 6, taille: 9, typeMacro: typeMacroEnum.hemiptere, condition: [nomEnum.fosse], predateur: 1 });
            paquetCarte.push(carte)

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.decapoda, 'decapoda.png', 6, { tolerance: 5, taille: 10, typeMacro: typeMacroEnum.crustace, condition: [nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.macroInvertebre, nomEnum.pteronarcyidae, 'pteronarcyidae.png', 7, { tolerance: 0, taille: 8, typeMacro: typeMacroEnum.plecoptere, condition: [nomEnum.rapides, nomEnum.gravier, nomEnum.galets], predateur: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            //}

            //if (tour == 5) {
            //---------------------------------salmonide---------------------------------

            carte = new Carte(typeEnum.salmonide,  nomEnum.ombleFontaine, 'ombleFontaine.png', 10, { tolerance: 4, condition: [nomEnum.fosse, nomEnum.rapides, nomEnum.gravier, nomEnum.galets], predateur: 2 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            //---------------------------------bandeRiveraine----------------------------

            carte = new Carte(typeEnum.bandeRiveraine, nomEnum.herbace, 'herbaceesNaturelles.png', 1);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.bandeRiveraine, nomEnum.arbustes, 'arbustes.png', 2);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.bandeRiveraine, nomEnum.arbres, 'arbres.png', 3);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            //}


            //--------------------------perturbation--------------------------------------

            carte = new Carte(typeEnum.perturbation, nomEnum.dechets, 'dechets.png', 2, { tempsActif: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.perturbation, nomEnum.erosion, 'erosion.png', 3, { tempsActif: 0 });
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.perturbation, nomEnum.passageToutTerrain, 'passageToutTerrain.png', 3, { tempsActif: 1 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.perturbation, nomEnum.artificialisation, 'artificialisation.png', 3, { tempsActif: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.perturbation, nomEnum.pollutionOrganique, 'pollutionOrganique.png', 4, { tempsActif: 2 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.perturbation, nomEnum.deversement, 'deversement.png', 2, { tempsActif: 1 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);


            //--------------------------------reglementation----------------------------------------------

            carte = new Carte(typeEnum.reglementation, nomEnum.assainissement, 'assainissement.png', 3);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.reglementation,nomEnum.interdiction, 'interdiction.png', 3);
            paquetCarte.push(carte);

            carte = new Carte(typeEnum.reglementation, nomEnum.politique, 'politique.png', 3);
            paquetCarte.push(carte);

            if (difficulte === 2)//Moyen
            {

                //---------------------------action--------------------------------------

                carte = new Carte(typeEnum.action, nomEnum.corveNettoyage, 'corveNettoyage.png', 1);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.action, nomEnum.naturalisation, 'naturalisation.png', 2);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.action, nomEnum.amenagement, 'amenagement.png', 3);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                //---------------------------------intervention------------------------------

                carte = new Carte(typeEnum.intervention, nomEnum.amenageSable, 'habitatAmenageSable.png', 1, { habitats: nomEnum.sable });
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageRapides, 'habitatAmenageRapides.png', 1, { habitats: nomEnum.rapides });
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageFosse, 'habitatAmenageFosse.png', 1, { habitats: nomEnum.fosse });
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageGalets, 'habitatAmenageGalets.png', 1, { habitats: nomEnum.galets });
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageGravier, 'habitatAmenageGravier.png', 1, { habitats: nomEnum.gravier });
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageHerbace, 'bandeRiveraineHerbace.png', 1);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageArbustes, 'bandeRiveraineArbuste.png', 2);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.intervention, nomEnum.amenageArbre, 'bandeRiveraineArbre.png', 3);
                paquetCarte.push(carte);
            }

            if (difficulte >= 3)//Difficile
            {
                //-----------------------------------speciale--------------------------------

                carte = new Carte(typeEnum.speciale, nomEnum.prisSurFait, 'prisSurFait.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.pecheur, 'pecheur.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.crueSoudaine, 'crueSoudaine.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.zonage, 'zonage.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.retention, 'retention.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.emergence, 'emergence.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.derivation, 'derivation.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.accumulation, 'accumulation.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte(typeEnum.speciale, nomEnum.predation, 'predation.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
            }
            return paquetCarte;
        }

        //Fonction appelé pour défausser les cartes suplémentaires de la main.
        function defausserCarte() {
            var cartesDefausse = new Array();
            var buttonDefausser = document.createElement('button');
            buttonDefausser.id = 'buttonDefausser';
            buttonDefausser.className = 'buttonJeu';
            buttonDefausser.innerHTML = '<p>Défausser</p>';
            buttonDefausser.onclick = function () {
                onClickButtonDefausse(cartesDefausse);
            };
            $('.divMain').append(buttonDefausser);

            var plateauGrise = document.createElement('div');
            plateauGrise.id = 'plateauGrise';
            plateauGrise.className = 'zoneGrise'
            $('#plateau').append(plateauGrise);
            var divDroiteGrise = document.createElement('div');
            divDroiteGrise.id = 'divDroiteGrise';
            divDroiteGrise.className = 'zoneGrise'
            $('#divDroite').append(divDroiteGrise);

            $('#divDroite').css('pointer-events', 'none');
            $('#plateau').css('pointer-events', 'none');
            $('#divMain').addClass('divMainDefausse');
            $('.imageCarteMains').draggable('disable');

            mains[numeroJoueurActif].forEach(function (item, index) {
                $('#divCarte' + index).click(function () {
                    if (cartesDefausse[index] != null) {
                        cartesDefausse[index] = null;
                        $(this).removeAttr('style');
                    }
                    else {
                        $(this).css('-moz-box-shadow', '0 0 15px 10px #fff');
                        $(this).css('-webkit-box-shadow', '0 0 15px 10px #fff');
                        $(this).css('box-shadow', '0px 0px 15px 10px #fff');
                        cartesDefausse[index] = mains[numeroJoueurActif][index];
                    }
                });
            });
        }

        //Fonction appelé lors d'un clic sur le bouton Défausser.
        function onClickButtonDefausse(cartesDefausse) {
            sizeMain = mains[numeroJoueurActif].filter(function (value) { return value !== null }).length;
            sizeADefausse = cartesDefausse.filter(function (value) { return value !== null }).length;
            if ((sizeMain - sizeADefausse) === 4) {
                if (sizeADefausse != 0) {
                    cartesDefausse.forEach(function (item, index) {
                        if (item != null) {
                            paquetDecharge.push(item);
                            mains[numeroJoueurActif][index] = null;
                            var image = $('#divCarte' + index).children();
                            var x = ($('#paquetDefausse').offset().left) - ($(image).offset().left);
                            var y = ($('#paquetDefausse').offset().top) - ($(image).offset().top);
                            $(image).animate({
                                height: 91,
                                width: 59,
                                left: x,
                                top: y,
                                borderSpacing: 45
                            }, {
                                step: function (now, fx) {
                                    $(this).css('-webkit-transform', 'rotate(' + now + 'deg)');
                                    $(this).css('-moz-transform', 'rotate(' + now + 'deg)');
                                    $(this).css('transform', 'rotate(' + now + 'deg)');
                                }
                            }, { duration: 500 });
                            setTimeout(function () {
                                $(image).remove();
                                updateAffichageImage();
                            }, 500);
                        }
                    });
                    $('#plateauGrise').remove();
                    $('#divDroiteGrise').remove();
                    $('#divDroite').css('pointer-events', 'auto');
                    $('#plateau').css('pointer-events', 'auto');
                    $('.imageCarteMains').draggable('enable');
                    $('divMain').removeClass('divMainDefausse');
                    mains[numeroJoueurActif].forEach(function (item, index) {
                        $('#divCarte' + index).removeAttr('style');
                        $('#divCarte' + index).off('click');
                    });
                    $('#buttonDefausser').remove();
                    setTimeout(function () {
                        passerTour();
                    }, 600);
                }
                else {
                    popUpAvertissement('Selectionner d\'abord la/les carte(s) à défausser');
                }
            }
            else if ((sizeMain - sizeADefausse) > 4) {
                popUpErreur('Vous n\'avez pas sélectionné assez de cartes à défausser');
            }
            else {
                popUpErreur('Vous avez sélectionné trop de cartes à défausser');
            }
        }

        //Fonction appelé lors d'un clic sur le boutton Passer son tour.
        function passerTour() {
            if (!onMangeAtableCeSoir) {
                var size = mains[numeroJoueurActif].filter(function (value) { return value !== null }).length;

                //if (size > 4) {
                //    defausserCarte();
                //} else {
                $('#buttonPasserTour').prop('disabled', true);
                if (nombreJoueur === 4) {
                    facteurRotation += 1;
                    if (facteurRotation > 4) {
                        facteurRotation = 1;
                    }
                } else if (nombreJoueur === 2) {
                    facteurRotation += 2;
                    if (facteurRotation > 4) {
                        facteurRotation = 2
                    }
                } else if (nombreJoueur === 3) {
                    facteurRotation += 1;
                    if (facteurRotation > 4) {
                        facteurRotation = 1;
                    }
                    if (facteurRotation === 1) {
                        facteurRotation += 1;
                    }
                }

                var angleRotationDebut = (90 * (facteurRotation - 1));
                var angleRotationFin = (90 * facteurRotation);

                var $plateau = $('#plateau');
                $({ deg: angleRotationDebut }).animate({ deg: angleRotationFin }, {
                    duration: 1000,
                    step: function (now) {
                        $plateau.css('-webkit-transform', 'rotate(' + now + 'deg)');
                        $plateau.css('-moz-transform', 'rotate(' + now + 'deg)');
                        $plateau.css('transform', 'rotate(' + now + 'deg)');
                    }
                });

                if (deversement) {//Si un déversement est en cour.
                    if (numeroJoueurActif === numeroJoueurDeversement) {//Si c'est la fin du tour du joueur qui a déverser.
                        tempsDeversement--;
                        if (tempsDeversement === 0) {//Si le temps de déverseent est écouler, tue les macro et rends déversement à false.
                            tuerDeversement();
                            deversement = false;
                            popUpAvertissement('Un déversement de produits chimique viens d\'avoir lieu, tout les macroinvertébrés de résistance inférieur à 6 sont mort.');
                        }
                    }
                }

                for (i = mains[numeroJoueurActif].length - 1; i > 5; i--) {
                    mains[numeroJoueurActif].length--;
                    $('#liMain' + i).remove();
                }

                //Partie qui augmente le nombre de joueurs.
                numeroJoueurActif++;
                if (numeroJoueurActif === nombreJoueur) {
                    numeroJoueurActif = 0;
                }

                //Rends le bouton passer tour inactif lorsuq'on clique dessus pour éviter de "spam" le bouton.
                setTimeout(function () {
                    $('#buttonPasserTour').prop('disabled', false);
                }, 2000);

                tour++;
                remplirMain();
                updateJeu();
                setTimeout(function () {
                    updateAffichageImage();
                }, 500);
                
                popUpDebutTour(numeroJoueurActif);
                debutTourDeperturber();

                //}
            } else {
                popUpErreur('Vous devez d\'abord sélectionner un macro-invertébré d\'une taille inférieur à ' + taillePredateur + ' pour le manger.');
            }
        }

        //Fonction qui va regarder si le joueur à droits à des points de ressources additionel.
        function pointsRessourcesAdditionel() {
            //Variable qui contiendra le nombre de bande riveraine.
            var nombreBandeRiveraine = 0;
            //Variable des bandes riveraine différente si chacune est présente.
            var arbres = 0;
            var arbustes = 0;
            var herbace = 0;

            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueurActif][i] != null) {
                    if (carteBas[numeroJoueurActif][i].nom === nomEnum.amenageArbre || carteBas[numeroJoueurActif][i].nom === nomEnum.amenageArbustes ||carteBas[numeroJoueurActif][i].nom === nomEnum.amenageHerbace ||carteBas[numeroJoueurActif][i].type === typeEnum.bandeRiveraine) {
                        if (!carteBas[numeroJoueurActif][i].perturber) {
                            nombreBandeRiveraine++;
                            if (carteBas[numeroJoueurActif][i].nom === nomEnum.herbace || carteBas[numeroJoueurActif][i].nom === nomEnum.amenageHerbace) {
                                herbace++;
                            } else if (carteBas[numeroJoueurActif][i].nom === nomEnum.arbustes || carteBas[numeroJoueurActif][i].nom === nomEnum.amenageArbustes) {
                                arbuste++;
                            } else if (carteBas[numeroJoueurActif][i].nom === nomEnum.arbres || carteBas[numeroJoueurActif][i].nom === nomEnum.amenageArbre) {
                                arbres++;
                            }
                        }
                    }
                }
            }

            if (nombreBandeRiveraine > 3) {
                nombreBandeRiveraine = 3;
            }
            if (arbres === 1 && arbustes === 1 && herbace === 1) {
                //TODO: probleme d'affiche meme si les 2 sont present ne retourne pas 5.
                nombreBandeRiveraine = 5;
            }

            return nombreBandeRiveraine;
        }

        //Fonction qui remet les dimensions de la carte à son état original.
        function revertCarte(event, ui) {
            $('.emplacementJoueurA, .emplacementJoueurB, .emplacementJoueurC, .emplacementJoueurD, .plateau').removeClass('droppable-hover');
            if (event != false) {
                var id;
                id = $(event).attr('id').substr($(event).attr('id').length - 1);
                if (bonneZoneDrop(event)) {
                    if (accepterDrop(event)) {
                        if ($(event).attr('id') != 'plateau') {
                            if ($(event).children().length >= 1) {
                                if (carteDrag.nom != carteBas[numeroJoueurActif][id].nom) {
                                    $(ui).stop();
                                    $(ui).animate({
                                        height: 180,
                                        width: 118
                                    }, {
                                        duration: 500,
                                        queue: false,
                                        complete: function () {
                                            updateAffichageImage();
                                        }
                                    });
                                    return true;
                                } else {
                                    return false;
                                }
                            } else {
                                return false;
                            }
                        } else {
                            return false;
                        }
                    } else {
                        $(ui).stop();
                        $(ui).animate({
                            height: 180,
                            width: 118
                        }, {
                            duration: 500,
                            queue: false,
                            complete: function () {
                                updateAffichageImage();
                            }
                        });
                        return true;
                    }
                } else {
                    $(ui).stop();
                    $(ui).animate({
                        height: 180,
                        width: 118
                    }, {
                        duration: 500,
                        queue: false,
                        complete: function () {
                            updateAffichageImage();
                        }
                    });
                    return true;
                }
            } else {
                $(ui).stop();
                $(ui).animate({
                    height: 180,
                    width: 118
                }, {
                    duration: 500,
                    queue: false,
                    complete: function () {
                        updateAffichageImage();
                    }
                });
                return true;
            }
        }

        //Fonction pour appeler le pop-up d'erreur.
        function popUpErreur(texte) {
            $('#divTexteErreur').text(texte);
            $('#divErreur').dialog({
                classes: {
                    'ui-dialog': 'ui-state-error no-close ui-corner-all',
                    'ui-dialog-titlebar': 'no-header'
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 600,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction pour appeler le pop-up d'avertissement.
        function popUpAvertissement(texte) {
            $('#divTexteErreur').text(texte);
            $('#divErreur').dialog({
                classes: {
                    'ui-dialog': 'ui-state-highlight no-close ui-corner-all',
                    'ui-dialog-titlebar': 'no-header'
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 600,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction pour appeler le pop-up de confirmation.
        function popUpConfirmation(texte) {
            $('#divTexteErreur').text(texte);
            $('#divErreur').dialog({
                classes: {
                    'ui-dialog': 'popUpConfirmation no-close ui-state-highlight ui-corner-all',
                    'ui-dialog-titlebar': 'no-header'
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 600,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction qui appelle un pop-up qui indique le debut du tour d'un joueur
        function popUpDebutTour(numeroJoueur) {
            joueur = nomJoueur[numeroJoueur];
            $('#divTexteDebutTour').text('Début du tour de ' + joueur + '.');
            $('#divDebutTour').dialog({
                classes: {
                    'ui-dialog': 'popUpDebutTour no-close ui-corner-all',
                    'ui-dialog-titlebar': 'no-header'
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 400,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction qui appelle un pop-up qui permet au joueur de choisir parmis plusieurs options
        function popUpChoixMultiple(tableauBouton) {
            $('#divTexteChoixMultiple').text('Début du tour de ' + joueur + '.');
            var tabButtons = new Array(tableauBouton.length);
            tabButtons.forEach(function (item, index) {
                tabButtons[index].item = { text: tableauBouton[index][0].item, click: tableauBouton[index][1].item }
            });
            $('#divChoixMultiple').dialog({
                classes: {
                    'ui-dialog': 'popUpDebutTour no-close ui-corner-all',
                    'ui-dialog-titlebar': 'no-header'
                },
                draggable: false,
                resizable: false,
                height: 150,
                width: 400,
                hide: 'fade',
                show: 'fade',
                buttons: tabButtons
            });
        }

        //Function qui affiche un popUp contenant les règles du jeu.
        function popUpRegle() {
            var divRegle = document.createElement('div');
            divRegle.id = 'divRegle';
            divRegle.className = 'divRegle';
            $('body').append(divRegle);

            $(divRegle).dialog({
                classes: {
                    'ui-dialog': 'popUpRegle no-close ui-corner-all',
                    'ui-dialog-titlebar': 'no-header'
                },
                draggable: false,
                resizable: false,
                height: 575,
                width: 1050,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction qui "update" le jeu.
        function updateJeu() {
            pointsRessourcesBase[numeroJoueurActif] = 20;
            if (tableauRetention[numeroJoueurActif] != null) {
                if (tableauRetention[numeroJoueurActif] === true) {
                    pointsRessourcesBase[numeroJoueurActif] += pointsRessourcesRestant[numeroJoueurActif];
                    tableauRetention[numeroJoueurActif] = false;
                }
            }
            pointsRessourcesSuplementaire[numeroJoueurActif] = pointsRessourcesAdditionel();
            pointsRessourcesTotal[numeroJoueurActif] = pointsRessourcesBase[numeroJoueurActif] + pointsRessourcesSuplementaire[numeroJoueurActif];
            pointsRessourcesUtiliser[numeroJoueurActif] = 0;
            pointsRessourcesRestant[numeroJoueurActif] = pointsRessourcesTotal[numeroJoueurActif];

            calculerPoints();
            updatePointsRessources();
        }

        //Fonction qui "update" l'affichage des images.
        function updateAffichageImage() {
            for (i = 0; i < mains[numeroJoueurActif].length; i++) {
                var carteMain;
                if (document.getElementById('divCarte' + i) != null) {
                    carteMain = document.getElementById('divCarte' + i);
                    if (carteMain.children.length != 0) {
                        carteMain.removeChild(carteMain.firstChild);
                    }
                } else {
                    var li = document.createElement('li');
                    li.className = 'liMain';
                    li.id = 'liMain' + i;
                    document.getElementById('divMain').appendChild(li);

                    var divCarte = document.createElement('div');
                    divCarte.id = 'divCarte' + i;
                    divCarte.className = 'divCarte';
                    li.appendChild(divCarte);
                }

                if (mains[numeroJoueurActif][i] != null) {
                    var image = document.createElement('img');
                    var cloneImage = '<img class="imageTooltip" src="ressources/' + mains[numeroJoueurActif][i].nomImage + '">';
                    image.className = 'imageCarteMains';
                    image.src = 'ressources/' + mains[numeroJoueurActif][i].nomImage;
                    carteMain.appendChild(image);
                    $(image).tooltip({
                        items: 'img',
                        content: cloneImage,
                        position: { my: "right" },
                        show: { delay: 1000 }
                    });
                }

                if (mains[numeroJoueurActif].length <= 6) {
                    $('.liMain').css('height', '180px')
                    $('.liMain').css('width', '118px')
                } else if (mains[numeroJoueurActif].length > 10) {
                    $('.liMain').css('height', '90px')
                    $('.liMain').css('width', '59px')
                } else if (mains[numeroJoueurActif].length > 8) {
                    $('.liMain').css('height', '120px')
                    $('.liMain').css('width', '79px')
                } else if (mains[numeroJoueurActif].length > 6) {
                    $('.liMain').css('height', '144px')
                    $('.liMain').css('width', '94px')
                }

                if (paquetDecharge.length != 0) {
                    if ($('#paquetDefausse').children().length > 0) {
                        $('#paquetDefausse').children().remove();
                    }
                    var imageDecharge = document.createElement('img');
                    imageDecharge.src = 'ressources/' + paquetDecharge[paquetDecharge.length - 1].nomImage;
                    imageDecharge.className = 'imageCarteJeu';
                    $('#paquetDefausse').append(imageDecharge);
                }
            }
            $(function () {
                $('.imageCarteMains').draggable({
                    start: function () {
                        $(this).animate({
                            height: 90,
                            width: 58
                        }, { duration: 400, queue: false }
                        );
                        var id;
                        id = event.target.parentNode.id.substr(event.target.id.length - 1);

                        //Les if qui vont envoyer l'objet carte dans la variable.
                        carteDrag = mains[numeroJoueurActif][id];
                        carteDragNumero = id;
                    },
                    drag: function () {
                        $('.ui-tooltip').hide();
                    },
                    revert: function (socketObj) {
                        return revertCarte(socketObj, this);
                    },
                    revertDuration: 400,
                    cursorAt: { top: 45, left: 29 }
                });
            });
        }

        //Fonction qui update après avoir jouer une carte.
        function updatePointsRessources() {
            $('.divTextePointsRessource').html('<p class=titreRessource>Points ressources de base : ' + pointsRessourcesBase[numeroJoueurActif] + '</p><p class=titreRessource>Points ressources additionnels : ' + pointsRessourcesSuplementaire[numeroJoueurActif] + '</p><p class=titreRessource>Points ressources total : ' + pointsRessourcesTotal[numeroJoueurActif] + '</p><p class=titreRessource>Points ressources utilisés : ' + pointsRessourcesUtiliser[numeroJoueurActif] + '</p><p class=titreRessource><strong>Points ressources restant : ' + pointsRessourcesRestant[numeroJoueurActif] + '</strong></p>');
        }

        //Fonction qui calcule les points de chaque joueurs.
        function calculerPoints() {
            //Remes les différents points à 0.
            pointsJoueur[0] = 0;
            pointsJoueur[1] = 0;
            pointsJoueur[2] = 0;
            pointsJoueur[3] = 0;

            for (var i = 0; i < 10; i++) {
                if (carteBas[0][i] != null) {
                    pointsJoueur[0] += carteBas[0][i].coutResources;

                    if (exemplaireCarteBas[0][i] > 1) {
                        pointsJoueur[0] += exemplaireCarteBas[0][i] - 1;
                    }
                }
                if (nombreJoueur >= 2) {
                    if (carteBas[1][i] != null) {
                        pointsJoueur[1] += carteBas[1][i].coutResources;

                        if (exemplaireCarteBas[0][i] > 1) {
                            pointsJoueur[1] += exemplaireCarteBas[1][i] - 1;
                        }
                    }
                }
                if (nombreJoueur >= 3) {
                    if (carteBas[2][i] != null) {
                        pointsJoueur[2] += carteBas[2][i].coutResources;

                        if (exemplaireCarteBas[2][i] > 1) {
                            pointsJoueur[2] += exemplaireCarteBas[2][i] - 1;
                        }
                    }
                }
                if (nombreJoueur >= 4) {
                    if (carteBas[3][i] != null) {
                        pointsJoueur[3] += carteBas[3][i].coutResources;

                        if (exemplaireCarteBas[3][i] > 1) {
                            pointsJoueur[3] += exemplaireCarteBas[3][i] - 1;
                        }
                    }
                }
            }
        }

        //fonction qui va update les points des joueurs.
        function updateZonePoints() {
            if (nombreJoueur === 4) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + pointsJoueur[2] + '</li><li class=listeEquipe>Équipe D : ' + pointsJoueur[3] + '</li></ul>';
            } else if (nombreJoueur === 3) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + pointsJoueur[2] + '</li></ul>';
            } else if (nombreJoueur === 2) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li></ul>';
            } else if (nombreJoueur === 1) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li></ul>';
            }
        }
    </script>
</body>
</html>