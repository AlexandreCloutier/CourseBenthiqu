<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body onload="menuPrincipal()">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script src="scripts/jquery.flip.min.js"></script>
    <script>
        //TODO: changer ? des macro invertébrer
        //TODO: points ressources plus clair avec les bandes riveraines
        //Tableau contenant l'âge des joueurs.
        var ageJoueur;
        //Tableau contenant les noms des joueurs.
        var nomJoueur;
        //Tableau contenant les points des joueurs.
        var pointsJoueur;

        var difficulte;
        //Paquet de carte principal.
        var paquetCarte;
        //Paquet de carte de la décharge
        var paquetDecharge;
        /*-----------------------------Partie tableau de données---------------*/
        //Tableau contenant les mains.
        var mains;
        //Tableau contenant toute les cartes du bas de chaque joueur.
        var carteBas;
        //Tableau contenant le nombres d'exemplaire de chaque carte.
        var exemplaireCarteBas;
        //Tableau contenant les points de ressources.
        var pointsRessourcesBase;
        var pointsRessourcesSuplementaire;
        var pointsRessourcesTotal;
        var pointsRessourcesUtiliser;
        var pointsRessourcesRestant;
        //Numero du joueur présentement actif.
        var numeroJoueurActif;
        //Variable comptant le nombre de tour.
        var tour;
        //Variable content le nb de clic sur le bouton Passer son tour
        var facteurRotation;
        //Variable de la carte qui sera transférer de la main à la zone du bas, ou ailleurs.
        var carteDrag;
        //Variable du numero de la carte dans la main pour pouvoir le supprimer facilement lorsqu'on le drop à quelque part.
        var carteDragNumero;
        //Variable qui contient le nombre de joueur.
        var nombreJoueur;

        /*--------------------------Partie Échange---------------------------------*/
        //Variable qui nous dira si nous sommes en train d'échanger.
        var echange;
        //Variable qui nous dira si nous sommes rendu à la 2e carte à échanger.
        var renduCarte2;
        //Variable qui nous donnera la première carte a échanger.
        var carteEchanger1
        var positionCarteEchanger1;
        var emplacementCarte1;
        //Variable qui nous donnera la deuxième carte à échanger.
        var carteEchanger2;
        var positionCarteEchanger2;
        var numeroJoueurEchange2;
        var emplacementCarte2;

        //Fonction appeler au début, elle "start" le jeu.
        function startGame() {
            valeurDepartVariable();//Donne les valeurs de départs à nos variables.
            creerElementFond();//Crée touts les éléments du jeu.
            instantierTableaux();//Instantie tout les tableaux.
            instantierPaquetCarte();//Crée le paquet de carte de départ.
            updateJeu();
        }

        //Fonction qui donne les valeurs de départs à nos variables.
        function valeurDepartVariable() {
            numeroJoueurActif = 0;
            tour = 0;
            facteurRotation = 0;
            echange = false;
            renduCarte2 = false;
        }

        //Fonction qui va créer les diverse éléments du fond.
        function creerElementFond() {
            creerFond();
            creerEmplacementsPlateau();
            creerPartieDroite();
            creerMain();
            instancierDivErreur();
        }

        //Fonction qui s'occupe de créer le paquet de carte et de le mélanger au début de la partie.
        function instantierPaquetCarte() {
            paquetCarte = creerPaquetCarte(difficulte);
            melangerPaquetCarte(paquetCarte);
            remplirMain();
        }

        //Fonction qui appelle les fonctions qui instantie les différents tableaux.
        function instantierTableaux() {
            instantierTableauJoueur();
            instantierTableauEmplacementBas();
            instantierTableauPointsRessources();
            instantierTableauExemplaire();
            paquetDecharge = new Array();
        }

        //Fonction qui envoie vers les options de création de partie.
        function commencerNouvellePartie() {
            if (verifierConditionCreationPartie() === '') {
                $('#menuCreerPartie').remove();
                startGame();
            }
            else {
                $('#labelErreur').css('color', 'red');
                $('#labelErreur').html('<p></p>' + verifierConditionCreationPartie());
            }
        }

        //Fonction qui va vérifier les conditions des champs lors de la création d'une nouvelle partie.
        function verifierConditionCreationPartie() {
            var retour;

            if ($('#dropDownIA').val() === 'VJ') {
                if ($('#dropDownNombreJoueur').val() === '2') {
                    if ($('#nomJoueurA').val() != '' && $('#nomJoueurB').val() != '') {
                        if ($('#ageJoueurA').val() != '' && $('ageJoueurB').val() != '') {
                            entrerValeurCreationPartie();
                            return '';
                        }
                        else {
                            retour = "Veuillez entrer l'age de chacun des joueurs.";
                            return retour;
                        }
                    }
                    else {
                        retour = 'Veuillez entrer un nom pour chacun des joueurs.';
                        return retour;
                    }
                }
                else if ($('#dropDownNombreJoueur').val() === '3') {
                    if ($('#nomJoueurA').val() != '' && $('#nomJoueurB').val() != '' && $('#nomJoueurC').val() != '') {
                        if ($('#ageJoueurA').val() != '' && $('ageJoueurB').val() != '' && $('ageJoueurC').val() != '') {
                            entrerValeurCreationPartie();
                            return '';
                        }
                        else {
                            retour = "Veuillez entrer l'age de chacun des joueurs.";
                            return retour;
                        }
                    }
                    else {
                        retour = 'Veuillez entrer un nom pour chacun des joueurs.';
                        return retour;
                    }
                }
                else if ($('#dropDownNombreJoueur').val() === '4') {
                    if ($('#nomJoueurA').val() != '' && $('#nomJoueurB').val() && $('#nomJoueurC').val() != '' && $('#nomJoueurD').val() != '') {
                        if ($('#ageJoueurA').val() != '' && $('ageJoueurB').val() != '' && $('ageJoueurC').val() != '' && $('ageJoueurD').val() != '') {
                            entrerValeurCreationPartie();
                            return '';
                        }
                        else {
                            retour = "Veuillez entrer l'age de chacun des joueurs.";
                            return retour;
                        }
                    }
                    else {
                        retour = 'Veuillez entrer un nom pour chacun des joueurs.';
                        return retour;
                    }
                }
                else {
                    retour = 'Veuillez entrer un nombre de joueur.';
                    return retour;
                }
            }
            else {
                entrerValeurCreationPartie();
                return '';
            }
        }

        //Fonction qui va entrer les valeurs de créations de partie dans les variables.
        function entrerValeurCreationPartie() {
            nomJoueur = new Array();
            ageJoueur = new Array();
            pointsJoueur = new Array();

            if ($('#dropDownIA').val() === 'VJ') {
                difficulte = $('#dropDownDifficulte').val();

                if ($('#dropDownNombreJoueur').val() >= '2') {
                    nombreJoueur = 2;
                    nomJoueur[0] = $('#nomJoueurA').val();
                    nomJoueur[1] = $('#nomJoueurB').val();
                    ageJoueur[0] = $('#ageJoueurA').val();
                    ageJoueur[1] = $('#ageJoueurB').val();
                    pointsJoueur[0] = 0;
                    pointsJoueur[1] = 0;
                }
                if ($('#dropDownNombreJoueur').val() >= '3') {
                    nombreJoueur = 3;
                    nomJoueur[2] = $('#nomJoueurC').val();
                    ageJoueur[2] = $('#ageJoueurC').val();
                    pointsJoueur[2] = 0;
                }
                if ($('#dropDownNombreJoueur').val() >= '4') {
                    nombreJoueur = 4;
                    nomJoueur[3] = $('#nomJoueurD').val();
                    ageJoueur[3] = $('#ageJoueurD').val();
                    pointsJoueur[3] = 0;
                }
            }
            else {
                nombreJoueur = 1;
                difficulte = $('#dropDownDifficulte').val();
            }
        }

        //Fonction qui commence la partie.
        function lancerOptionPartie() {
            $('#menuPrincipal').remove();
            menuCreerPartie();
        }

        //Fonction qui fera s'occupera des échanges.
        function brillanceCarteEchange() {
            var lettreActif = lettreJoueur(numeroJoueurActif);
            var ennemi1;
            if (nombreJoueur >= 3) {
                var ennemi2;
            }
            if (nombreJoueur === 4) {
                var ennemi3;
            }

            if (nombreJoueur === 2) {
                if (lettreActif === 'A') {
                    ennemi1 = 'B';
                }
                else if (lettreActif === 'B') {
                    ennemi1 = 'A';
                }
            }
            else if (nombreJoueur === 3) {
                if (lettreActif === 'A') {
                    ennemi1 = 'B';
                    ennemi2 = 'C';
                }
                else if (lettreActif === 'B') {
                    ennemi1 = 'A';
                    ennemi2 = 'C';
                }
                else if (lettreActif === 'C') {
                    ennemi1 = 'A';
                    ennemi2 = 'B';
                }
            }
            else if (nombreJoueur === 4) {
                if (lettreActif === 'A') {
                    ennemi1 = 'B';
                    ennemi2 = 'C';
                    ennemi3 = 'D';
                }
                else if (lettreActif === 'B') {
                    ennemi1 = 'A';
                    ennemi2 = 'C';
                    ennemi3 = 'D';
                }
                else if (lettreActif === 'D') {
                    ennemi1 = 'A';
                    ennemi2 = 'B';
                    ennemi3 = 'C';
                }
                else if (lettreActif === 'C') {
                    ennemi1 = 'A';
                    ennemi2 = 'B';
                    ennemi3 = 'D';
                }
            }

            if (!renduCarte2) {
                if (echange) {
                    for (var i = 0; i < 6; i++) {
                        if ($('#emplacementBasJoueur' + lettreActif + i).children().length > 0) {
                            $('#emplacementBasJoueur' + lettreActif + i).addClass('ui-echange-highlight');
                        }
                    }
                    for (var i = 6; i < 10; i++) {
                        if ($('#emplacementHautJoueur' + lettreActif + i).children().length > 0) {
                            $('#emplacementHautJoueur' + lettreActif + i).addClass('ui-echange-highlight');
                        }
                    }
                }
                else {
                    for (var i = 0; i < 6; i++) {
                        $('#emplacementBasJoueur' + lettreActif + i).removeClass('ui-echange-highlight');
                    }
                    for (var i = 6; i < 10; i++) {
                        $('#emplacementHautJoueur' + lettreActif + i).removeClass('ui-echange-highlight');
                    }
                }
            }
            if (renduCarte2) {
                for (var i = 0; i < 6; i++) {
                    if ($('#emplacementBasJoueur' + ennemi1 + i).children().length > 0) {
                        $('#emplacementBasJoueur' + ennemi1 + i).addClass('ui-echange-highlight');
                    }
                    if (nombreJoueur >= 3) {
                        if ($('#emplacementBasJoueur' + ennemi2 + i).children().length > 0) {
                            $('#emplacementBasJoueur' + ennemi2 + i).addClass('ui-echange-highlight');
                        }
                    }
                    if (nombreJoueur === 4) {
                        if ($('#emplacementBasJoueur' + ennemi3 + i).children().length > 0) {
                            $('#emplacementBasJoueur' + ennemi3 + i).addClass('ui-echange-highlight');
                        }
                    }
                }
                for (var i = 6; i < 10; i++) {
                    if ($('#emplacementHautJoueur' + ennemi1 + i).children().length > 0) {
                        $('#emplacementHautJoueur' + ennemi1 + i).addClass('ui-echange-highlight');
                    }
                    if (nombreJoueur >= 3) {
                        if ($('#emplacementHautJoueur' + ennemi2 + i).children().length > 0) {
                            $('#emplacementHautJoueur' + ennemi2 + i).addClass('ui-echange-highlight');
                        }
                    }
                    if (nombreJoueur === 4) {
                        if ($('#emplacementHautJoueur' + ennemi3 + i).children().length > 0) {
                            $('#emplacementHautJoueur' + ennemi3 + i).addClass('ui-echange-highlight');
                        }
                    }
                }
            }
            else {
                for (var i = 0; i < 6; i++) {
                    if ($('#emplacementBasJoueur' + ennemi1 + i).children().length > 0) {
                        $('#emplacementBasJoueur' + ennemi1 + i).removeClass('ui-echange-highlight');
                    }
                    if (nombreJoueur >= 3) {
                        if ($('#emplacementBasJoueur' + ennemi2 + i).children().length > 0) {
                            $('#emplacementBasJoueur' + ennemi2 + i).removeClass('ui-echange-highlight');
                        }
                    }
                    if (nombreJoueur === 4) {
                        if ($('#emplacementBasJoueur' + ennemi3 + i).children().length > 0) {
                            $('#emplacementBasJoueur' + ennemi3 + i).removeClass('ui-echange-highlight');
                        }
                    }
                }
                for (var i = 6; i < 10; i++) {
                    if ($('#emplacementHautJoueur' + ennemi1 + i).children().length > 0) {
                        $('#emplacementHautJoueur' + ennemi1 + i).removeClass('ui-echange-highlight');
                    }
                    if (nombreJoueur >= 3) {
                        if ($('#emplacementHautJoueur' + ennemi2 + i).children().length > 0) {
                            $('#emplacementHautJoueur' + ennemi2 + i).removeClass('ui-echange-highlight');
                        }
                    }
                    if (nombreJoueur === 4) {
                        if ($('#emplacementHautJoueur' + ennemi3 + i).children().length > 0) {
                            $('#emplacementHautJoueur' + ennemi3 + i).removeClass('ui-echange-highlight');
                        }
                    }
                }
            }
        }

        //Fonction qui affiche l'écran d'introduction.
        function menuPrincipal() {
            $('#menuCreerPartie').remove();
            var menuPrincipal = document.createElement('div');
            menuPrincipal.id = 'menuPrincipal';
            menuPrincipal.className = 'menuPrincipal';
            menuPrincipal.innerHTML = '<img class="imageMenuPrincipal" src="ressources/logo.png" />';
            $('body').append(menuPrincipal);

            var buttonNouvellePartie = document.createElement('button');
            buttonNouvellePartie.id = 'buttonNouvellePartie';
            buttonNouvellePartie.className = 'buttonMenuPrincipal';
            buttonNouvellePartie.innerHTML = 'Nouvelle partie';
            buttonNouvellePartie.onclick = lancerOptionPartie;
            buttonNouvellePartie.style.bottom = '215px';
            $('#menuPrincipal').append(buttonNouvellePartie);

            var buttonChargerPartie = document.createElement('button');
            //buttonChargerPartie.type = 'file'
            buttonChargerPartie.id = 'buttonChargerPartie';
            buttonChargerPartie.className = 'buttonMenuPrincipal';
            buttonChargerPartie.innerHTML = 'Charger une partie';
            buttonChargerPartie.style.bottom = '155px';
            //buttonChargerPartie.onclick = chargerPartie;
            $('#menuPrincipal').append(buttonChargerPartie);

            var buttonOptions = document.createElement('button');
            buttonOptions.id = 'buttonOptions';
            buttonOptions.className = 'buttonMenuPrincipal';
            buttonOptions.innerHTML = 'Options';
            buttonOptions.style.bottom = '95px';
            $('#menuPrincipal').append(buttonOptions);

            var buttonCredits = document.createElement('button');
            buttonCredits.id = 'buttonCredits';
            buttonCredits.className = 'buttonMenuPrincipal';
            buttonCredits.innerHTML = 'Crédits';
            buttonCredits.style.bottom = '35px';
            $('#menuPrincipal').append(buttonCredits);
        }

        //Fonction qui affiche l'écran de création de partie.
        function menuCreerPartie() {
            var menuCreerPartie = document.createElement('div');
            menuCreerPartie.id = 'menuCreerPartie';
            menuCreerPartie.className = 'menuCreerPartie';
            //menuCreerPartie.innerHTML = '<img class="imageMenuCreerPartie" src="ressources/cartes.png" />';
            $('body').append(menuCreerPartie);

            var divTexteModePartie = document.createElement('div');
            divTexteModePartie.id = 'divTexteModePartie';
            divTexteModePartie.className = 'divTexteModePartie';
            divTexteModePartie.innerHTML = '<p class=modePartie><strong>Mode de jeu: </strong>';
            $('#menuCreerPartie').append(divTexteModePartie);

            var dropDownIA = document.createElement('select');
            dropDownIA.id = 'dropDownIA';
            dropDownIA.className = 'dropDownIA';
            var option2 = document.createElement("option");
            option2.value = "VJ";
            option2.innerHTML = "Contre vrai joueur";
            dropDownIA.appendChild(option2);
            var option1 = document.createElement("option");
            option1.value = "IA";
            option1.innerHTML = "Contre ordinateur";
            dropDownIA.appendChild(option1);
            $('#menuCreerPartie').append(dropDownIA);
            $(function () {
                $('.dropDownIA').on({
                    change: function () {
                        if (this.value === 'VJ') {
                            $('#divTexteNombreJoueur').show();
                            $('#dropDownNombreJoueur').show();
                        }
                        else if (this.value === 'IA') {
                            $('#divTexteNombreJoueur').hide();
                            $('#dropDownNombreJoueur').hide();

                            $('#nomJoueurA').hide();
                            $('#nomJoueurB').hide();
                            $('#nomJoueurC').hide();
                            $('#nomJoueurD').hide();

                            $('#ageJoueurA').hide();
                            $('#ageJoueurB').hide();
                            $('#ageJoueurC').hide();
                            $('#ageJoueurD').hide();

                            $('#labelAgeJoueurA').hide();
                            $('#labelAgeJoueurB').hide();
                            $('#labelAgeJoueurC').hide();
                            $('#labelAgeJoueurD').hide();
                        }
                    }
                });
            });

            var divTexteNombreJoueur = document.createElement('div');
            divTexteNombreJoueur.id = 'divTexteNombreJoueur';
            divTexteNombreJoueur.className = 'divTexteNombreJoueur';
            divTexteNombreJoueur.innerHTML = '<p class=nombreJoueur><strong>Nombre de joueur: </strong>';
            $('#menuCreerPartie').append(divTexteNombreJoueur);

            var dropDownNombreJoueur = document.createElement('select');
            dropDownNombreJoueur.id = 'dropDownNombreJoueur';
            dropDownNombreJoueur.className = 'dropDownNombreJoueur';
            var option5 = document.createElement('option');
            option5.value = '0';
            option5.innerHTML = '';
            dropDownNombreJoueur.appendChild(option5);
            var option2 = document.createElement('option');
            option2.value = '2';
            option2.innerHTML = '2';
            dropDownNombreJoueur.appendChild(option2);
            var option3 = document.createElement('option');
            option3.value = '3';
            option3.innerHTML = '3';
            dropDownNombreJoueur.appendChild(option3);
            var option4 = document.createElement('option');
            option4.value = '4';
            option4.innerHTML = '4';
            dropDownNombreJoueur.appendChild(option4);
            $('#menuCreerPartie').append(dropDownNombreJoueur);
            $(function () {
                $('.dropDownNombreJoueur').on({
                    change: function () {
                        if (this.value === '0') {
                            $('#nomJoueurA').hide();
                            $('#nomJoueurB').hide();
                            $('#nomJoueurC').hide();
                            $('#nomJoueurD').hide();

                            $('#ageJoueurA').hide();
                            $('#ageJoueurB').hide();
                            $('#ageJoueurC').hide();
                            $('#ageJoueurD').hide();

                            $('#labelNomJoueurA').hide();
                            $('#labelNomJoueurB').hide();
                            $('#labelNomJoueurC').hide();
                            $('#labelNomJoueurD').hide();

                            $('#labelAgeJoueurA').hide();
                            $('#labelAgeJoueurB').hide();
                            $('#labelAgeJoueurC').hide();
                            $('#labelAgeJoueurD').hide();
                        }
                        else if (this.value === '2') {
                            $('#nomJoueurA').show();
                            $('#nomJoueurB').show();
                            $('#nomJoueurC').hide();
                            $('#nomJoueurD').hide();

                            $('#ageJoueurA').show();
                            $('#ageJoueurB').show();
                            $('#ageJoueurC').hide();
                            $('#ageJoueurD').hide();

                            $('#labelNomJoueurA').show();
                            $('#labelNomJoueurB').show();
                            $('#labelNomJoueurC').hide();
                            $('#labelNomJoueurD').hide();

                            $('#labelAgeJoueurA').show();
                            $('#labelAgeJoueurB').show();
                            $('#labelAgeJoueurC').hide();
                            $('#labelAgeJoueurD').hide();
                        }
                        else if (this.value === '3') {
                            $('#nomJoueurA').show();
                            $('#nomJoueurB').show();
                            $('#nomJoueurC').show();
                            $('#nomJoueurD').hide();

                            $('#ageJoueurA').show();
                            $('#ageJoueurB').show();
                            $('#ageJoueurC').show();
                            $('#ageJoueurD').hide();

                            $('#labelNomJoueurA').show();
                            $('#labelNomJoueurB').show();
                            $('#labelNomJoueurC').show();
                            $('#labelNomJoueurD').hide();

                            $('#labelAgeJoueurA').show();
                            $('#labelAgeJoueurB').show();
                            $('#labelAgeJoueurC').show();
                            $('#labelAgeJoueurD').hide();
                        }
                        else if (this.value === '4') {
                            $('#nomJoueurA').show();
                            $('#nomJoueurB').show();
                            $('#nomJoueurC').show();
                            $('#nomJoueurD').show();

                            $('#ageJoueurA').show();
                            $('#ageJoueurB').show();
                            $('#ageJoueurC').show();
                            $('#ageJoueurD').show();

                            $('#labelNomJoueurA').show();
                            $('#labelNomJoueurB').show();
                            $('#labelNomJoueurC').show();
                            $('#labelNomJoueurD').show();

                            $('#labelAgeJoueurA').show();
                            $('#labelAgeJoueurB').show();
                            $('#labelAgeJoueurC').show();
                            $('#labelAgeJoueurD').show();
                        }
                    }
                });
            });

            var labelNomJoueurA = document.createElement("Label");
            labelNomJoueurA.id = 'labelNomJoueurA';
            labelNomJoueurA.className = 'labelNomJoueurA';
            labelNomJoueurA.innerHTML = "<p></p><strong>Nom du joueur: </strong>";
            $('#menuCreerPartie').append(labelNomJoueurA);

            var nomJoueurA = document.createElement('input');
            nomJoueurA.type = "text";
            nomJoueurA.id = 'nomJoueurA';
            nomJoueurA.className = 'nomJoueurA';
            $('#menuCreerPartie').append(nomJoueurA);

            var labelAgeJoueurA = document.createElement("Label");
            labelAgeJoueurA.id = 'labelAgeJoueurA';
            labelAgeJoueurA.className = 'labelAgeJoueurA';
            labelAgeJoueurA.innerHTML = "<p></p><strong>Age du joueur: </strong>";
            $('#menuCreerPartie').append(labelAgeJoueurA);

            var ageJoueurA = document.createElement('input');
            ageJoueurA.type = "text";
            ageJoueurA.id = 'ageJoueurA';
            ageJoueurA.className = 'ageJoueurA';
            $('#menuCreerPartie').append(ageJoueurA);

            var labelNomJoueurB = document.createElement("Label");
            labelNomJoueurB.id = 'labelNomJoueurB';
            labelNomJoueurB.className = 'labelNomJoueurB';
            labelNomJoueurB.innerHTML = "<p></p><strong>Nom du joueur: </strong>";
            $('#menuCreerPartie').append(labelNomJoueurB);

            var nomJoueurB = document.createElement('input');
            nomJoueurB.type = "text";
            nomJoueurB.id = 'nomJoueurB';
            nomJoueurB.className = 'nomJoueurB';
            $('#menuCreerPartie').append(nomJoueurB);

            var labelAgeJoueurB = document.createElement("Label");
            labelAgeJoueurB.id = 'labelAgeJoueurB';
            labelAgeJoueurB.className = 'labelAgeJoueurB';
            labelAgeJoueurB.innerHTML = "<p></p><strong>Age du joueur: </strong>";
            $('#menuCreerPartie').append(labelAgeJoueurB);

            var ageJoueurB = document.createElement('input');
            ageJoueurB.type = "text";
            ageJoueurB.id = 'ageJoueurB';
            ageJoueurB.className = 'ageJoueurB';
            $('#menuCreerPartie').append(ageJoueurB);

            var labelNomJoueurC = document.createElement("Label");
            labelNomJoueurC.id = 'labelNomJoueurC';
            labelNomJoueurC.className = 'labelNomJoueurC';
            labelNomJoueurC.innerHTML = "<p></p><strong>Nom du joueur: </strong>";
            $('#menuCreerPartie').append(labelNomJoueurC);

            var nomJoueurC = document.createElement('input');
            nomJoueurC.type = "text";
            nomJoueurC.id = 'nomJoueurC';
            nomJoueurC.className = 'nomJoueurC';
            $('#menuCreerPartie').append(nomJoueurC);

            var labelAgeJoueurC = document.createElement("Label");
            labelAgeJoueurC.id = 'labelAgeJoueurC';
            labelAgeJoueurC.className = 'labelAgeJoueurC';
            labelAgeJoueurC.innerHTML = "<p></p><strong>Age du joueur: </strong>";
            $('#menuCreerPartie').append(labelAgeJoueurC);

            var ageJoueurC = document.createElement('input');
            ageJoueurC.type = "text";
            ageJoueurC.id = 'ageJoueurC';
            ageJoueurC.className = 'ageJoueurC';
            $('#menuCreerPartie').append(ageJoueurC);

            var labelNomJoueurD = document.createElement("Label");
            labelNomJoueurD.id = 'labelNomJoueurD';
            labelNomJoueurD.className = 'labelNomJoueurD';
            labelNomJoueurD.innerHTML = "<p></p><strong>Nom du joueur: </strong>";
            $('#menuCreerPartie').append(labelNomJoueurD);

            var nomJoueurD = document.createElement('input');
            nomJoueurD.type = "text";
            nomJoueurD.id = 'nomJoueurD';
            nomJoueurD.className = 'nomJoueurD';
            $('#menuCreerPartie').append(nomJoueurD);

            var labelAgeJoueurD = document.createElement("Label");
            labelAgeJoueurD.id = 'labelAgeJoueurD';
            labelAgeJoueurD.className = 'labelAgeJoueurD';
            labelAgeJoueurD.innerHTML = "<p></p><strong>age du joueur: </strong>";
            $('#menuCreerPartie').append(labelAgeJoueurD);

            var ageJoueurD = document.createElement('input');
            ageJoueurD.type = "text";
            ageJoueurD.id = 'ageJoueurD';
            ageJoueurD.className = 'ageJoueurD';
            $('#menuCreerPartie').append(ageJoueurD);

            $('#nomJoueurA').hide();
            $('#nomJoueurB').hide();
            $('#nomJoueurC').hide();
            $('#nomJoueurD').hide();

            $('#ageJoueurA').hide();
            $('#ageJoueurB').hide();
            $('#ageJoueurC').hide();
            $('#ageJoueurD').hide();

            $('#labelNomJoueurA').hide();
            $('#labelNomJoueurB').hide();
            $('#labelNomJoueurC').hide();
            $('#labelNomJoueurD').hide();

            $('#labelAgeJoueurA').hide();
            $('#labelAgeJoueurB').hide();
            $('#labelAgeJoueurC').hide();
            $('#labelAgeJoueurD').hide();

            var divTexteDifficulte = document.createElement('div');
            divTexteDifficulte.id = 'divTexteDifficulte';
            divTexteDifficulte.className = 'divTexteDifficulte';
            divTexteDifficulte.innerHTML = '<p class=difficulte><strong>Difficulté de la partie: </strong>';
            $('#menuCreerPartie').append(divTexteDifficulte);

            var dropDownDifficulte = document.createElement('select');
            dropDownDifficulte.id = 'dropDownDifficulte';
            dropDownDifficulte.className = 'dropDownDifficulte';
            var option1 = document.createElement("option");
            option1.value = "1";
            option1.innerHTML = "Facile";
            dropDownDifficulte.appendChild(option1);
            var option2 = document.createElement("option");
            option2.value = "2";
            option2.innerHTML = "Moyen";
            dropDownDifficulte.appendChild(option2);
            var option3 = document.createElement("option");
            option3.value = "3";
            option3.innerHTML = "Difficile";
            dropDownDifficulte.appendChild(option3);
            $('#menuCreerPartie').append(dropDownDifficulte);

            var labelErreur = document.createElement('label');
            labelErreur.className = 'labelErreur';
            labelErreur.id = 'labelErreur';
            $('#menuCreerPartie').append(labelErreur);

            var buttonDebuter = document.createElement('button');
            buttonDebuter.id = 'buttonDebuter';
            buttonDebuter.className = 'buttonMenuPrincipal';
            buttonDebuter.innerHTML = 'Débuter';
            buttonDebuter.style.bottom = '95px';
            buttonDebuter.onclick = commencerNouvellePartie;
            $('#menuCreerPartie').append(buttonDebuter);

            var buttonRetour = document.createElement('button');
            buttonRetour.id = 'buttonRetour';
            buttonRetour.className = 'buttonMenuPrincipal';
            buttonRetour.innerHTML = 'Retour';
            buttonRetour.style.bottom = '35px';
            buttonRetour.onclick = menuPrincipal;
            $('#menuCreerPartie').append(buttonRetour);
        }

        //function chargerPartie() {
        //var charger = $('#buttonChargerPartie');
        //upclick({
        //    element: charger,
        //    action: '/',
        //    onstart: function (filename) {
        //        alert('Start Upload:' + filename);
        //    },
        //    oncomplete: function (response_data) {
        //        alert(response_data);
        //    }
        //});
        //}

        //Fonction appelé lors d'un clic sur le bouton Options en jeu
        function ouvrirOptionsEnJeu() {
            var divOptions = document.createElement('div');
            divOptions.id = 'divOptions';
            divOptions.className = 'divOptions';
            $('#plateau').append(divOptions);

            var divTitreOptions = document.createElement('div');
            divTitreOptions.id = 'divTitreOptions';
            divTitreOptions.className = 'divTitreOptions';
            divTitreOptions.innerHTML = '<p>Options</p>';
            divOptions.appendChild(divTitreOptions);

            var labelResolution = document.createElement('label');
            labelResolution.id = 'labelResolution';
            labelResolution.className = 'labelResolution';
            labelResolution.innerHTML = '<span>Résolution : </span>'
            divOptions.appendChild(labelResolution);

            var dropDownReso = document.createElement('select');
            dropDownReso.id = 'dropDownReso';
            dropDownReso.className = 'dropDownReso';
            divOptions.appendChild(dropDownReso);
            var option1 = document.createElement('option');
            option1.value = '1';
            option1.innerHTML = '1280 x 720';
            dropDownReso.appendChild(option1);

            var labelPopUp = document.createElement('label');
            labelPopUp.id = 'labelPopUp';
            labelPopUp.className = 'labelPopUp';
            labelPopUp.innerHTML = '<span>Activé les pop-ups éducatifs : </span>'
            divOptions.appendChild(labelPopUp);

            var checkBoxPopUp = document.createElement('input');
            checkBoxPopUp.type = 'checkbox';
            checkBoxPopUp.id = 'checkBoxPopUp';
            checkBoxPopUp.value = 'PopUpActif';
            checkBoxPopUp.className = 'checkBoxPopUp';
            divOptions.appendChild(checkBoxPopUp);

            $(divOptions).dialog({
                classes: {
                    'ui-dialog': 'no-close ui-corner-all',
                },
                draggable: false,
                resizable: false,
                buttons: [{
                    text: 'Valider'
                }, {
                    text: 'Annuler'
                }],
                height: 300,
                width: 400,
                hide: 'fade',
                show: 'fade'
            });
        }

        //Fonction qui va instantier et remplir le tableau des points de ressources.
        function instantierTableauPointsRessources() {
            pointsRessourcesBase = new Array(nombreJoueur);
            pointsRessourcesBase[0] = 6;
            pointsRessourcesBase[1] = 6;
            pointsRessourcesRestant = new Array(nombreJoueur);
            pointsRessourcesSuplementaire = new Array(nombreJoueur);
            pointsRessourcesTotal = new Array(nombreJoueur);
            pointsRessourcesUtiliser = new Array(nombreJoueur);

            if (nombreJoueur >= 3) {
                pointsRessourcesBase[2] = 6;
            }
            if (nombreJoueur === 4) {
                pointsRessourcesBase[3] = 6;
            }
        }

        //Fonction qui va instantier le tableau bi-dimensionel de mains.
        function instantierTableauJoueur() {
            mains = new Array(nombreJoueur);

            //Minimum de 2 joueurs.
            mains[0] = new Array(6);
            mains[1] = new Array(6);

            if (nombreJoueur >= 3) {//3 joueurs.
                mains[2] = new Array(6);
            }
            if (nombreJoueur === 4) {//4 joueurs.
                mains[3] = new Array(6);
            }
        }

        //Fonction qui va instantier le tableau des exemplaire du bas.
        function instantierTableauExemplaire() {
            exemplaireCarteBas = new Array(nombreJoueur);
            exemplaireCarteBas[0] = new Array(6);
            exemplaireCarteBas[1] = new Array(6);

            if (nombreJoueur >= 3) {
                exemplaireCarteBas[2] = new Array(6);
            }
            if (nombreJoueur === 4) {
                exemplaireCarteBas[3] = new Array(6);
            }
        }

        //Fonction qui va instantier le tableau bi-dimensionel d'emplacement bas.
        function instantierTableauEmplacementBas() {
            carteBas = new Array(4);

            //Minimum de 2 joueurs.
            carteBas[0] = new Array(10);
            carteBas[1] = new Array(10);

            if (nombreJoueur >= 3) {//3 joueurs.
                carteBas[2] = new Array(10);
            }
            if (nombreJoueur === 4) {//4 joueurs.
                carteBas[3] = new Array(10);
            }
        }

        //Fontion creer la div qui servira pour les pop-ups d'erreur.
        function instancierDivErreur() {
            var divErreur = document.createElement('div');
            divErreur.id = 'divErreur';
            divErreur.className = 'divErreur';
            $('#plateau').append(divErreur);

            var divTexteErreur = document.createElement('div');
            divTexteErreur.id = 'divTexteErreur';
            divTexteErreur.className = 'divTexteErreur';
            $('#divErreur').append(divTexteErreur);
        }

        //Fonction qui vérifie si le macroInvertebre ou le salmonide est jouable.
        function verifierCondition(carte) {
            if (carte.condition.length === 1) {
                if (carte.condition[0] === '?') {
                    for (var i = 0; i < 10; i++) {
                        if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                            if (carteBas[numeroJoueurActif][i].type === 'habitats' || carteBas[numeroJoueurActif][i].type === 'intervention') {// Si la carte est une habitats.
                                return true;
                            }
                        }
                    }
                }

                var condition1 = carte.condition[0];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if (carteBas[numeroJoueurActif][i].type === 'habitats' || carteBas[numeroJoueurActif][i].type === 'intervention') {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition.
                                return true;
                            }
                        }
                    }
                }
            }
            else if (carte.condition.length === 2) {
                var condition1 = carte.condition[0];
                var condition2 = carte.condition[1];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if (carteBas[numeroJoueurActif][i].type === 'habitats' || carteBas[numeroJoueurActif][i].type === 'intervention') {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition1.
                                condition1 = 'ok';
                            }
                            else if (carteBas[numeroJoueurActif][i].habitats === condition2) {//Si l'habitats de la carte est la meme que la condition2.
                                condition2 = 'ok';
                            }
                        }
                    }
                }

                if (condition1 === 'ok' && condition2 === 'ok') {
                    return true;
                }
            }
            else if (carte.condition.length === 3) {
                var condition1 = carte.condition[0];
                var condition2 = carte.condition[1];
                var condition3 = carte.condition[2];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if (carteBas[numeroJoueurActif][i].type === 'habitats' || carteBas[numeroJoueurActif][i].type === 'intervention') {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition1.
                                condition1 = 'ok';
                            }
                            else if (carteBas[numeroJoueurActif][i].habitats === condition2) {//Si l'habitats de la carte est la meme que la condition2.
                                condition2 = 'ok';
                            }
                            else if (carteBas[numeroJoueurActif][i].habitats === condition3) {//Si l'habitats de la carte est la meme que la condition3.
                                condition3 = 'ok';
                            }
                        }
                    }
                }

                if (condition1 === 'ok' && condition2 === 'ok' && condition3 === 'ok') {
                    return true;
                }
            }
            else if (carte.condition.length === 4) {
                var condition1 = carte.condition[0];
                var condition2 = carte.condition[1];
                var condition3 = carte.condition[2];
                var condition4 = carte.condition[3];

                for (var i = 0; i < 10; i++) {
                    if (carteBas[numeroJoueurActif][i] != null) {// Si il y a une carte.
                        if (carteBas[numeroJoueurActif][i].type === 'habitats' || carteBas[numeroJoueurActif][i].type === 'intervention') {// Si la carte est une habitats.
                            if (carteBas[numeroJoueurActif][i].habitats === condition1) {//Si l'habitats de la carte est la meme que la condition1.
                                condition1 = 'ok';
                            }
                            else if (carteBas[numeroJoueurActif][i].habitats === condition2) {//Si l'habitats de la carte est la meme que la condition2.
                                condition2 = 'ok';
                            }
                            else if (carteBas[numeroJoueurActif][i].habitats === condition3) {//Si l'habitats de la carte est la meme que la condition3.
                                condition3 = 'ok';
                            }
                            else if (carteBas[numeroJoueurActif][i].habitats === condition4) {//Si l'habitats de la carte est la meme que la condition4.
                                condition4 = 'ok';
                            }
                        }
                    }
                }

                if (condition1 === 'ok' && condition2 === 'ok' && condition3 === 'ok' && condition4 === 'ok') {
                    return true;
                }
            }
            else {
                return false;
            }
        }

        //Fonction qui sera fréquement appeler pour ré-emplir la main.
        function remplirMain() {
            if (tour === 0) {//Avant de commencer, remplie toutes les mains.
                //Première carte c'est un habitats rapides.
                mains[0][0] = chercherCarteParticuliere('rapides', paquetCarte);
                mains[1][0] = chercherCarteParticuliere('rapides', paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][0] = chercherCarteParticuliere('rapides', paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][0] = chercherCarteParticuliere('rapides', paquetCarte);
                }

                //Deuxième carte c'est un habitats au hasard.
                mains[0][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);
                mains[1][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][1] = chercherCarteParticuliere(habitatsHasard(), paquetCarte);
                }

                //3e carte
                mains[0][2] = pigerCarte(paquetCarte);
                mains[1][2] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][2] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][2] = pigerCarte(paquetCarte);
                }

                //4e carte
                mains[0][3] = pigerCarte(paquetCarte);
                mains[1][3] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][3] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][3] = pigerCarte(paquetCarte);
                }

                //5e carte
                mains[0][4] = pigerCarte(paquetCarte);
                mains[1][4] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][4] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][4] = pigerCarte(paquetCarte);
                }

                //6e carte
                mains[0][5] = pigerCarte(paquetCarte);
                mains[1][5] = pigerCarte(paquetCarte);

                if (nombreJoueur >= 3) {//3 joueurs.
                    mains[2][5] = pigerCarte(paquetCarte);
                }
                if (nombreJoueur === 4) {//4 joueurs.
                    mains[3][5] = pigerCarte(paquetCarte);
                }
            }
            else {
                //Boucle pour toute les position de la main.
                for (var i = 0; i < 6; i++) {
                    if (mains[numeroJoueurActif][i] === null) {
                        appelerTimerPigerCarte(i);
                    }
                }
            }
        }

        //Fonction qui renvoie une string d'un habitats au hasard pour permettre qu'on aille la chercher au début de la partie.
        function habitatsHasard() {
            var habitatsRetourner;//Habitats qui sera retourner.

            //Variable qui contiendra le nombres de chaque habitats qui sont présentement dans le paquet de carte.
            var nombreHabitats = 0;
            var nombreFosse = 0;
            var nombreRapides = 0;
            var nombreSable = 0;
            var nombreGravier = 0;
            var nombreGalets = 0;

            for (var i = 0; i < paquetCarte.length ; i++) {
                if (paquetCarte[i].nom === 'fosse') {
                    nombreFosse++;
                    nombreHabitats++;
                }
                else if (paquetCarte[i].nom === 'sable') {
                    nombreSable++;
                    nombreHabitats++;
                }
                else if (paquetCarte[i].nom === 'gravier') {
                    nombreGravier++;
                    nombreHabitats++;
                }
                else if (paquetCarte[i].nom === 'rapides') {
                    nombreRapides++;
                    nombreHabitats++;
                }
                else if (paquetCarte[i].nom === 'galets') {
                    nombreGalets++;
                    nombreHabitats++;
                }
            }

            //math.random qui décidera qu'elle habitats on retourne. Elle envoie un chiffre au hasard entre 1 et le nombre d'habitats.
            var nombreHasard;
            nombreHasard = Math.floor((Math.random() * nombreHabitats) + 1);

            //Tout les if pour savoir c'est qu'elle habitats, Toujours plus petit que l'habitats et plus grand que l'ancien habitats.
            if (nombreHasard <= nombreFosse) {
                habitatsRetourner = 'fosse';
            }
            else if (nombreHasard <= nombreFosse + nombreSable && nombreHasard > nombreFosse) {
                habitatsRetourner = 'sable';
            }
            else if (nombreHasard <= nombreFosse + nombreSable + nombreGravier && nombreHasard > nombreFosse + nombreSable) {
                habitatsRetourner = 'gravier';
            }
            else if (nombreHasard <= nombreFosse + nombreSable + nombreGravier + nombreRapides && nombreHasard > nombreFosse + nombreSable + nombreGravier) {
                habitatsRetourner = 'rapides';
            }
            else if (nombreHasard <= nombreFosse + nombreSable + nombreGravier + nombreRapides + nombreGalets && nombreHasard > nombreFosse + nombreSable + nombreGravier + nombreRapides) {
                habitatsRetourner = 'galets';
            }

            return habitatsRetourner;
        }

        //Fonction qui appelle le timer
        function appelerTimerPigerCarte(i) {
            setTimeout(function () {
                var carte = pigerCarte(paquetCarte);
                animationPige(carte, i);
                mains[numeroJoueurActif][i] = carte;
            }, 500);
        }

        //Fonction qui permet de chercher une carte en particulier.
        function chercherCarteParticuliere(nomCarte) {
            var carteRetours

            //Boucle dans tout le paquet de cartes à la recherche de la bonne carte.
            for (var i = 0; i < paquetCarte.length + 1; i++) {
                if (paquetCarte[i].nom === nomCarte) {
                    carteRetour = paquetCarte[i];

                    //Code qui change la valeur i avec la première valeur pour pouvoir faire un array.shift().
                    var valeurEnregistrer = paquetCarte[0];
                    paquetCarte[0] = paquetCarte[i];
                    paquetCarte[i] = valeurEnregistrer;

                    //Retire la carte sur le dessus
                    paquetCarte.shift();

                    //Re-mélange le paquet de carte puisqu'on viens d'enlever une carte particuliere en plein millieu.
                    melangerPaquetCarte(paquetCarte);
                    return carteRetour;
                }
            }
        }

        //Fonction qui ajoute la partie de droite.
        function creerPartieDroite() {
            var divNomJoueurs = document.createElement('div');
            divNomJoueurs.id = 'divNomJoueurs';
            divNomJoueurs.className = 'divNomJoueurs';
            //TODO: Nous devrions grossir la 'box' ou qu'il y a les noms si il y a quatre équipe ou 3 et faire en sorte que
            //      les équipes soit toujours écrite l'une en dessous de l'autre.
            if (nombreJoueur === 4) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + nomJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + nomJoueur[2] + '</li><li class=listeEquipe>Équipe D : ' + nomJoueur[3] + '</li></ul>';
            }
            else if (nombreJoueur === 3) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + nomJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + nomJoueur[2] + '</li></ul>';
            }
            else if (nombreJoueur === 2) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + nomJoueur[1] + '</li></ul>';
            }
            else if (nombreJoueur === 1) {
                divNomJoueurs.innerHTML = '<p class=titreEquipe><strong>Nom des équipes</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + nomJoueur[0] + '</li></ul>';
            }
            document.getElementById('divDroite').appendChild(divNomJoueurs);

            var divTextePointsRessource = document.createElement('div');
            divTextePointsRessource.id = 'divTextePointsRessource';
            divTextePointsRessource.className = 'divTextePointsRessource';
            divTextePointsRessource.innerHTML = '<p class=titreRessource><strong>Points de ressources disponibles : 6 </strong>';
            document.getElementById('divDroite').appendChild(divTextePointsRessource);

            var divTextePointsJoueurs = document.createElement('div');
            divTextePointsJoueurs.id = 'divTextePointsJoueurs';
            divTextePointsJoueurs.className = 'divTextePointsJoueurs';
            if (nombreJoueur === 4) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A :' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + pointsJoueur[2] + '</li><li class=listeEquipe>Équipe D : ' + pointsJoueur[3] + '</li></ul>';
            }
            else if (nombreJoueur === 3) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li><li class=listeEquipe>Équipe C : ' + pointsJoueur[2] + '</li></ul>';
            }
            else if (nombreJoueur === 2) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li><li class=listeEquipe>Équipe B : ' + pointsJoueur[1] + '</li></ul>';
            }
            else if (nombreJoueur === 1) {
                divTextePointsJoueurs.innerHTML = '<p class=titreEquipe><strong>Points</strong></p><ul class=listeUlEquipe><li class=listeEquipe>Équipe A : ' + pointsJoueur[0] + '</li></ul>';
            }
            document.getElementById('divDroite').appendChild(divTextePointsJoueurs);

            var buttonPasserTour = document.createElement('button');
            buttonPasserTour.id = 'buttonPasserTour';
            buttonPasserTour.className = 'buttonJeu';
            buttonPasserTour.setAttribute('onclick', 'passerTour()');
            buttonPasserTour.textContent = 'Passer son tour';
            document.getElementById('divDroite').appendChild(buttonPasserTour);

            var buttonProposerEchange = document.createElement('button');
            buttonProposerEchange.id = 'buttonProposerEchange';
            buttonProposerEchange.className = 'buttonJeu';
            buttonProposerEchange.setAttribute('onclick', 'onClickButtonEchange()');
            buttonProposerEchange.textContent = 'Proposer un échange';
            document.getElementById('divDroite').appendChild(buttonProposerEchange);

            var buttonOption = document.createElement('button');
            buttonOption.id = 'buttonOption';
            buttonOption.className = 'buttonJeu';
            buttonOption.textContent = 'Options';
            buttonOption.setAttribute('onclick', 'ouvrirOptionsEnJeu()');
            document.getElementById('divDroite').appendChild(buttonOption);
        }

        //Fonction qui retournera true si il y a des cartes de notre coté et du cotés des autres joueurs pour échanger.
        function carteAEchanger() {
            if (numeroJoueurActif === 0) {
                if (nombreJoueur >= 2) {
                    var joueur1 = 1;
                }
                if (nombreJoueur >= 3) {
                    var joueur2 = 2;
                }
                if (nombreJoueur === 4) {
                    var joueur3 = 3;
                }
            }
            else if (numeroJoueurActif === 1) {
                var joueur1 = 0;

                if (nombreJoueur >= 3) {
                    var joueur2 = 2;
                }
                if (nombreJoueur === 4) {
                    var joueur3 = 3;
                }
            }
            else if (numeroJoueurActif === 2) {
                var joueur1 = 1;
                var joueur2 = 0;

                if (nombreJoueur === 4) {
                    var joueur3 = 3;
                }
            }
            else if (numeroJoueurActif === 3) {
                var joueur1 = 1;
                var joueur2 = 2;
                var joueur3 = 0;
            }

            var carteJoueurActif = false;
            var carteJoueurEnnemi = false;

            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueurActif][i] != null) {
                    carteJoueurActif = true;
                }
                if (nombreJoueur >= 2) {
                    if (carteBas[joueur1][i] != null) {
                        carteJoueurEnnemi = true;
                    }
                }
                if (nombreJoueur >= 3) {
                    if (carteBas[joueur2][i] != null) {
                        carteJoueurEnnemi = true;
                    }
                }
                if (nombreJoueur === 4) {
                    if (carteBas[joueur3][i] != null) {
                        carteJoueurEnnemi = true;
                    }
                }
            }

            if (carteJoueurActif && carteJoueurEnnemi) {
                return true;
            }
            else {
                return false;
            }
        }

        //Fonction qui sera appeler lors du clique sur le bouton d'échange.
        function onClickButtonEchange() {
            if (carteAEchanger()) {
                if (!echange) {
                    popUpConfirmation('Veuillez choisir la carte de votre jeu à échanger.');
                    echange = true;
                    brillanceCarteEchange();
                    document.getElementById('buttonProposerEchange').textContent = "Annuler l'échange";
                }
                else {
                    echange = false;
                    brillanceCarteEchange();
                    document.getElementById('buttonProposerEchange').textContent = "Proposer un échange";
                    annulerEchange();
                }
            }
            else {
                popUpErreur('Il n\'y a pas de cartes à échanger.');
            }
        }

        //Fonction qui annule l'échange en remettant les variables à null.
        function annulerEchange() {
            positionCarteEchanger1 = null;
            positionCarteEchanger2 = null;
            carteEchanger1 = null;
            carteEchanger2 = null;
            numeroJoueurEchange2 = null
            renduCarte2 = false;
            emplacementCarte1 = null;
            emplacementCarte2 = null;
            enleverBrillance();
        }

        //Fonction qui sera appeler lors du clique sur une image. Si on est en mode échange cela va faire quelque choses.
        function onClickImage(event, ui) {
            if (echange) {
                var identification = event.substr(event.length - 2);
                var lettreJoueur = identification.substr(0, 1);
                var emplacement = identification.substr(identification.length - 1);
                var lettreEchange1;

                if (!renduCarte2) {
                    popUpConfirmation('Vous devez choisir la carte avec laquelle vous voulez faire l\'échanger.');
                    emplacementCarte1 = event;
                    if (nombreJoueur === 4) {
                        if (numeroJoueurActif === 0 && lettreJoueur === 'A') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'A';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else if (numeroJoueurActif === 1 && lettreJoueur === 'D') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'D';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else if (numeroJoueurActif === 2 && lettreJoueur === 'B') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'B';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else if (numeroJoueurActif === 3 && lettreJoueur === 'C') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'C';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else {
                            popUpAvertissement("Vous devez d'abord sélectionner la carte que vous voulez échanger.");
                        }
                    }
                    else if (nombreJoueur === 3) {
                        if (numeroJoueurActif === 0 && lettreJoueur === 'A') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'A';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else if (numeroJoueurActif === 1 && lettreJoueur === 'B') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'B';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else if (numeroJoueurActif === 2 && lettreJoueur === 'C') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'C';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                    }
                    else if (nombreJoueur === 2) {
                        if (numeroJoueurActif === 0 && lettreJoueur === 'A') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'A';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                        else if (numeroJoueurActif === 1 && lettreJoueur === 'B') {
                            positionCarteEchanger1 = emplacement;
                            carteEchanger1 = carteBas[numeroJoueurActif][emplacement];
                            lettreEchange1 = 'B';
                            echange = false;
                            brillanceCarteEchange();
                            echange = true;
                            renduCarte2 = true;
                            brillanceCarteEchange();
                        }
                    }
                }
                else if (renduCarte2) {
                    if (lettreJoueur != lettreEchange1) {
                        if (nombreJoueur === 4) {
                            if (lettreJoueur === 'A') {
                                numeroJoueurEchange2 = 0;
                            }
                            else if (lettreJoueur === 'B') {
                                numeroJoueurEchange2 = 2;
                            }
                            else if (lettreJoueur === 'C') {
                                numeroJoueurEchange2 = 3;
                            }
                            else if (lettreJoueur === 'D') {
                                numeroJoueurEchange2 = 1;
                            }
                        }
                        else if (nombreJoueur === 3) {
                            if (lettreJoueur === 'A') {
                                numeroJoueurEchange2 = 0;
                            }
                            else if (lettreJoueur === 'B') {
                                numeroJoueurEchange2 = 1;
                            }
                            else if (lettreJoueur === 'C') {
                                numeroJoueurEchange2 = 2;
                            }
                        }
                        else if (nombreJoueur === 2) {
                            if (lettreJoueur === 'A') {
                                numeroJoueurEchange2 = 0;
                            }
                            else if (lettreJoueur === 'B') {
                                numeroJoueurEchange2 = 1;
                            }
                        }

                        emplacementCarte2 = event;

                        positionCarteEchanger2 = emplacement;
                        carteEchanger2 = carteBas[numeroJoueurEchange2][emplacement];
                        echangerCarte(emplacementCarte1, emplacementCarte2);
                        onClickButtonEchange();
                        brillanceCarteEchange();
                        annulerEchange();
                    }
                    else {
                        popUpAvertissement("Vous devez désormais sélectionner la carte avec laquelle vous voulez échanger la votre.");
                    }
                }
            }
        }

        //Fonction qui fais l'échange des cartes.
        function echangerCarte(positionCarte1, positionCarte2) {
            document.getElementById(positionCarte1).removeChild(document.getElementById(positionCarte1).lastChild);
            document.getElementById(positionCarte2).removeChild(document.getElementById(positionCarte2).lastChild);

            var image = document.createElement('img');
            image.className = 'imageCarteJeu';
            image.src = 'ressources/' + carteEchanger2.nomImage;
            $(image).addClass('ui-draggable-disabled');

            if (document.getElementById(positionCarte1).children.length === 0) {
                $('#' + positionCarte1).append(image);
                carteBas[numeroJoueurActif][positionCarteEchanger1] = carteEchanger2;

            }
            else {
                carteBas[numeroJoueurActif][trouverPositionLibre(numeroJoueurActif)] = carteEchanger2;
                $(trouverPositionLibre(numeroJoueurActif)).append(image);
            }

            var image2 = document.createElement('img');
            image2.className = 'imageCarteJeu';
            image2.src = 'ressources/' + carteEchanger1.nomImage;
            $(image2).addClass('ui-draggable-disabled');

            if (document.getElementById(positionCarte2).children.length === 0) {
                $('#' + positionCarte2).append(image2);
                carteBas[numeroJoueurEchange2][positionCarteEchanger2] = carteEchanger1;

            }
            else {
                carteBas[numeroJoueurEchange2][trouverPositionLibre(numeroJoueurEchange2)] = carteEchanger1;
                $(trouverPositionLibre(numeroJoueurEchange2)).append(image2);
            }

            $('#buttonProposerEchange').prop('disabled', true);
            $(function () {
                $('.imageCarteJeu').on({
                    click: function (event, ui) {
                        onClickImage($(this).parent().attr("id"), ui);
                    }
                })
            });
        }

        //Fonction qui retourne le premier emplacement libre ou on peut mettre une carte.
        function trouverPositionLibre(numero) {
            var lettreEmplacement = lettreJoueur(numero);

            for (var i = 0; i < 6; i++) {
                if ($('#emplacementBasJoueur' + lettreEmplacement + i).length === 1) {
                    return ('#emplacementBasJoueur' + lettreEmplacement + i);
                }
            }
            for (var i = 6; i < 10; i++) {
                if ($('#emplacementHautJoueur' + lettreEmplacement + i).children.length === 1) {
                    return ('#emplacementHautJoueur' + lettreEmplacement + i);
                }
            }
        }

        //Fonction qui ajoute une div avec le plateau en fond d'écran.
        function creerFond() {
            //Partie de gauche.
            var divMain = document.createElement('div');
            divMain.id = 'divMain';
            divMain.className = 'divMain';
            $('body').append(divMain);

            //Partie du millieu.
            var plateau = document.createElement('div');
            plateau.id = 'plateau';
            plateau.className = 'plateau';
            $('body').append(plateau);

            //Partie de droite.
            var divDroite = document.createElement('div');
            divDroite.id = 'divDroite';
            divDroite.className = 'divDroite';
            $('body').append(divDroite);

            //Paquet de charge
            var paquetCharge = document.createElement('div');
            paquetCharge.id = 'paquetCharge';
            paquetCharge.className = 'paquetCharge';
            var imagePaquet = document.createElement('img');
            imagePaquet.className = 'imageCharge'
            imagePaquet.setAttribute('src', 'ressources/grosPaquet.png');
            $(plateau).append(paquetCharge);
            $(paquetCharge).append(imagePaquet);

            //Paquet Défausse
            var paquetDefausse = document.createElement('div');
            paquetDefausse.id = 'paquetDefausse';
            paquetDefausse.className = 'paquetDefausse';
            $(plateau).append(paquetDefausse);
        }

        //Fonction qui crée les divers emplacement sur le tableau.
        function creerEmplacementsPlateau() {
            $(function () {
                for (i = 0; i < 6; i++) {
                    var emplacementBasJoueurA = document.createElement('div');
                    emplacementBasJoueurA.id = 'emplacementBasJoueurA' + i;
                    emplacementBasJoueurA.className = 'emplacementJoueurA';
                    emplacementBasJoueurA.style.left = 116 + 66 * (i + 1) + 'px';
                    emplacementBasJoueurA.style.bottom = '30px';
                    $('#plateau').append(emplacementBasJoueurA);

                    var emplacementBasJoueurB = document.createElement('div');
                    emplacementBasJoueurB.id = 'emplacementBasJoueurB' + i;
                    emplacementBasJoueurB.className = 'emplacementJoueurB';
                    emplacementBasJoueurB.style.left = 116 + 66 * (i + 1) + 'px';
                    emplacementBasJoueurB.style.top = '30px';
                    $('#plateau').append(emplacementBasJoueurB);

                    if (nombreJoueur >= 3) {
                        var emplacementBasJoueurC = document.createElement('div');
                        emplacementBasJoueurC.id = 'emplacementBasJoueurC' + i;
                        emplacementBasJoueurC.className = 'emplacementJoueurC';
                        emplacementBasJoueurC.style.top = 100 + 66 * (i + 1) + 'px';
                        emplacementBasJoueurC.style.left = '46px';
                        $('#plateau').append(emplacementBasJoueurC);
                    }
                    if (nombreJoueur === 4) {
                        var emplacementBasJoueurD = document.createElement('div');
                        emplacementBasJoueurD.id = 'emplacementBasJoueurD' + i;
                        emplacementBasJoueurD.className = 'emplacementJoueurD';
                        emplacementBasJoueurD.style.top = 100 + 66 * (i + 1) + 'px';
                        emplacementBasJoueurD.style.right = '46px';
                        $('#plateau').append(emplacementBasJoueurD);
                    }
                }
                for (i = 6; i < 10; i++) {
                    var emplacementHautJoueurA = document.createElement('div');
                    emplacementHautJoueurA.id = 'emplacementHautJoueurA' + i;
                    emplacementHautJoueurA.className = 'emplacementJoueurA';
                    emplacementHautJoueurA.style.left = 182 + 66 * (i - 5) + 'px';
                    emplacementHautJoueurA.style.bottom = '131px';
                    $('#plateau').append(emplacementHautJoueurA);

                    var emplacementHautJoueurB = document.createElement('div');
                    emplacementHautJoueurB.id = 'emplacementHautJoueurB' + i;
                    emplacementHautJoueurB.className = 'emplacementJoueurB';
                    emplacementHautJoueurB.style.left = 182 + 66 * (i - 5) + 'px';
                    emplacementHautJoueurB.style.top = '130px';
                    $('#plateau').append(emplacementHautJoueurB);

                    if (nombreJoueur >= 3) {
                        var emplacementHautJoueurC = document.createElement('div');
                        emplacementHautJoueurC.id = 'emplacementHautJoueurC' + i;
                        emplacementHautJoueurC.className = 'emplacementJoueurC';
                        emplacementHautJoueurC.style.top = 166 + 66 * (i - 5) + 'px';
                        emplacementHautJoueurC.style.left = '146px'
                        $('#plateau').append(emplacementHautJoueurC);
                    }

                    if (nombreJoueur === 4) {
                        var emplacementHautJoueurD = document.createElement('div');
                        emplacementHautJoueurD.id = 'emplacementHautJoueurD' + i;
                        emplacementHautJoueurD.className = 'emplacementJoueurD';
                        emplacementHautJoueurD.style.top = 166 + 66 * (i - 5) + 'px';
                        emplacementHautJoueurD.style.right = '146px';
                        $('#plateau').append(emplacementHautJoueurD);
                    }
                }
                $(function () {
                    $('.emplacementJoueurA, .emplacementJoueurB, .emplacementJoueurC, .emplacementJoueurD').droppable({
                        tolerance: 'intersect',
                        drop: function (event, ui) {
                            if (bonneZoneDrop(event, ui)) {//Si l'endroits que nous voulons droper est à la bonne place.
                                if (accepterDrop(event) === true) {
                                    if ($(this).children().length < 1) {//Si l'endroit ou on drope est vide.
                                        if (verifierCartePresente() === '') {//Si la carte n'est pas déjà présente.
                                            onDrop(event, ui, this);
                                        }
                                        else {
                                            onDrop(event, ui, verifierCartePresente());
                                        }
                                    }//sinon si l'endroit contient une carte ET qu'elle est identique.
                                    else if ($(this).children().length >= 1) {                                      
                                        var id;
                                        id = event.target.id.substr(event.target.id.length - 1);
                                        
                                        if (carteDrag.type != 'perturbation') {
                                            if (carteDrag.nom === carteBas[numeroJoueurActif][id].nom) {
                                                onDrop(event, ui, this);
                                            }
                                            else {//Sinon, le drop est pas accepter.
                                                ui.draggable.draggable({ revert: true });
                                                revertCarte(ui.draggable);
                                                popUpErreur('Vous ne pouvez pas empiller des cartes différentes.');
                                            }
                                        }
                                        else {
                                            onDrop(event, ui, this);
                                        }
                                    }
                                }
                                else {//Respecte pas les conditions, donc drop pas accepter.
                                    ui.draggable.draggable({ revert: true });
                                    revertCarte(ui.draggable);
                                }
                            }
                            else {
                                ui.draggable.draggable({ revert: true });
                                revertCarte(ui.draggable);

                                if (carteDrag.type === 'habitats' || carteDrag.type === 'macroInvertebre' || carteDrag.type === 'bandeRiveraine' || carteDrag.type === 'salmonide') {
                                    popUpErreur('Cette carte est jouable que dans votre zone.');
                                }
                                else if (carteDrag.type === 'perturbation') {
                                    popUpErreur('Cette carte est jouable que dans la zone d\'un de vos adversaire.');
                                }
                            }
                        }
                    });
                });
            });
        }

        //Fonction qui vérifie si une carte pareil est déjà présente sur le jeu. Si elle est la, retourne la position.
        function verifierCartePresente() {
            var lettreActif = lettreJoueur(numeroJoueurActif);
            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueurActif][i] != null) {
                    if (carteBas[numeroJoueurActif][i].nomImage === carteDrag.nomImage) {
                        if (i < 6) {
                            return document.getElementById('emplacementBasJoueur' + lettreActif + i);
                        }
                        else {
                            return document.getElementById('emplacementHautJoueur' + lettreActif + i);
                        }
                    }
                }
            }

            return '';
        }

        //Fonction qui validera que c'est la bonne zone pour drope notre carte.
        function bonneZoneDrop(event, ui) {
            var identification = event.target.id.substr(event.target.id.length - 2);
            var lettreEmplacement = identification.substr(0, 1);

            var lettre = lettreJoueur(numeroJoueurActif);

            //Si c'est un habitats, un macro-invertebrer ou une bande riveraine, la carte se joue seulement sur notre territoire.
            if (carteDrag.type === 'habitats' || carteDrag.type === 'macroInvertebre' || carteDrag.type === 'bandeRiveraine' || carteDrag.type === 'salmonide') {
                if (lettreEmplacement === lettre) {
                    return true;
                }
                else {
                    return false;
                }
            }
            if (carteDrag.type === 'perturbation') {
                if (lettreEmplacement === lettre) {
                    return false;
                }
                else {
                    return true;
                }
            }
        }

        //Fonction qui renvoie la lettre du joueur actif.
        function lettreJoueur(numero) {
            if (nombreJoueur === 2) {
                if (numero === 0) {
                    return 'A';
                }
                else if (numero === 1) {
                    return 'B';
                }
            }
            else if (nombreJoueur === 3) {
                if (numero === 0) {
                    return 'A';
                }
                else if (numero === 1) {
                    return 'B';
                }
                else if (numero === 2) {
                    return 'C';
                }
            }
            else if (nombreJoueur === 4) {
                if (numero === 1) {
                    return 'D';
                }
                else if (numero === 0) {
                    return 'A'
                }
                else if (numero === 2) {
                    return 'B';
                }
                else {
                    return 'C';
                }
            }
        }

        //Fonction qui crée l'espace de la main.
        function creerMain() {
            for (i = 0; i < 6; i++) {
                var li = document.createElement('li');
                li.className = 'liMain';
                li.id = 'liMain' + i;
                document.getElementById('divMain').appendChild(li);

                var divCarte = document.createElement('div');
                divCarte.id = 'divCarte' + i;
                divCarte.className = 'divCarte';
                li.appendChild(divCarte);
            }
        }

        //Fonction qui valide si le drop est accepter.
        function accepterDrop(event) {
            if (carteDrag.coutResources <= pointsRessourcesRestant[numeroJoueurActif]) {
                // Si c'est un macroInvertebre ou un salmonive, il y a des conditions.
                if (carteDrag.type === 'macroInvertebre' || carteDrag.type === 'salmonide') {
                    if (verifierCondition(carteDrag)) {
                        return true;
                    }
                    else {
                        popUpAvertissement('Vous ne respectez pas les conditions nécéssaires.');
                        return false;
                    }
                }
                else if (carteDrag.type === 'habitats' || carteDrag.type === 'intervention' || carteDrag.type === 'bandeRiveraine') {
                    return true;
                }
                else if (carteDrag.type === 'perturbation') {
                    var message = verifierConditionPerturbation(event);

                    if (message === 'ok') {
                        return true;
                    }
                    else {
                        popUpAvertissement(message);
                        return false;
                    }
                }
            }
            else {
                popUpAvertissement('Vous manquez de points ressources pour jouer la carte.');
                return false;
            }
        }

        //Fonction qui va vérifier si la carte perturbation respecte son emplacement.
        function verifierConditionPerturbation(event, ui) {
            var position = event.target.id.substr(event.target.id.length - 2);
            var numeroPositionEmplacement = position.substr(position.length - 1);
            var lettrePositionJoueur = position.substr(0, 1);
            var numeroPositionJoueur;          

            if (nombreJoueur === 4) {
                if (lettrePositionJoueur === 'A') {
                    numeroPositionJoueur = 0;
                }
                else if (lettrePositionJoueur === 'D') {
                    numeroPositionJoueur = 1;
                }
                else if (lettrePositionJoueur === 'B') {
                    numeroPositionJoueur = 2;
                }
                else if (lettrePositionJoueur === 'C') {
                    numeroPositionJoueur = 3;
                }
            }
            else if (nombreJoueur === 3) {
                if (lettrePositionJoueur === 'A') {
                    numeroPositionJoueur = 0;
                }
                else if (lettrePositionJoueur === 'B') {
                    numeroPositionJoueur = 1;
                }
                else if (lettrePositionJoueur === 'C') {
                    numeroPositionJoueur = 2;
                }
            }
            else if (nombreJoueur === 2) {
                if (lettrePositionJoueur === 'A') {
                    numeroPositionJoueur = 0;
                }
                else if (lettrePositionJoueur === 'C') {
                    numeroPositionJoueur = 1;
                }
            }

            if (carteDrag.nom === 'dechets') {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === 'habitats') {
                        return 'ok';
                    }
                    else {
                        return 'La carte "Déchets" doit être jouer sur un habitat.';
                    }
                }
                else {
                    return 'La carte "Déchets" doit être jouer sur un habitat.';
                }
            }
            else if (carteDrag.nom === 'erosion') {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === 'bandeRiveraine') {
                        return 'ok';
                    }
                    else {
                        return 'La carte "Érosion" doit être jouer sur une bande riveraine.';
                    }
                }
                else {
                    return 'La carte "Érosion" doit être jouer sur une bande riveraine.';
                }
            }
            else if (carteDrag.nom === 'passageToutTerrain') {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === 'habitats') {
                        return 'ok';
                    }
                    else {
                        return 'La carte "Passage de tout-terrain" doit être jouer sur un habitat.';
                    }
                }
                else {
                    return 'La carte "Passage de tout-terrain" doit être jouer sur un habitat.';
                }
            }
            else if (carteDrag.nom === 'artificialisation') {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === 'bandeRiveraine') {
                        return 'ok';
                    }
                    else {
                        return 'La carte "Artificialisation" doit être jouer sur une bande riveraine.';
                    }
                }
                else {
                    return 'La carte "Artificialisation" doit être jouer sur une bande riveraine.';
                }
            }
            else if (carteDrag.nom === 'pollutionOrganique') {
                if (carteBas[numeroPositionJoueur][numeroPositionEmplacement] != null) {
                    if (carteBas[numeroPositionJoueur][numeroPositionEmplacement].type === 'habitats') {
                        return 'ok';
                    }
                    else {
                        return 'La carte "Pollution organique" doit être jouer sur un habitats et il vous sera ensuite demander les 2 autres habitats que vous vouler rendre inutilisable.';
                    }
                }
                else {
                    return 'La carte "Pollution organique" doit être jouer sur un habitats et il vous sera ensuite demander les 2 autres habitats que vous vouler rendre inutilisable.';
                }
            }
            else if (carteDrag.nom === 'deversement') {
                return 'ok';
                //TODO: la carte déversement se joue n'importe ou, ce serais donc le fun que le plateau entier se highlithts.
            }
            else {
                return 'Vous ne pouvez pas mettre une carte perturbation sur un emplacement vide.';
            }
        }

        //Fonction qui se produit lorsque l'on drop.
        function onDrop(event, ui, drop) {
            $(function () {
                $(ui.draggable).click(function () { onClickImage($(this).parent().attr("id"), ui) });
                ui.draggable.appendTo(drop);
                ui.draggable.addClass('imageCarteJeu');
                ui.draggable.removeClass('imageCarteMains');
                ui.draggable.css('width', '58px');
                ui.draggable.css('height', '90px');
                ui.draggable.css('top', '0px');
                ui.draggable.css('left', '0px');                              
                ui.draggable.draggable('disable');
                ui.draggable.position({ of: $(drop), my: 'center', at: 'center' });
                if ($(drop).children().length > 1) {
                    ui.draggable.css('margin-top', ($(drop).children().length * 10) - 10 + 'px');
                    exemplaireCarteBas[numeroJoueurActif][event.target.id.substr(event.target.id.length - 1)] = $(drop).children().length;
                }
                else {
                    exemplaireCarteBas[numeroJoueurActif][event.target.id.substr(event.target.id.length - 1)] = 1;
                }
                //Partie qui change les données de la mains vers la partie du bas.
                pointsRessourcesRestant[numeroJoueurActif] -= carteDrag.coutResources;
                pointsRessourcesUtiliser[numeroJoueurActif] += carteDrag.coutResources;
                updatePointsRessources();
                var id = drop.id.substr(drop.id.length - 1);
                carteBas[numeroJoueurActif][id] = carteDrag;
                supprimerCartePrecise(carteDragNumero);
            });
        }

        //Fonction qui va supprimer une carte de la main, appeler lors du drop dans la zone du bas.
        function supprimerCartePrecise(positionCarte) {
            mains[numeroJoueurActif][positionCarte] = null;
        }

        //Définition de la classe.
        function Carte(type, nom, nomImage, coutResources, params) {
            if (type === 'habitats') {
                this.nom = nom;
                this.type = type;
                this.habitats = params.habitats;
                this.coutResources = coutResources;
                this.nomImage = nomImage;
            }
            else if (type === 'salmonide') {
                this.nom = nom;
                this.type = type;
                this.coutResources = coutResources;
                this.condition = params.condition;
                this.nomImage = nomImage;
            }
            else if (type === 'bandeRiveraine') {
                this.nom = nom;
                this.type = type;
                this.coutResources = coutResources;
                this.nomImage = nomImage;
            }
            else if (type === 'speciale') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
            else if (type === 'speciale') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
            else if (type === 'action') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
            else if (type === 'perturbation') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
                this.tempsActif = params.tempsActif;
            }
            else if (type === 'reglementation') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
            else if (type === 'macroInvertebre') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
                this.tolerance = params.tolerance;
                this.taille = params.taille;
                this.predateur = params.predateur;
                this.typeMacro = params.typeMacro;
                this.condition = params.condition;
            }
            else if (type === 'bandeRiveraine') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
            else if (type === 'intervention') {
                this.nom = nom;
                this.type = type;
                this.nomImage = nomImage;
                this.coutResources = coutResources;
            }
        }

        //function pour piger une carte.
        function pigerCarte(paquetCarte) {
            var carte = paquetCarte.pop();
            if (paquetCarte.length <= 70) {
                $('.imageCharge').attr('src', 'ressources/moyenPaquet.png');
            }
            if (paquetCarte.length <= 20) {
                $('.imageCharge').attr('src', 'ressources/petitPaquet.png')
            }

            return carte;
        }

        //Fonction qui anime les cartes du paquet jusqu'à la main.
        function animationPige(carte, position) {
            var carteMain = 'divCarte' + position;

            var divCarte = document.createElement('div');
            divCarte.id = 'carte' + position;
            divCarte.className = 'divAnimee';
            $('body').append(divCarte);
            var divDerriere = document.createElement('div');
            divDerriere.className = 'back';
            divDerriere.innerHTML = '<img class="imageCarteJeu" src="ressources/' + carte.nomImage + '">';
            $(divCarte).append(divDerriere);

            var x = $('#' + carteMain).offset().left;
            var y = $('#' + carteMain).offset().top;

            $('#carte' + position).animate({
                height: 180,
                width: 118,
                left: x,
                top: y,
                borderSpacing: 0,
            }, {
                step: function (now) {
                    $(this).css('-webkit-transform', 'rotate(' + now + 'deg)');
                    $(this).css('-moz-transform', 'rotate(' + now + 'deg)');
                    $(this).css('transform', 'rotate(' + now + 'deg)');
                }
            }, { duration: 2500 });
            setTimeout(function () {
                $('#carte' + position).remove();
                var image = document.createElement('img');
                var cloneImage = '<img class="imageTooltip" src="ressources/' + carte.nomImage + '">';
                image.className = 'imageCarteMains';
                image.src = 'ressources/' + carte.nomImage;
                $('#' + carteMain).append(image);
                $(image).tooltip({
                    items: 'img',
                    content: cloneImage,
                    position: { my: "right" },
                    show: { delay: 1000 }
                });
            }, 1500);
        }

        //Function qui melange le paquet de carte.
        function melangerPaquetCarte(paquetCarte) {
            var currentIndex = paquetCarte.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = paquetCarte[currentIndex];
                paquetCarte[currentIndex] = paquetCarte[randomIndex];
                paquetCarte[randomIndex] = temporaryValue;
            }
        }

        //function qui crée le paquet de carte.
        function creerPaquetCarte(difficulte) {
            var carte;
            var paquetCarte = new Array();

            //Dépendant du niveau de la partie, il n'y aura pas les mêmes cartes  dans le deck.
            //if (tour == 1) {
            //----------------------------------habitats-----------------------------------

            carte = new Carte('habitats', 'fosse', 'fosse.png', 1, { habitats: 'fosse' });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('habitats', 'sable', 'sable.png', 1, { habitats: 'sable' });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('habitats', 'gravier', 'gravier.png', 2, { habitats: 'gravier' });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('habitats', 'rapides', 'rapides.png', 3, { habitats: 'rapides' });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('habitats', 'galets', 'galets.png', 3, { habitats: 'galets' });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            // ----------------------------MacroInvertebre--------------------------------------------------

            carte = new Carte('macroInvertebre', 'oligochaeta', 'oligochaeta.png', 1, { tolerance: 8, taille: 1, typeMacro: 'amelide', condition: ['?'], predateur: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('macroInvertebre', 'simuliidae', 'simuliidae.png', 1, { tolerance: 6, taille: 2, typeMacro: 'diptere', condition: ['rapides', 'galets'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'chironomidae', 'chironomidae.png', 1, { tolerance: 8, taille: 2, typeMacro: 'diptere', condition: ['?'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'psephenidae', 'psephenidae.png', 2, { tolerance: 3, taille: 4, typeMacro: 'coleoptere', condition: ['rapides', 'galets'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'hydropsychidae', 'hydropsychidae.png', 2, { tolerance: 5, taille: 4, typeMacro: 'trichoptere', condition: ['rapides'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'elmidae', 'elmidae.png', 2, { tolerance: 3, taille: 3, typeMacro: 'coleoptere', condition: ['rapides'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'baetidae', 'baetidae.png', 2, { tolerance: 5, taille: 3, typeMacro: 'ephemeroptere', condition: ['rapides'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'hydroptilidae', 'hydroptilidae.png', 2, { tolerance: 4, taille: 2, typeMacro: 'trichoptere', condition: ['rapides', 'sable', 'galets'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'ephemeridae', 'ephemeridae.png', 2, { tolerance: 3, taille: 5, typeMacro: 'ephemeroptere', condition: ['sable'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'prosobranchia', 'prosobranchia.png', 2, { tolerance: 8, taille: 5, typeMacro: 'mollusque', condition: ['?'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'sphaeridae', 'sphaeridae.png', 2, { tolerance: 5, taille: 3, typeMacro: 'mollusque', condition: ['rapides', 'gravier'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'anisoptera', 'anisoptera.png', 3, { tolerance: 5, taille: 6, typeMacro: 'odonate', condition: ['rapides'], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'glossosomatidae', 'glossosomatidae.png', 3, { tolerance: 0, taille: 5, typeMacro: 'trichoptere', condition: ['rapides', 'gravier', 'galets'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'heptageniidae', 'heptageniidae.png', 3, { tolerance: 2, taille: 4, typeMacro: 'ephemeroptere', condition: ['rapides', 'galets'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'ephemerellidae', 'ephemerellidae.png', 3, { tolerance: 1, taille: 4, typeMacro: 'ephemeroptere', condition: ['rapides', 'gravier'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'brachycentrus', 'brachycentrus.png', 3, { tolerance: 3, taille: 4, typeMacro: 'trichoptere', condition: ['rapides', 'galets'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'rhyacophilidae', 'rhyacophilidae.png', 4, { tolerance: 0, taille: 4, typeMacro: 'trichoptere', condition: ['rapides'], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'tipulidae', 'tipulidae.png', 4, { tolerance: 3, taille: 8, typeMacro: 'diptere', condition: ['fosse'], predateur: 0 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'gyrinidae', 'gyrinidae.png', 4, { tolerance: 4, taille: 5, typeMacro: 'coleoptere', condition: ['fosse'], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'perlidae', 'perlidae.png', 4, { tolerance: 1, taille: 5, typeMacro: 'plecoptere', condition: ['rapides', 'gravier', 'galets'], predateur: 1 });
            paquetCarte.push(carte)
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'corydalidae', 'corydalidae.png', 5, { tolerance: 0, taille: 8, typeMacro: 'megaloptere', condition: ['rapides', 'gravier', 'galets'], predateur: 1 });
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'nepidae', 'nepidae.png', 6, { tolerance: 6, taille: 9, typeMacro: 'hemiptere', condition: ['fosse'], predateur: 1 });
            paquetCarte.push(carte)

            carte = new Carte('macroInvertebre', 'decapoda', 'decapoda.png', 6, { tolerance: 5, taille: 10, typeMacro: 'crustace', condition: ['galets'], predateur: 0 });
            paquetCarte.push(carte);

            carte = new Carte('macroInvertebre', 'pteronarcyidae', 'pteronarcyidae.png', 7, { tolerance: 0, taille: 8, typeMacro: 'plecoptere', condition: ['rapides', 'gravier', 'galets'], predateur: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            //}

            //if (tour == 5) {
            //---------------------------------salmonide---------------------------------

            carte = new Carte('salmonide', 'ombleFontaine', 'ombleFontaine.png', 10, { tolerance: 4, condition: ['fosse', 'rapides', 'gravier', 'galets'], predateur: 2 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            //---------------------------------bandeRiveraine----------------------------

            carte = new Carte('bandeRiveraine', 'herbaceesNaturelles', 'herbaceesNaturelles.png', 1);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('bandeRiveraine', 'arbustes', 'arbustes.png', 2);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('bandeRiveraine', 'arbres', 'arbres.png', 3);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            //}


            //--------------------------perturbation--------------------------------------

            carte = new Carte('perturbation', 'dechets', 'dechets.png', 2, { tempsActif: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('perturbation', 'erosion', 'erosion.png', 3, { tempsActif: 0 });
            paquetCarte.push(carte);

            carte = new Carte('perturbation', 'passageToutTerrain', 'passageToutTerrain.png', 3, { tempsActif: 1 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('perturbation', 'artificialisation', 'artificialisation.png', 3, { tempsActif: 0 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('perturbation', 'pollutionOrganique', 'pollutionOrganique.png', 4, { tempsActif: 2 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            carte = new Carte('perturbation', 'deversement', 'deversement.png', 2, { tempsActif: 1 });
            paquetCarte.push(carte);
            paquetCarte.push(carte);

            if (difficulte === 2)//Moyen
            {

                //---------------------------action--------------------------------------

                carte = new Carte('action', 'corveNettoyage', 'corveNettoyage.png', 1);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('action', 'naturalisation', 'naturalisation.png', 2);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('action', 'amenagement', 'amenagement.png', 3);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                //--------------------------------reglementation----------------------------------------------

                carte = new Carte('reglementation', 'assainissement', 'assainissement.png', 3);
                paquetCarte.push(carte);

                carte = new Carte('reglementation', 'interdiction', 'interdiction.png', 3);
                paquetCarte.push(carte);

                carte = new Carte('reglementation', 'politique', 'politique.png', 3);
                paquetCarte.push(carte);

                //---------------------------------intervention------------------------------

                carte = new Carte('intervention', 'habitatAmenageSable', 'habitatAmenageSable.png', 1, { habitats: 'sable' });
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'habitatAmenageRapides', 'habitatAmenageRapides.png', 1, { habitats: 'rapides' });
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'habitatAmenageFosse', 'habitatAmenageFosse.png', 1, { habitats: 'fosse' });
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'habitatAmenageGalets', 'habitatAmenageGalets.png', 1, { habitats: 'galets' });
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'habitatAmenageGravier', 'habitatAmenageGravier.png', 1, { habitats: 'gravier' });
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'bandeRiveraineHerbace', 'bandeRiveraineHerbace.png', 1);
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'bandeRiveraineArbustes', 'bandeRiveraineArbuste.png', 2);
                paquetCarte.push(carte);

                carte = new Carte('intervention', 'bandeRiveraineArbres', 'bandeRiveraineArbre.png', 3);
                paquetCarte.push(carte);
            }

            if (difficulte >= 3)//Difficile
            {
                //-----------------------------------speciale--------------------------------

                carte = new Carte('speciale', 'prisSurFait', 'prisSurFait.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'pecheur', 'pecheur.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'crueSoudaine', 'crueSoudaine.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'zonage', 'zonage.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'retention', 'retention.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'emergence', 'emergence.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'derivation', 'derivation.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'accumulation', 'accumulation.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);

                carte = new Carte('speciale', 'predation', 'predation.png', 0);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
                paquetCarte.push(carte);
            }
            return paquetCarte;
        }

        //Fonction qui sera appeler lors du clique sur passer le tour.
        function enleverBrillance() {
            for (var i = 0; i < 6; i++) {
                $('#emplacementBasJoueur' + 'A' + i).removeClass('ui-echange-highlight');
                $('#emplacementBasJoueur' + 'B' + i).removeClass('ui-echange-highlight');

                if (nombreJoueur >= 3) {
                    $('#emplacementBasJoueur' + 'C' + i).removeClass('ui-echange-highlight');
                }
                if (nombreJoueur === 4) {
                    $('#emplacementBasJoueur' + 'D' + i).removeClass('ui-echange-highlight');
                }
            }
            for (var i = 6; i < 10; i++) {
                $('#emplacementHautJoueur' + 'A' + i).removeClass('ui-echange-highlight');
                $('#emplacementHautJoueur' + 'B' + i).removeClass('ui-echange-highlight');

                if (nombreJoueur >= 3) {
                    $('#emplacementHautJoueur' + 'C' + i).removeClass('ui-echange-highlight');
                }
                if (nombreJoueur === 4) {
                    $('#emplacementHautJoueur' + 'D' + i).removeClass('ui-echange-highlight');
                }
            }
        }

        //Fonction appelé pour défausser les cartes suplémentaires de la main.
        function defausserCarte() {
            var cartesDefausse = new Array();
            var buttonDefausser = document.createElement('button');
            buttonDefausser.id = 'buttonDefausser';
            buttonDefausser.className = 'buttonJeu';
            buttonDefausser.innerHTML = '<p>Défausser</p>';
            buttonDefausser.onclick = function () {
                onClickButtonDefausse(cartesDefausse);
            };
            $('.divMain').append(buttonDefausser);

            var plateauGrise = document.createElement('div');
            plateauGrise.id = 'plateauGrise';
            plateauGrise.className = 'zoneGrise'
            $('#plateau').append(plateauGrise);
            var divDroiteGrise = document.createElement('div');
            divDroiteGrise.id = 'divDroiteGrise';
            divDroiteGrise.className = 'zoneGrise'
            $('#divDroite').append(divDroiteGrise);

            $('#divDroite').css('pointer-events', 'none');
            $('#plateau').css('pointer-events', 'none');
            $('#divMain').addClass('divMainDefausse');
            $('.imageCarte').draggable('disable');

            mains[numeroJoueurActif].forEach(function (item, index) {
                $('#divCarte' + index).click(function () {
                    $(this).css('-moz-box-shadow', '0 0 15px 10px #fff');
                    $(this).css('-webkit-box-shadow', '0 0 15px 10px #fff');
                    $(this).css('box-shadow', '0px 0px 15px 10px #fff');
                    cartesDefausse[index] = mains[numeroJoueurActif][index];
                });
            });
        }

        //Fonction appelé lors d'un clic sur le bouton Défausser
        function onClickButtonDefausse(cartesDefausse) {
            if (cartesDefausse.length != 0) {
                cartesDefausse.forEach(function (item, index) {
                    paquetDecharge.push(item);
                    mains[numeroJoueurActif][index] = null;
                    var image = $('#divCarte' + index).children();
                    var x = ($('#paquetDefausse').offset().left) - ($(image).offset().left);
                    var y = ($('#paquetDefausse').offset().top) - ($(image).offset().top);
                    $(image).animate({
                        height: 91,
                        width: 59,
                        left: x,
                        top: y,
                        borderSpacing: 45
                    }, {
                        step: function (now, fx) {
                            $(this).css('-webkit-transform', 'rotate(' + now + 'deg)');
                            $(this).css('-moz-transform', 'rotate(' + now + 'deg)');
                            $(this).css('transform', 'rotate(' + now + 'deg)');
                        }
                    }, { duration: 2500 });
                    setTimeout(function () {
                        $(image).remove();
                        if ($('#paquetDefausse').children().length > 0) {
                            $('#paquetDefausse').children().remove();
                        }
                        var imageDecharge = document.createElement('img');
                        imageDecharge.src = 'ressources/' + paquetDecharge[0].nomImage;
                        imageDecharge.className = 'imageCarteJeu';
                        $('#paquetDefausse').append(imageDecharge);
                    }, 500);
                });
                $('#plateauGrise').remove();
                $('#divDroiteGrise').remove();
                $('#divDroite').css('pointer-events', 'auto');
                $('#plateau').css('pointer-events', 'auto');
                $('.imageCarte').draggable('enable');
                $('divMain').removeClass('divMainDefausse');
                mains[numeroJoueurActif].forEach(function (item, index) {
                    $('#divCarte' + index).removeAttr('style');
                });
                $('#buttonDefausser').remove();
            }
            else {
                popUpAvertissement('Selectionner d\'abord la/les carte(s) à défausser');
            }
        }

        //Fonction appelé lors d'un clic sur le boutton Passer son tour.
        function passerTour() {
            var size = mains[numeroJoueurActif].filter(function (value) { return value !== null }).length;
            console.log(mains[numeroJoueurActif]);
            console.log(size);
            if (size > 4) {
                defausserCarte();
            }
            else {
                $('#buttonPasserTour').prop('disabled', true);
                if (nombreJoueur === 4) {
                    facteurRotation += 1;
                    if (facteurRotation > 4) {
                        facteurRotation = 1;
                    }
                }
                else if (nombreJoueur === 2) {
                    facteurRotation += 2;
                    if (facteurRotation > 4) {
                        facteurRotation = 2
                    }
                }
                else if (nombreJoueur === 3) {
                    facteurRotation += 1;
                    if (facteurRotation > 4) {
                        facteurRotation = 1;
                    }
                    if (facteurRotation === 1) {
                        facteurRotation += 1;
                    }
                }

                var angleRotationDebut = (90 * (facteurRotation - 1));
                var angleRotationFin = (90 * facteurRotation);

                var $plateau = $('#plateau');
                $({ deg: angleRotationDebut }).animate({ deg: angleRotationFin }, {
                    duration: 1000,
                    step: function (now) {
                        $plateau.css('-webkit-transform', 'rotate(' + now + 'deg)');
                        $plateau.css('-moz-transform', 'rotate(' + now + 'deg)');
                        $plateau.css('transform', 'rotate(' + now + 'deg)');
                    }
                });

                if (echange) {//SI on passe le tour et qu'on est en échange, on simule un clique sur echange.
                    onClickButtonEchange();
                    annulerEchange();
                    enleverBrillance();
                }

                numeroJoueurActif++;
                if (numeroJoueurActif === nombreJoueur) {
                    numeroJoueurActif = 0;
                }

                setTimeout(function () {
                    $('#buttonPasserTour').prop('disabled', false);
                }, 2000);

                tour++;
                remplirMain();
                updateJeu();
                $('#buttonProposerEchange').prop('disabled', false);
            }
        }

        //Fonction qui va regarder si le joueur à droits à des points de ressources additionel.
        function pointsRessourcesAdditionel() {
            //Variable qui contiendra le nombre de bande riveraine.
            var nombreBandeRiveraine = 0;
            //Variable des bandes riveraine différente si chacune est présente.
            var arbres = 0;
            var arbustes = 0;
            var herbace = 0;

            for (var i = 0; i < 10; i++) {
                if (carteBas[numeroJoueurActif][i] != null) {
                    if (carteBas[numeroJoueurActif][i].type === 'interventionBandeRiveraine' || carteBas[numeroJoueurActif][i].type === 'bandeRiveraine') {
                        nombreBandeRiveraine++;

                        if (carteBas[numeroJoueurActif][i].nom === 'herbaceesNaturelles' || carteBas[numeroJoueurActif][i].nom === 'bandeRiveraineHerbace') {
                            herbace = 1;
                        }
                        else if (carteBas[numeroJoueurActif][i].nom === 'arbustes' || carteBas[numeroJoueurActif][i].nom === 'bandeRiveraineArbustes') {
                            arbuste = 1;
                        }
                        else if (carteBas[numeroJoueurActif][i].nom === 'arbres' || carteBas[numeroJoueurActif][i].nom === 'bandeRiveraineArbres') {
                            arbres = 1;
                        }
                    }
                }
            }

            if (nombreBandeRiveraine > 3) {
                nombreBandeRiveraine = 3;
            }
            if (arbres === 1 && arbustes === 1 && herbace === 1) {
                nombreBandeRiveraine = 5;
            }

            return nombreBandeRiveraine;
        }

        //Fonction qui remet les dimensions de la carte à son état original.
        function revertCarte(carte) {
            $(carte).animate({
                height: 180,
                width: 118
            }, { duration: 200, queue: false });
        }

        //Fonction pour appeler le pop-up d'erreuré
        function popUpErreur(texte) {
            $('#divTexteErreur').text(texte);
            $('#divErreur').dialog({
                classes: {
                    'ui-dialog': 'no-close ui-state-error ui-corner-all',
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 600,
                hide: 'fade',
                show: 'fade',
                open: function () {
                    var foo = $(this);
                    setTimeout(function () {
                        foo.dialog('close');
                    }, 2000);
                }
            });
        }

        //Fonction pour appeler le pop-up d'avertissement.
        function popUpAvertissement(texte) {
            $('#divTexteErreur').text(texte);
            $('#divErreur').dialog({
                classes: {
                    'ui-dialog': 'no-close ui-state-highlight ui-corner-all',
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 600,
                hide: 'fade',
                show: 'fade',
                open: function () {
                    var foo = $(this);
                    setTimeout(function () {
                        foo.dialog('close');
                    }, 2500);
                }
            });
        }

        //Fonction pour appeler le pop-up de confirmation.
        function popUpConfirmation(texte) {
            $('#divTexteErreur').text(texte);
            $('#divErreur').dialog({
                classes: {
                    'ui-dialog': 'no-close popUpConfirmation ui-state-highlight ui-corner-all',
                },
                draggable: false,
                resizable: false,
                height: 80,
                width: 600,
                hide: 'fade',
                show: 'fade',
                open: function () {
                    var foo = $(this);
                    setTimeout(function () {
                        foo.dialog('close');
                    }, 2000);
                }
            });
        }

        //Fonction qui "update" le jeu.
        function updateJeu() {
            //Afficher les cartes selon le tableau main[]
            for (i = 0; i < 6; i++) {
                carteMain = document.getElementById('divCarte' + i)
                if (carteMain.children.length != 0) {
                    carteMain.removeChild(carteMain.firstChild);
                }

                if (mains[numeroJoueurActif][i] != null) {
                    var image = document.createElement('img');
                    var cloneImage = '<img class="imageTooltip" src="ressources/' + mains[numeroJoueurActif][i].nomImage + '">';
                    image.className = 'imageCarteMains';
                    image.src = 'ressources/' + mains[numeroJoueurActif][i].nomImage;
                    carteMain.appendChild(image);
                    $(image).tooltip({
                        items: 'img',
                        content: cloneImage,
                        position: { my: "right" },
                        show: { delay: 1000 }
                    });
                }
            }

            $(function () {
                $('.imageCarteMains').draggable({
                    start: function () {
                        $(this).animate({
                            height: 90,
                            width: 58
                        }, { duration: 400, queue: false }
                        );
                        var id;
                        id = event.target.parentNode.id.substr(event.target.id.length - 1);

                        //Les if qui vont envoyer l'objet carte dans la variable.
                        carteDrag = mains[numeroJoueurActif][id];
                        carteDragNumero = id;
                    },
                    drag: function () {
                        $('.ui-tooltip').hide();
                    },
                    revert: function (socketObj) {
                        if (socketObj === false) {
                            revertCarte(this);
                            return true;
                        }
                        else {
                            return false;
                        }
                    },
                    revertDuration: 400
                });
            });

            pointsRessourcesBase[numeroJoueurActif] = 6;
            pointsRessourcesSuplementaire[numeroJoueurActif] = pointsRessourcesAdditionel();
            pointsRessourcesTotal[numeroJoueurActif] = pointsRessourcesBase[numeroJoueurActif] + pointsRessourcesSuplementaire[numeroJoueurActif];
            pointsRessourcesUtiliser[numeroJoueurActif] = 0;
            pointsRessourcesRestant[numeroJoueurActif] = pointsRessourcesTotal[numeroJoueurActif];

            updatePointsRessources();
        }

        //Fonction qui update après avoir jouer une carte.
        function updatePointsRessources() {
            //   $('.divTextePointsRessource').html('<p class=titreRessource><strong>Points de ressources disponibles : ' + pointsRessources[numeroJoueurActif] + ' </strong>');
            //TODO: À clou: reste juste à modifier la partie de droite pour afficher les différentes variables de points ressources et
            // a update dans cette fonction les text. La fonction est déjà appeler correctement :p
        }
    </script>
</body>
</html>