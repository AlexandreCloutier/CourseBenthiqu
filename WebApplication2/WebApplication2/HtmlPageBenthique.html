<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body onload="startGame()">
    <script>
        var myGamePiece;
        var myBackground;
        var dropvariable = document.createAttribute("ondrop");
        dropvariable.value = "drop(event)";
        var dropVariable2 = document.createAttribute("ondrop");
        dropVariable2.value = "drop(event)";
        var dragVariable = document.createAttribute("ondragstart");
        dragVariable.value = "drag(event)";
        var allowDropVariable = document.createAttribute("ondragover");
        allowDropVariable.value = "allowDrop(event)";
        var allowDropVariable2 = document.createAttribute("ondragover");
        allowDropVariable2.value = "allowDrop(event)";

        //*******************************TEST******************
        var iDiv = document.createElement('div');
        iDiv.id = 'divCarte';
        iDiv.className = 'divCarte';     
        iDiv.setAttributeNode(dropvariable);
        iDiv.setAttributeNode(allowDropVariable);
        document.getElementsByTagName('body')[0].appendChild(iDiv);

        var image = document.createElement('img');
        image.id = 'imageCarte';
        image.className = 'imageCarte';
        image.draggable = 'true';
        image.setAttributeNode(dragVariable);
        image.src = 'resources/PlateauJeu.jpg';
        // Mes image Dans le idiv
        iDiv.appendChild(image);

        var divEmplacement = document.createElement('div');
        divEmplacement.id = 'emplacementCarte';
        divEmplacement.className = 'emplacementCarte';
        divEmplacement.setAttributeNode(dropVariable2);
        divEmplacement.setAttributeNode(allowDropVariable2);
        document.getElementsByTagName('body')[0].appendChild(divEmplacement);

        //Fonction qui "prévient" le navigateur car normalement il l'empèche de drag les images.
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("Text", ev.target.id);
        }

        function drop(ev) {
            var data = ev.dataTransfer.getData("Text");
            ev.target.appendChild(document.getElementById(data));
            ev.preventDefault(ev);
        }

        function remplirDivHabitat() {
            var dropVariable = document.createAttribute("ondrop");
            dropvariable.value = "drop(event)";

            var divEmplacementHabitat = document.createElement('div');
            divEmplacementHabitat.className = 'divEmplacementHabitat';
            divEmplacementHabitat.setAttributeNode(dropVariable);
            document.getElementsByTagName('body')[0].appendChild(divEmplacementHabitat);
        }

        //****************** ************TEST******************

        //Fonction appeler au début, elle "start" le jeu.
        function startGame() {
            remplirDivHabitat();
            myBackground = new component(650, 650, "resources/PlateauJeu.jpg", 0, 10, "image");
            myGameArea.start();
        }

        //Instantie "l'area" du jeu,
        var myGameArea = {
            canvas: document.createElement("canvas"),
            start: function () {
                this.canvas.width = 650;
                this.canvas.height = 800;
                this.canvas.id = ''
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                this.frameNo = 0;
                this.interval = setInterval(updateGameArea, 20);
            },
            clear: function () {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            },
            stop: function () {
                clearInterval(this.interval);
            }
        }

        //Fonction qui crée les "component" et entre les valeurs voulu.
        function component(width, height, color, x, y, type) {
            this.type = type;
            if (type == "image") {
                this.image = new Image();
                this.image.src = color;
            }
            this.image.draggable = true;
            this.allowDrop = true;
            this.width = width;
            this.height = height;
            this.speedX = 0;
            this.speedY = 0;
            this.x = x;
            this.y = y;
            this.update = function () {
                ctx = myGameArea.context;
                if (type == "image") {
                    ctx.drawImage(this.image,
                        this.x,
                        this.y,
                        this.width, this.height);
                } else {
                    ctx.fillStyle = color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            }
            this.newPos = function () {
                this.x += this.speedX;
                this.y += this.speedY;
            }
        }

        //Fonction qui "update" le jeu.
        function updateGameArea() {
            myGameArea.clear();
            myBackground.newPos();
            myBackground.update();
        }
    </script>
</body>
</html>